<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Virtualising Apple QuickTime 7.x | stealthpuppy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Virtualising Apple QuickTime 7.x" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Updated 04/05/2010" />
<meta property="og:description" content="Updated 04/05/2010" />
<link rel="canonical" href="/sequencing-apple-quicktime-7x/" />
<meta property="og:url" content="/sequencing-apple-quicktime-7x/" />
<meta property="og:site_name" content="stealthpuppy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2008-02-04T00:00:44+11:00" />
<script type="application/ld+json">
{"description":"Updated 04/05/2010","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/sequencing-apple-quicktime-7x/","headline":"Virtualising Apple QuickTime 7.x","dateModified":"2008-02-04T00:00:44+11:00","datePublished":"2008-02-04T00:00:44+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"/sequencing-apple-quicktime-7x/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="stealthpuppy" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">stealthpuppy</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">ABOUT</a><a class="page-link" href="/smb-not-cifs.html">SMB not CIFS</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Virtualising Apple QuickTime 7.x</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2008-02-04T00:00:44+11:00" itemprop="datePublished">Feb 4, 2008
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><em><img style="margin: 0px 10px 10px 0px; display: inline; border: 0px;" title="QuickTime App-V box" src="https://stealthpuppy.com/wp-content/uploads/2010/05/QuickTime011.png" border="0" alt="QuickTime App-V box" width="149" height="145" align="left" /> Updated 04/05/2010</em></p>

<p>Here’s how to create a custom Apple QuickTime 7.x installation for virtualisation. This post specifically deals with virtualising QuickTime with Microsoft App-V, but the general process should be similar for any application virtualisation product.</p>

<p>If you’ve ever looked at deploying Apple QuickTime on Windows you have no doubt run into the challenges in configuring settings for this application. Successfully virtualising QuickTime requires that users receive the correct preferences before they run the application.</p>

<p>For some absurd reason QuickTime stores part of it’s preferences in the registry, while the other half is stored in the file system. It’s the those preferences that have the most visual impact on users that are stored in the file system.</p>

<p>Preferences are stored in the local portion of the user profile, which by default is not virtualised. Because of this, any settings you may configure will not be included in a QuickTime App-V package. Preferences are stored here:</p>

<ul>
  <li><code class="highlighter-rouge">%USERPROFILE%\AppData\LocalLow\Apple Computer\QuickTime\QuickTime.qtp</code> (Windows Vista and above)</li>
  <li><code class="highlighter-rouge">%LOCALAPPDATA%\Apple Computer\QuickTime\QTPlayerSession.xml</code> (Windows Vista and above)</li>
  <li><code class="highlighter-rouge">%USERPROFILE%\Local Settings\Application Data\Apple Computer\QuickTime\QuickTime.qtp</code> (Windows XP / Windows Server 2003)</li>
  <li><code class="highlighter-rouge">&lt;code&gt;%USERPROFILE%\Local Settings\Application Data\Apple Computer\QuickTime</code>\QTPlayerSession.xml&lt;/code&gt; (Windows XP / Windows Server 2003)</li>
</ul>

<p>There are several ways of addressing this issue when virtualising QuickTime:</p>

<ol>
  <li>Change the preferences folder location. A single registry change can tell QuickTime to store preferences in the roaming profile</li>
  <li>Copy the preferences files to the local profile at runtime using scripts in the OSD file or other tools (e.g. Group Policy Preferences)</li>
  <li>Include the local AppData location which is excluded by default; however the cache is also stored here</li>
</ol>

<h3 id="installing-quicktime">Installing QuickTime</h3>

<p>Before I look at setting preferences, I’ll address automating the installation of QuickTime, because I want to make this sequence repeatable and I want to control which components are installed. Specifically I want to avoid installing the Apple Software Updater.</p>

<p>Download the QuickTime installer (without iTunes), available from the <a href="http://www.apple.com/quicktime/download/">Apple web site</a> (7.6.6 at the time of writing). Extract this file to obtain the included Windows Installer files.</p>

<p><img style="display: inline; border: 0px;" title="Extracted QuickTime installer" src="https://stealthpuppy.com/wp-content/uploads/2010/05/QuickTime02.png" border="0" alt="Extracted QuickTime installer" width="660" height="230" /></p>

<p>Automating the installation of QuickTime is very simple once you know how. An excellent source for finding that information is at <a href="http://www.appdeploy.com/packages/detail.asp?id=520">AppDeploy.com</a>. The installation script I have created does not use custom transforms and will perform the following basic steps:</p>

<ul>
  <li>Install Apple Application Support, which is now a required component</li>
  <li>Install Apple QuickTime to the virtual drive although you could use VFS install if you prefer</li>
  <li>Ensure Apple Software Updater is not installed (by not installing <em>AppleSoftwareUpdate.MSI</em>)</li>
  <li>Delete any icons not required – I recommend not giving users access to Picture Viewer because it does not honour preferences correctly</li>
  <li>Delete the QTTASK.EXE application from the Run registry key</li>
  <li>Ensure users are not prompted to reclaim file associations by the ActiveX control</li>
</ul>

<p>Download the copy of the install script here:</p>

<p class="download">
  [download id=36 format=1]
</p>

<h3 id="quicktime-preferences">QuickTime preferences</h3>

<p>There are a number of settings that you should consider in your QuickTime package, which can include registration information for QuickTime Pro:</p>

<p>File type associations – don’t forget to prevent QuickTime from attempting to re-associate file types at launch. Selecting Yes here, will capture the default file types.</p>

<p><img style="display: inline; border: 0px;" title="QuickTime file type associate" src="https://stealthpuppy.com/wp-content/uploads/2010/05/QuickTime03.png" border="0" alt="QuickTime file type associate" width="429" height="160" /></p>

<p>When the player starts, open <em>Edit / Preferences / Player Preferences</em> and prevent the Content Guide from displaying at application start.</p>

<p><img style="display: inline; border: 0px;" title="QuickTime Player Preferences" src="https://stealthpuppy.com/wp-content/uploads/2010/05/QuickTime04.png" border="0" alt="QuickTime Player Preferences" width="390" height="486" /></p>

<p>Open <em>Edit / Preferences / QuickTime Preferences</em> to star the QuickTime Control Panel. You may want to prevent movies from playing automatically. Useful for the HD videos that may take some time to download.</p>

<p><img style="display: inline; border: 0px;" title="QuickTime Preferences Browser" src="https://stealthpuppy.com/wp-content/uploads/2010/05/QuickTime05.png" border="0" alt="QuickTime Preferences Browser" width="426" height="564" /></p>

<p>Prevent QuickTime from checking for updates on launch. When virtualising it would also be useful to prevent access to this control with a 3rd party tool such as AppSense Environment Manager (or hack the DLL with <a href="http://www.wilsonc.demon.co.uk/d10resourceeditor.htm">Resource Explorer</a> yourself).</p>

<p><img style="display: inline; border: 0px;" title="QuickTime Preferences Update" src="https://stealthpuppy.com/wp-content/uploads/2010/05/QuickTime06.png" border="0" alt="QuickTime Preferences Update" width="426" height="564" /></p>

<p>The QuickTime notification area icon should be disabled by default, but check that here:</p>

<p><img style="display: inline; border: 0px;" title="QuickTime Preferences Advanced" src="https://stealthpuppy.com/wp-content/uploads/2010/05/QuickTime07.png" border="0" alt="QuickTime Preferences Advanced" width="426" height="564" /></p>

<p>If you configure QuickTime via a standard installation, you can automate this process by copying the preferences files to the correct locations during installation.</p>

<p><strong>Note</strong>: If you want to prevent users from accessing the QuickTime Control Panel applet when running QuickTime Player, rename or delete the CPL file: _<Install folder="">\QTSystem\QuickTime.cpl_. When users access the QuickTime Preferences menu item, nothing will happen.</Install></p>

<h3 id="change-the-preferences-folder-location">Change the preferences folder location</h3>

<p>To change the folder location for storing preferences modify the following registry value as a part of your capture process:</p>

<p><code class="highlighter-rouge">HKEY_CURRENT_USER\Software\Apple Computer, Inc.\QuickTime\LocalUserPreferences\FolderPath</code></p>

<p>For this to work correctly, you <em>must</em> add a trailing slash to the path, for example: <code class="highlighter-rouge">%APPDATA%\Apple Computer\QuickTime\</code></p>

<p>This will tell QuickTime to store preferences in the roaming profile and thus any changes will be captured by the sequencer.</p>

<h3 id="copy-the-preferences-file-at-runtime">Copy the preferences file at runtime</h3>

<p>If you would prefer to leave the preferences file in it’s default location, you will have to copy a pre-configured preferences file at launch.</p>

<p>Create the QuickTime preferences by first installing QuickTime onto a test machine, configuring the required preferences, then copy the preferences file to a folder under the asset folder. Then modify the OSD file to copy the configured preferences file when QuickTime is launched:</p>

<p>[code]<script event="LAUNCH" wait="TRUE" protect="TRUE" timing="PRE"></script></p>
<SCRIPTBODY>@XCOPY /E /I /Q Q:\QTIME7.001\Prefs "%USERPROFILE%\Local Settings\Application Data\Apple Computer\QuickTime"</SCRIPTBODY>
<p>&lt;/script&gt;[/code]</p>

<p>If you’re using Windows Vista or above change the path slightly:</p>

<p>[code]<script event="LAUNCH" wait="TRUE" protect="TRUE" timing="PRE"></script></p>
<SCRIPTBODY>@XCOPY /E /I /Q Q:\QTIME7.001\Prefs "%LOCALAPPDATA%\Apple Computer\QuickTime"</SCRIPTBODY>
<p>&lt;/script&gt; [/code]</p>

<p>To support current and previous operating systems in the same package you could use this script instead:</p>

<p>[code]<script event="LAUNCH" wait="TRUE" protect="TRUE" timing="PRE"></script></p>
<SCRIPTBODY>IF EXIST "%LOCALAPPDATA%" (@XCOPY /E /I /Q Q:\QTIME7.001\Prefs "%LOCALAPPDATA%\Apple Computer\QuickTime") ELSE @XCOPY /E /I /Q Q:\QTIME7.001\Prefs "%USERPROFILE%\Local Settings\Application Data\Apple Computer\QuickTime"</SCRIPTBODY>
<p>&lt;/script&gt;[/code]</p>

<p>3rd party user environment management tools such as AppSense Environment Manager or RES PowerFuse can do these actions on demand, so you could avoid scripting and copy the files when QuickTimePlayer.exe launches.</p>

<h3 id="include-local-appdata-for-capturing-preferences-when-sequencing">Include local AppData for capturing preferences when sequencing</h3>

<p>If you want to leave the preferences in their default locations, then before virtualising remove these default preferences from the project:</p>

<ul>
  <li><em>%CSIDL_LOCAL_APPDATA%</em></li>
  <li><em>%CSIDL_PROFILE%\Local Settings</em></li>
</ul>

<p>Then add back the QuickTime cache folder as an exclusion:</p>

<ul>
  <li><em>%CSIDL_LOCAL_APPDATA%\Apple Computer\QuickTime\downloads</em></li>
</ul>

<p>This will capture the preferences and ensure the QuickTime cache folder is not captured in the user’s virtualised profile (the .PKG file).</p>

<h3 id="virtualising-the-quicktime-package">Virtualising the QuickTime package</h3>

<p>You may additionally like to add <em>%CSIDL_WINDOWS%\Installer</em> as an exclusion to reduce the size of the final package, as a copy of the QuickTime setup files are stored there.</p>

<p>Capturing QuickTime should be straight-forward; however you will most likely need to create separate packages if you support multiple operating systems. Sequence on the lowest common denominator and test to see if this is required.</p>

<p>You will also need to create a shortcut to Internet Explorer (or your browser of choice) so that users can use QuickTime to view media on the web - just as you would when virtualising any other ActiveX controls.</p>

  </div><a class="u-url" href="/sequencing-apple-quicktime-7x/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">stealthpuppy</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">stealthpuppy</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/aaronparker"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">aaronparker</span></a></li><li><a href="https://www.twitter.com/stealthpuppy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">stealthpuppy</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>on end user computing and enterprise mobility</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
