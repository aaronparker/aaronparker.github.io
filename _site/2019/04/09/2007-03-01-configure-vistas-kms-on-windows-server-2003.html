<p>Unfortunately life with Windows Vista means living with Microsoft’s <a href="http://www.microsoft.com/technet/windowsvista/plan/faq.mspx">Volume Activation 2.0</a>. For complete information on Volume Activation 2.0 see this TechNet page:</p>

<p><a href="http://www.microsoft.com/technet/windowsvista/plan/volact1.mspx">Windows Vista Volume Activation 2.0 Step-By-Step Guide</a></p>

<p>When deploying Windows Vista in the enterprise you have the choice of Multiple Activation Keys or Key Management Services (KMS) keys. The KMS uses a service you install on Windows Server 2003 and is already install on Windows Vista or Windows Server Longhorn. Note that this machine must be a physical computer, you can install the KMS in a virtual machine, but when you use the configuration utility it will give you an error.</p>

<p>There’s a fair amount of reading you’ll have to do to work out how to get the KMS up and running, but if you’re like me and you have the attention span of a goldfish, here’s the short version:</p>

<p><strong>1</strong>. Download the Key Management Service for Windows Server 2003 SP1“ there are <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=81d1cb89-13bd-4250-b624-2f8c57a1ae7b&amp;DisplayLang=en">x86</a> and <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=03fe69b2-6244-471c-80d2-b4171fb1d7a5&amp;DisplayLang=en">x64</a> versions available.</p>

<p><strong>2</strong>. Install the KMS on a physical machine running Windows Server 2003. The same machine you might be using for <a href="http://technet.microsoft.com/en-us/windowsvista/aa905118.aspx">WDS</a> could be the best candidate.</p>

<p><strong>3</strong>. Add your Windows Vista KMS key to the KMS host:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\WINDOWS\system32&gt;cscript slmgr.vbs /ipk XXXXX-XXXXX-XXXXX-XXXXX-XXXXX
Microsoft <span class="o">(</span><span class="nb">R</span><span class="o">)</span> Windows Script Host Version 5.6
Copyright <span class="o">(</span>C<span class="o">)</span> Microsoft Corporation 1996-2001. All rights reserved.
Installed product key XXXXX-XXXXX-XXXXX-XXXXX-XXXXX successfully.
</code></pre></div></div>

<p><strong>4</strong>. Activate your KMS host with Microsoft:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\WINDOWS\system32&gt;cscript slmgr.vbs /ato
Microsoft <span class="o">(</span><span class="nb">R</span><span class="o">)</span> Windows Script Host Version 5.6
Copyright <span class="o">(</span>C<span class="o">)</span> Microsoft Corporation 1996-2001. All rights reserved.
This operation connects over the Internet to send the appropriate computer information, such as the types of hardware you are <span class="k">using </span>and the product ID, to the Microsoft activation server. By <span class="k">using </span>this Software, you consent to the transmission of this information. Microsoft does not use the information to identify or contact you.
<span class="k">Do </span>you want to <span class="k">continue</span> <span class="o">[</span>y/n]? y
Activating Windows<span class="o">(</span>TM<span class="o">)</span> Server 2003 KMS, KmsW2k3Prs edition <span class="o">(</span>aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa<span class="o">)</span> ...
Product activated successfully.
You can now view the status of your KMS server:
C:\WINDOWS\system32&gt;cscript slmgr.vbs /dli
Microsoft <span class="o">(</span><span class="nb">R</span><span class="o">)</span> Windows Script Host Version 5.6
Copyright <span class="o">(</span>C<span class="o">)</span> Microsoft Corporation 1996-2001. All rights reserved.
Name: Windows<span class="o">(</span>TM<span class="o">)</span> Server 2003 KMS, KmsW2k3Prs edition
Description: Windows<span class="o">(</span>TM<span class="o">)</span> Server 2003 KMS, VOLUME_KMS channel
Partial Product Key: J3YKD
License Status: Licensed
Key Management Service is enabled on this machine
Current count: 0
Listening on Port: 1688
DNS publishing enabled
KMS priority: Normal
</code></pre></div></div>

<p>Now your KMS server should be running you can deploy Windows Vista using the same KMS key. Windows Vista will query DNS to find your KMS server and activate against it. Give DNS time to replicate and you can then see if your KMS server is registred correctly with NSLOOKUP:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\&gt; nslookup -type<span class="o">=</span>srv _vlmcs._tcp
Server: dc.company.local
Address: 192.168.1.17:53
_vlmcs._tcp.company.local SRV service location:
priority <span class="o">=</span> 0
weight <span class="o">=</span> 0
port <span class="o">=</span> 1688
svr <span class="nb">hostname</span> <span class="o">=</span> kmshost.company.local
kmshost.company.local internet address <span class="o">=</span> 192.168.1.23
</code></pre></div></div>

<p>As alternative to quering DNS to find the KMS host, you can hard code a client to use a particular KMS host:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Windows\System32\cscript slmgr.vbs -skms &lt;KMS_FQDN&gt;[:port]
</code></pre></div></div>

<p>The best place to get questions and answers about Volume Activation 2.0 is the FAQ page:</p>

<p><a href="http://www.microsoft.com/technet/windowsvista/plan/faq.mspx">Windows Vista Volume Activation 2.0</a></p>
