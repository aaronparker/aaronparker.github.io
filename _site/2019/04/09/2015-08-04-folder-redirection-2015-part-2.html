<p>This is a multi-part article detailing our testing results and presentations for the 2015 series on Folder Redirection:</p>

<ul>
  <li><a href="https://stealthpuppy.com/folder-redirection-2015-part-1/">I’ve Got 99 Problems and Folder Redirection is Every One of Them. 2015 Testing Results. Part 1</a>.</li>
  <li>I’ve Got 99 Problems and Folder Redirection is Every One of Them. 2015 Testing Results. Part 2. (this article)</li>
  <li><a href="https://stealthpuppy.com/folder-redirection-2015-part-3/">I’ve Got 99 Problems and Folder Redirection is Every One of Them. 2015 Testing Results. Part 3</a>.</li>
</ul>

<h2 id="file-server-capacity-tool">File Server Capacity Tool</h2>

<p>The File Server Capacity Tool (FSCT) is great for modelling a user home drive hosted on Windows file servers. I’ve covered <a href="https://stealthpuppy.com/replicate-2015-folder-redirection-test/">how to use the FSCT previously</a>, and the results of our tests have included various scenarios looking at CPU and disk performance.</p>

<h3 id="file-server-capacity-toolcpu-performance">File Server Capacity Tool CPU Performance</h3>

<p>In this test with Windows Server 2008 R2 running on the file server, SMB 2.1 shows quite a large difference between the average and maximum CPU seen across each test, especially from 400 users and beyond.</p>

<p><img src="https://stealthpuppy.com/wp-content/uploads/2015/08/FSCT-SMB21-CPU.png" alt="SMB 2.1 showed a big difference between the average and maximum CPU seen across each test." /><em>SMB 2.1 showed a big difference between the average and maximum CPU seen across each test.</em></p>

<p>The results from the tests with Windows Server 2012 R2 on the file server shows very similar average CPU, but a greatly reduced maximum CPU, which is great for overall file server resource consumption.</p>

<p><img src="https://stealthpuppy.com/wp-content/uploads/2015/08/FSCT-SMB3-CPU.png" alt="Lower CPU Utilization with SMB 3.02" /><em>Lower CPU Utilization with SMB 3.02</em></p>

<h3 id="looking-at-the-impact-of-anti-virus">Looking at the Impact of Anti-Virus</h3>

<p>Running the same test with Windows Server 2012 R2, but this time with one of the major anti-virus products installed on the file server. This was installed with all of the default settings. This test shows a very interesting result when compared against the previous test - the chart below displays the same results as the previous test with the results from a testing run with AV:</p>

<p><img src="https://stealthpuppy.com/wp-content/uploads/2015/08/FSCT-SMB3-CPUwithAV.png" alt="Anti-Virus Has a Large Impact on CPU" /><em>Anti-Virus Has a Large Impact on CPU</em></p>

<p>With anti-virus installed, the average CPU is now getting up around the maximum CPU seen without AV, especially from 600 users and beyond. Look at that maximum CPU recorded with anti-virus, that’s a massive difference from the previous test and will have a large impact on the file server!</p>

<p>To see if we could improve on this result, we re-ran the test with on-access scans disabled in the anti-virus configuration. This had little impact on the result, which could be explained by the FSCT workload being very write heavy.</p>

<p><img src="https://stealthpuppy.com/wp-content/uploads/2015/08/OnAccessScans.png" alt="Disabling On Access Scans for AV Had Little Impact" /><em>Disabling On Access Scans for AV Had Little Impact</em></p>

<p>There might be additional tweaking that may improve performance; however given the massive difference between with and without AV, I’m not confident that any considerable gains could be made. We haven’t yet had a chance to test with multiple anti-virus products.</p>

<h3 id="file-server-capacity-tooldisk-performance">File Server Capacity Tool Disk Performance</h3>

<p>The FSCT workloads show some interesting results in regards to disk performance. First up is a correlation between high IO and high CPU - the more blocks generated on the storage (i.e. more blocks that are read or written from and to the file server, requires the file server to process it).</p>

<p>In the result below, we can see that when the IO peaks at near 2500 IOPS, the CPU makes a big jump as well:</p>

<p><img src="https://stealthpuppy.com/wp-content/uploads/2015/08/DiskIO-CorrelateCPU.png" alt="CPU Peaks Correlate With IO Peaks" /><em>CPU Peaks Correlate With IO Peaks</em></p>

<p>While all of the previous FSCT tests have been performed on SSDs, we also looked at comparing performance when running FSCT workloads on HDDs and comparing that against SSDs.</p>

<p>When comparing the CPU load of the same workload running on HDD and SSDs, the average CPU is higher on HDDs.</p>

<p><img src="https://stealthpuppy.com/wp-content/uploads/2015/08/FSCT-HDDs.png" alt="Higher CPU with HDDs" /><em>Higher CPU with HDDs</em></p>

<p>This higher CPU on HDDs is, in part, explained by the higher disk queue length seen with HDDs. The chart below shows the results of these tests with the disk queue length on HDDs significantly higher as the number of users in the tests increases.</p>

<p><img src="https://stealthpuppy.com/wp-content/uploads/2015/08/FSCT-SSDs.png" alt="Higher Avg. Disk Queue Length with HDDs" /><em>Higher Avg. Disk Queue Length with HDDs</em></p>

<p>It’s clear then that any <a href="http://www.atlantiscomputing.com/hyperscale">high performing storage platform</a> will not only improve storage performance, it will reduce the load on your compute, providing improved user experience across multiple layers of your infrastructure.</p>

<h2 id="part-3">Part 3</h2>

<p>In part 3, I’ll cover <a href="https://stealthpuppy.com/folder-redirection-2015-part-3">file access performance and summarise our recommendations</a> for what you should be doing to get the best performance out of folder redirection.</p>
