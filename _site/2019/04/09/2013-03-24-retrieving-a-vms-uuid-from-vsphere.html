<p>While working on a PowerShell script to drive OS deployment through MDT, I’ve needed to obtain the UUID from a target virtual machine. Unfortunately this isn’t just a property of the VM that you get through <a href="http://www.vmware.com/support/developer/PowerCLI/PowerCLI41U1/html/Get-VM.html">Get-VM</a>. Instead you’ll need jump through a few hoops to retrieve the right UUID.</p>

<p>I’ve haven’t had to re-invent the wheel on this one, as I’ve taken some tips from this <a href="http://communities.vmware.com/thread/239735">VMware Community thread</a> and <a href="http://www.keithsmithonline.com/2013/02/powershell-show-vmware-vm-UUID.html">a blog post by Ken Smith</a>. I have simplified things a little by writing a function that you can use to return the UUID as a string from a virtual machine object (gathered from Get-VM) to the function.</p>

<p>To use the function, first ensure that <a href="http://communities.vmware.com/community/vmtn/server/vsphere/automationtools/powercli">PowerCLI</a> is installed and that you’ve connected to a host or vCenter, so that a target VM can be returned and then passed to the function.</p>

<p>For example, I could use the following command to retrieve the UUID from a target VM:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">PS </span>C:\&gt; Get-VM -VM <span class="s2">"W7VM1"</span> | Get-vSphereVMUUID  
554c0342-c2c7-c3b7-8258-96eb00f62b0c
</code></pre></div></div>

<p>Code listing below:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Author: Aaron Parker  </span>
<span class="c1"># Desc: Function that uses retrieves the UUID from a specified VM and  </span>
<span class="c1"># transposes it into the right format for use with MDT/SCCM etc  </span>
<span class="c1"># Date: Mar 24, 2013  </span>
<span class="c1"># Site: http://stealthpuppy.com  </span>
<span class="c1">#  </span>
<span class="c1"># Original code snippets from:  </span>
<span class="c1"># http://communities.vmware.com/thread/239735  </span>
<span class="c1"># http://www.keithsmithonline.com/2013/02/powershell-show-vmware-vm-UUID.html  </span>
<span class="k">Function </span>Get-vSphereVMUUID <span class="o">{</span>  
    <span class="cm">&lt;#  
        .SYNOPSIS  
        Retrieves the UUID from a specified VM and formats it correctly for use with MDT/SCCM etc.

        .DESCRIPTION  
        Retrieves the UUID from a specified VM and formats it correctly for use with MDT/SCCM etc. Returns the UUID as a string that can be passed to other functions.

        Requires that a VM object is passed to the function. That object will first have to be created before being passed to this function.

        .PARAMETER VM  
        Specifies the VM to retrieve the UUID from.

        .EXAMPLE  
        PS C:\&gt; Get-vSphereVMUUID -VM "W7VM1"

        Retrieves the UUID from a VM named W7VM1.

        .EXAMPLE  
        PS C:\&gt; $VM | Get-vSphereVMUUID

        Retrieves the UUID from a VM piped to this function.

        .NOTES  
        See https://stealthpuppy.com/ for support information.

        .LINK  
        https://stealthpuppy.com/code/retrieving-a-vms-uuid-from-vsphere/
    #&gt;</span>
    <span class="o">[</span><span class="na">CmdletBinding</span><span class="o">(</span><span class="na">SupportsShouldProcess</span> <span class="o">=</span> <span class="nv">$True</span><span class="o">)]</span>  
    <span class="k">Param</span><span class="o">(</span>  
        <span class="o">[</span>Parameter<span class="o">(</span>Mandatory <span class="o">=</span> <span class="nv">$True</span>, ValueFromPipeline <span class="o">=</span> <span class="nv">$True</span>, HelpMessage <span class="o">=</span> <span class="s2">"Specify the VM to retrive the UUID from."</span><span class="o">)]</span>  
        <span class="o">[</span>System.Object]<span class="nv">$VM</span>  
    <span class="o">)</span>

    <span class="k">BEGIN</span> <span class="o">{</span>  
    <span class="o">}</span>

    <span class="k">PROCESS</span> <span class="o">{</span>  
        <span class="c1"># Retrive UUID from vSphere  </span>
        <span class="nv">$UUID</span> <span class="o">=</span> <span class="nv">$VM</span> | <span class="k">ForEach</span>-Object <span class="o">{</span> <span class="o">(</span>Get-View <span class="nv">$_</span>.Id<span class="o">)</span>.config.UUID <span class="o">}</span>

        <span class="c1">#Transpose UUID into expected format  </span>
        <span class="c1"># Section 1  </span>
        <span class="nv">$UUID11</span> <span class="o">=</span> <span class="nv">$UUID</span>.Substring<span class="o">(</span>0, 2<span class="o">)</span>  
        <span class="nv">$UUID12</span> <span class="o">=</span> <span class="nv">$UUID</span>.Substring<span class="o">(</span>2, 2<span class="o">)</span>  
        <span class="nv">$UUID13</span> <span class="o">=</span> <span class="nv">$UUID</span>.Substring<span class="o">(</span>4, 2<span class="o">)</span>  
        <span class="nv">$UUID14</span> <span class="o">=</span> <span class="nv">$UUID</span>.Substring<span class="o">(</span>6, 2<span class="o">)</span>

        <span class="c1"># Section 2  </span>
        <span class="nv">$UUID21</span> <span class="o">=</span> <span class="nv">$UUID</span>.Substring<span class="o">(</span>9, 2<span class="o">)</span>  
        <span class="nv">$UUID22</span> <span class="o">=</span> <span class="nv">$UUID</span>.Substring<span class="o">(</span>11, 2<span class="o">)</span>

        <span class="c1"># Section 3  </span>
        <span class="nv">$UUID31</span> <span class="o">=</span> <span class="nv">$UUID</span>.Substring<span class="o">(</span>14, 2<span class="o">)</span>  
        <span class="nv">$UUID32</span> <span class="o">=</span> <span class="nv">$UUID</span>.Substring<span class="o">(</span>16, 2<span class="o">)</span>

        <span class="c1"># Section 4  </span>
        <span class="nv">$UUID41</span> <span class="o">=</span> <span class="nv">$UUID</span>.Substring<span class="o">(</span>19, 4<span class="o">)</span>

        <span class="c1"># Section 5  </span>
        <span class="nv">$UUID51</span> <span class="o">=</span> <span class="nv">$UUID</span>.Substring<span class="o">(</span>24, 12<span class="o">)</span>

        <span class="c1"># Piece the strings together  </span>
        <span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="nv">$UUIDa</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$UUID14$UUID13$UUID12$UUID11</span><span class="s2">"</span>  
        <span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="nv">$UUIDb</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$UUID22$UUID21</span><span class="s2">"</span>  
        <span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="nv">$UUIDc</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$UUID32$UUID31</span><span class="s2">"</span>  
        <span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="nv">$UUIDd</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$UUID41</span><span class="s2">"</span>  
        <span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="nv">$UUIDe</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$UUID51</span><span class="s2">"</span>  
        <span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="nv">$UUIDfixed</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$UUIDa</span><span class="s2">-</span><span class="nv">$UUIDb</span><span class="s2">-</span><span class="nv">$UUIDc</span><span class="s2">-</span><span class="nv">$UUIDd</span><span class="s2">-</span><span class="nv">$UUIDe</span><span class="s2">"</span>  
    <span class="o">}</span>

    <span class="k">END</span> <span class="o">{</span>  
        <span class="c1"># Return the UUID  </span>
        <span class="k">Return</span> <span class="nv">$UUIDfixed</span>  
    <span class="o">}</span>  
<span class="o">}</span>
</code></pre></div></div>
