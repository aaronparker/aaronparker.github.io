<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Hands off my gold image – The Scripts | stealthpuppy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Hands off my gold image – The Scripts" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This is the last article in a series that covers in more detail the approach to automating XenApp and PVS image creation, from my Geek Speak talk at Citrix Synergy in Barcelona – Hands off my gold image." />
<meta property="og:description" content="This is the last article in a series that covers in more detail the approach to automating XenApp and PVS image creation, from my Geek Speak talk at Citrix Synergy in Barcelona – Hands off my gold image." />
<link rel="canonical" href="/hands-off-my-gold-image-the-scripts/" />
<meta property="og:url" content="/hands-off-my-gold-image-the-scripts/" />
<meta property="og:site_name" content="stealthpuppy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2012-11-23T01:39:51+11:00" />
<script type="application/ld+json">
{"description":"This is the last article in a series that covers in more detail the approach to automating XenApp and PVS image creation, from my Geek Speak talk at Citrix Synergy in Barcelona – Hands off my gold image.","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/hands-off-my-gold-image-the-scripts/","headline":"Hands off my gold image – The Scripts","dateModified":"2012-11-23T01:39:51+11:00","datePublished":"2012-11-23T01:39:51+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"/hands-off-my-gold-image-the-scripts/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="stealthpuppy" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">stealthpuppy</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">About</a><a class="page-link" href="/about/">About</a><a class="page-link" href="/app-v-5-x-versions.html">App-V 5.x Versions</a><a class="page-link" href="/appv-faqs.html">App-V 4.x FAQs</a><a class="page-link" href="/appv5-faqs.html">Microsoft Application Virtualization 5 FAQs</a><a class="page-link" href="/appvrecipes.html">App-V Recipes</a><a class="page-link" href="/archives.html">Archives</a><a class="page-link" href="/home-page.html">Home Page</a><a class="page-link" href="/scriptcorner.html">Script Corner</a><a class="page-link" href="/search-results.html">Search Results</a><a class="page-link" href="/smb-not-cifs.html">SMB not CIFS &amp;#8211; Why you should stop referring to CIFS</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Hands off my gold image &amp;#8211; The Scripts</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2012-11-23T01:39:51+11:00" itemprop="datePublished">Nov 23, 2012
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><img class="alignright size-full wp-image-2946" style="margin: 5px;" title="HandsOff" src="http://stealthpuppy.com/wp-content/uploads/2012/11/HandsOff.jpg" alt="" width="125" height="127" />This is the last article in a series that covers in more detail the approach to automating XenApp and PVS image creation, from my <a href="https://citrix.g2planet.com/synergybarcelona2012/public_session_view.php?agenda_session_id=191&amp;conference=synergy">Geek Speak talk at Citrix Synergy in Barcelona – Hands off my gold image.</a></p>

<p>The first article gives an overview of the approach – <a href="http://stealthpuppy.com/deployment/hands-off-my-gold-image-automating-citrix-xenapppvs-image-creation/">Hands off my gold image – Automating Citrix XenApp/PVS Image Creation</a> and you can find more detail in <a href="http://stealthpuppy.com/deployment/hands-off-my-gold-image-microsoft-deployment-toolkit-details/">Hands off my gold image – Microsoft Deployment Toolkit details</a> and <a href="http://stealthpuppy.com/deployment/hands-off-my-gold-image-the-task-sequence/">Hands off my gold image – The Task Sequence</a>. In this article I’ll briefly cover the scripts referenced in the task sequence.</p>

<h1 id="approach-to-scripting">Approach to Scripting</h1>

<p>Each included script is just a batch file. You won’t find too much error handling going on and each script will make certain assumptions about where things such as binaries are located. This has been done to keep each script as simple and as portable as possible.</p>

<p>Where possible, I’ve tried to use the original un-modified installer – that is, I’ve avoided extracting an installer if can get away with it. This should be that updating a binary requires as little changes to the scripts as possible.</p>

<h1 id="script-details">Script Details</h1>

<p>In the download that contains the pieces you can use to get this up and running in your own environment, you’ll find the following scripts:</p>

<ul>
  <li>Microsoft .NET Framework 4 Full</li>
  <li>Citrix XenApp 6.5</li>
  <li>Citrix XenApp 6.5 Hotfixes</li>
  <li>Citrix Provisioning Services Device Target x64</li>
  <li>Citrix XenConvert x64 2.x</li>
  <li>Convert XenApp PVS Image</li>
</ul>

<p>Import each of these as a separate application into the Applications folder in the MDT Workbench. Create a new application and choose ‘Application with source files’ and choose each script folder as the source directory.</p>

<p>You’ll then need to download the binaries for each application. Each script expects those binaries to be in the same folder as the script.</p>

<h2 id="microsoft-net-framework-4-full">Microsoft .NET Framework 4 Full</h2>

<p>This script will, of course, install the .NET Framework 4.0, required by Citrix XenConvert.</p>

<h2 id="citrix-xenapp-65">Citrix XenApp 6.5</h2>

<p>The included script will install and configure XenApp 6.5 as a Worker (or session-host only mode) and join an existing farm. You’ll need to pay particular attention to the options included in this script as options such as XenApp edition, agents installed, farm name and credentials etc. Additionally you’ll have to create DSN file to reference the database server that hosts the XenApp data store.</p>

<h2 id="citrix-xenapp-hotfixes">Citrix XenApp Hotfixes</h2>

<p>The approach used to install XenApp updates is very simple – the script will install every MSI and MSP file in the same folder as the script. That way you can add and remove hotfixes without changing the script.</p>

<h2 id="citrix-provisioning-services-device-target-x64">Citrix Provisioning Services Device Target x64</h2>

<p>Installing and updating the PVS device target software is always a barrel of laughs, so I’ve attempted to keep this script as simple as possible.</p>

<h2 id="citrix-xenconvert-x64-2x">Citrix XenConvert x64 2.x</h2>

<p>XenConvert is straightforward to install and there’s nothing special in this script, just a silent install of XenConvert.</p>

<h2 id="convert-xenapp-pvs-image">Convert XenApp PVS Image</h2>

<p>This is the script that runs at the end of the deployment and uses XenConvert to convert the current server into a PVS image. It essentially configures the local Windows instance and automates the XenConvert wizard.</p>

<p>The script implements a number of optimisations gathered from the XenConvert wizard and a couple of other sources. These include:</p>

<ul>
  <li>Registry changes (via REG.EXE) implemented by the XenConvert wizard</li>
  <li>Runs the .NET Framework <a href="http://en.wikipedia.org/wiki/Native_Image_Generator">NGEN</a> utility to generate native images</li>
  <li>Various other optimisations including disabling the boot animation, sets the High Performance power scheme etc</li>
  <li>Rearms Windows and Office</li>
</ul>

<p>The final lines in the script then perform a few steps:</p>

<ol>
  <li>Disables auto admin logon</li>
  <li>Converts the image using XenConvert</li>
  <li>Deletes the MDT scripts folder (\MININT) from the converted image</li>
  <li>Re-enables auto admin logon</li>
</ol>

<p>These steps are required because the conversion occurs while the MDT task sequence is still running. We want the resulting image to not include the MDT components without breaking the currently executing task sequence.</p>

<h1 id="finally">Finally</h1>

<p>It’s my view that Provisioning Services is a great tool for rapid deployment of an image, preventing service change creep and an excellent solution for managing read IO; however it is not a replacement for automating the creation of a gold image.</p>

<p>Combining a tool such as MDT with PVS creates a framework for the management of the entire lifecycle of your XenApp (or even virtual Windows 7 desktop) images. Automating the end to end creation and delivery of an image takes effort, but it gives you a transparent, consistent and repeatable approach.</p>

<p>I’ve laid out the framework, now go forth and automate.</p>

  </div><a class="u-url" href="/hands-off-my-gold-image-the-scripts/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">stealthpuppy</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">stealthpuppy</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/aaronparker"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">aaronparker</span></a></li><li><a href="https://www.twitter.com/stealthpuppy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">stealthpuppy</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>on end user computing and enterprise mobility
</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
