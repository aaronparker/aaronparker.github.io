<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Measuring the Impact of Folder Redirection - User Logon | aaron parker</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Measuring the Impact of Folder Redirection - User Logon" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This is the forth in a series of articles on folder redirection by Aaron Parker, Helge Klein and Shawn Bass." />
<meta property="og:description" content="This is the forth in a series of articles on folder redirection by Aaron Parker, Helge Klein and Shawn Bass." />
<link rel="canonical" href="/measure-impact-folder-redirection/" />
<meta property="og:url" content="/measure-impact-folder-redirection/" />
<meta property="og:site_name" content="aaron parker" />
<meta property="og:image" content="/wp-content/uploads/2014/11/measure-624x344.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-11-19T10:29:42+11:00" />
<script type="application/ld+json">
{"description":"This is the forth in a series of articles on folder redirection by Aaron Parker, Helge Klein and Shawn Bass.","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/measure-impact-folder-redirection/","image":"/wp-content/uploads/2014/11/measure-624x344.png","headline":"Measuring the Impact of Folder Redirection - User Logon","dateModified":"2014-11-19T10:29:42+11:00","datePublished":"2014-11-19T10:29:42+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"/measure-impact-folder-redirection/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="aaron parker" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">aaron parker</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">ABOUT</a><a class="page-link" href="/smb-not-cifs.html">SMB not CIFS</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Measuring the Impact of Folder Redirection - User Logon</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2014-11-19T10:29:42+11:00" itemprop="datePublished">Nov 19, 2014
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><em>This is the forth in a series of articles on folder redirection by Aaron Parker, <a href="https://helgeklein.com/">Helge Klein</a> and <a href="http://shawnbass.com/">Shawn Bass</a>.</em></p>

<ul>
  <li>Part one: <a href="https://helgeklein.com/blog/2014/10/folder-redirection-impacts-ux-breaks-applications">How Folder Redirection Impacts UX &amp; Breaks Applications</a></li>
  <li>Part two: <a href="http://stealthpuppy.com/visualizing-impact-folder-redirection-logon/">Visualizing the Impact of Folder Redirection – Logon and Application Launch</a></li>
  <li>Part three: <a href="https://helgeklein.com/blog/2014/11/visualizing-impact-folder-redirection-start-menu-search/">Visualizing the Impact of Folder Redirection – Start Menu Search</a></li>
  <li>Part four: this article</li>
  <li>Part five: <a href="https://helgeklein.com/blog/2014/12/measuring-impact-folder-redirection-application-launch-smb-version/">Measuring the Impact of Folder Redirection – Application Launch &amp; SMB Version</a></li>
</ul>

<h1 id="previously-in-this-series">Previously in this Series</h1>

<p>So far in this series on folder redirection, we’ve covered <a href="https://helgeklein.com/blog/2014/10/folder-redirection-impacts-ux-breaks-applications">the basics of how folder redirection works</a>, what <a href="http://stealthpuppy.com/visualizing-impact-folder-redirection-logon/">the impact of folder redirection is on logon and application launch</a> and in the previous article, <a href="https://helgeklein.com/blog/2014/11/visualizing-impact-folder-redirection-start-menu-search/">Helge covered the impact on search in the Start menu</a>. In this article, we’ll focus on actual measurements of that impact.</p>

<h1 id="measuring-the-impact-on-logon-performance">Measuring the Impact on Logon Performance</h1>

<p>To measure the impact on performance of different configurations, including different profile sizes, folder redirection enabled or disabled and the file server under different stress conditions, we’ve used Helge’s own <a href="https://helgeklein.com/uberagent-for-splunk/">uberAgent</a> in each of our environments. So while each environment was different, we’ve used the same methodology to measure the impact.</p>

<p>When we discuss profile sizes we referring to both the total size of the profile as well as the number of files in the profile. For these tests, we have 3 profile sizes:</p>

<ul>
  <li><strong>Small</strong>: 114 files, 4.69 MB</li>
  <li><strong>Medium</strong>: 1,461 files, 19.9 MB</li>
  <li><strong>Large</strong>: 2,334 files, 33.7 MB</li>
</ul>

<p>Before capturing metrics, each user account/profile has completed the first logon. The environment used consisted of Citrix XenApp 6.5 (Windows Server 2008 R2) with locally cached profiles deleted at logoff. The file server was running Windows Server 2008 R2.</p>

<h2 id="logon-times-of-different-profile-sizes-and-no-folder-redirection">Logon Times of Different Profile Sizes and No Folder Redirection</h2>

<p>The following graph shows the logon time of user account configured for a roaming profile and with no folder redirection configured. We’ve averaged the logon times over a number of tests for small, medium and large roaming user profiles.</p>

<figure id="attachment_3772" aria-describedby="caption-attachment-3772" style="width: 1702px" class="wp-caption alignnone">[<img class="wp-image-3772 size-full" src="http://stealthpuppy.com/wp-content/uploads/2014/11/roaming-profile.png" alt="" width="1702" height="1078" srcset="https://stealthpuppy.com/wp-content/uploads/2014/11/roaming-profile.png 1702w, https://stealthpuppy.com/wp-content/uploads/2014/11/roaming-profile-150x95.png 150w, https://stealthpuppy.com/wp-content/uploads/2014/11/roaming-profile-300x190.png 300w, https://stealthpuppy.com/wp-content/uploads/2014/11/roaming-profile-1024x648.png 1024w, https://stealthpuppy.com/wp-content/uploads/2014/11/roaming-profile-624x395.png 624w" sizes="(max-width: 1702px) 100vw, 1702px" />](http://stealthpuppy.com/wp-content/uploads/2014/11/roaming-profile.png)<figcaption id="caption-attachment-3772" class="wp-caption-text">Logon impact of profile sizes with no folder redirection*&lt;/figure&gt;

This shows a predictable increase in logon time as the profile grows - the larger the profile, the longer the logon time takes. In this case, because we're using roaming profiles with no folder redirection, the entire profile is copied locally at user logon.

## Logon Times of Different Profile Sizes with Folder Redirection Enabled

Let's use the same tests (same user account with the same small, medium and large profiles) and enable folder redirection for each of the user profile folders.

<figure id="attachment_3771" aria-describedby="caption-attachment-3771" style="width: 1700px" class="wp-caption alignnone">[<img class="wp-image-3771 size-full" src="http://stealthpuppy.com/wp-content/uploads/2014/11/folder-redirection.png" alt="" width="1700" height="1086" srcset="https://stealthpuppy.com/wp-content/uploads/2014/11/folder-redirection.png 1700w, https://stealthpuppy.com/wp-content/uploads/2014/11/folder-redirection-150x95.png 150w, https://stealthpuppy.com/wp-content/uploads/2014/11/folder-redirection-300x191.png 300w, https://stealthpuppy.com/wp-content/uploads/2014/11/folder-redirection-1024x654.png 1024w, https://stealthpuppy.com/wp-content/uploads/2014/11/folder-redirection-624x398.png 624w" sizes="(max-width: 1700px) 100vw, 1700px" />](http://stealthpuppy.com/wp-content/uploads/2014/11/folder-redirection.png)<figcaption id="caption-attachment-3771" class="wp-caption-text">Logon impact of profile sizes with folder redirection*&lt;/figure&gt;

In this test, there is no statistically significant difference between logon times. The reason for a more consistent logon time is that with folder redirection, we aren't copying data locally at logon, other than the user's registry (NTUSER.DAT). In these tests, there won't be much difference in the size of the registry, therefore the logon times are similar.

## Logon Times of Different Profile Sizes with Citrix Profile Management

If we again use the same user profiles, but instead of folder redirection, we utilise Citrix Profile Management (CPM), then the results of the logon tests look like this:

<figure id="attachment_3770" aria-describedby="caption-attachment-3770" style="width: 1677px" class="wp-caption alignnone">[<img class="wp-image-3770 size-full" src="http://stealthpuppy.com/wp-content/uploads/2014/11/citrix-profile-management.png" alt="" width="1677" height="1082" srcset="https://stealthpuppy.com/wp-content/uploads/2014/11/citrix-profile-management.png 1677w, https://stealthpuppy.com/wp-content/uploads/2014/11/citrix-profile-management-150x96.png 150w, https://stealthpuppy.com/wp-content/uploads/2014/11/citrix-profile-management-300x193.png 300w, https://stealthpuppy.com/wp-content/uploads/2014/11/citrix-profile-management-1024x660.png 1024w, https://stealthpuppy.com/wp-content/uploads/2014/11/citrix-profile-management-624x402.png 624w" sizes="(max-width: 1677px) 100vw, 1677px" />](http://stealthpuppy.com/wp-content/uploads/2014/11/citrix-profile-management.png)<figcaption id="caption-attachment-3770" class="wp-caption-text">Logon impact of profile sizes with Citrix Profile Management*&lt;/figure&gt;

The logon times are much better than roaming profiles and more consistent like with folder redirection enabled, but the differences in variation are a little more expressed.

The improvement in logon times over roaming profiles are significant for the medium and large profiles with the similarity in logon times across all three profiles types being down to the similar amount of data required to get the profile down and the desktop loaded (user registry and files immediately accessed). CPM will continue to stream the remainder of the profile down in the background, so perhaps initial application launch may be affected.

# Measuring the Impact on File Server Load on Logon Performance

We've looked at different types of profile and folder redirection configurations which have produced reasonable results for logon performance, but each test was done with the file server hosting the user profile or the redirected folders in an idle state.

Let's look at what happens if the file server is under 0% (idle), 80% and 99% CPU load. I've covered some common reasons for [file server CPU load in my previous article](http://stealthpuppy.com/visualizing-impact-folder-redirection-logon/), but as a refresher these could include AV scans, run away processes, servicing a large number of SMB requests, or CPU resource contention.

## Logon Times of Different Profile Sizes and No Folder Redirection

With the first test, we'll again use standard roaming user profiles and no folder redirection configured, so the entire profile is copied to the Windows desktop at logon.

<figure id="attachment_3768" aria-describedby="caption-attachment-3768" style="width: 1703px" class="wp-caption alignnone">[<img class="wp-image-3768 size-full" src="http://stealthpuppy.com/wp-content/uploads/2014/11/roaming-profile-file-server-load1.png" alt="" width="1703" height="1083" srcset="https://stealthpuppy.com/wp-content/uploads/2014/11/roaming-profile-file-server-load1.png 1703w, https://stealthpuppy.com/wp-content/uploads/2014/11/roaming-profile-file-server-load1-150x95.png 150w, https://stealthpuppy.com/wp-content/uploads/2014/11/roaming-profile-file-server-load1-300x190.png 300w, https://stealthpuppy.com/wp-content/uploads/2014/11/roaming-profile-file-server-load1-1024x651.png 1024w, https://stealthpuppy.com/wp-content/uploads/2014/11/roaming-profile-file-server-load1-624x396.png 624w" sizes="(max-width: 1703px) 100vw, 1703px" />](http://stealthpuppy.com/wp-content/uploads/2014/11/roaming-profile-file-server-load1.png)<figcaption id="caption-attachment-3768" class="wp-caption-text">Logon impact of profile sizes with roaming profiles and file server under load*&lt;/figure&gt;

This produces some interesting results - with a small roaming profile, there's little impact on logon times when the file server CPU is at 80%, but for each of the remaining tests, we can see that file server CPU load, even at 80%, more than doubles the logon time.

When the file server effectively runs out of CPU resources (at 99%) the direct effect on the user experience is clearly visible. For the medium profile, there's a 1200% increase in logon time and for the large profile, a 2071% increase! Don't let your file server/s run out of CPU resources.

## Logon Times of Different Profile Sizes with Folder Redirection Enabled

The same CPU load tests run again with folder redirection now enabled on the same user profiles. Folder redirection helps to even out the results when compared to the previous test.

<figure id="attachment_3774" aria-describedby="caption-attachment-3774" style="width: 1703px" class="wp-caption alignnone">[<img class="size-full wp-image-3774" src="http://stealthpuppy.com/wp-content/uploads/2014/11/folder-redirection-file-server-load.png" alt="Logon impact of profile sizes with folder redirection enabled and file server under load" width="1703" height="1083" srcset="https://stealthpuppy.com/wp-content/uploads/2014/11/folder-redirection-file-server-load.png 1703w, https://stealthpuppy.com/wp-content/uploads/2014/11/folder-redirection-file-server-load-150x95.png 150w, https://stealthpuppy.com/wp-content/uploads/2014/11/folder-redirection-file-server-load-300x190.png 300w, https://stealthpuppy.com/wp-content/uploads/2014/11/folder-redirection-file-server-load-1024x651.png 1024w, https://stealthpuppy.com/wp-content/uploads/2014/11/folder-redirection-file-server-load-624x396.png 624w" sizes="(max-width: 1703px) 100vw, 1703px" />](http://stealthpuppy.com/wp-content/uploads/2014/11/folder-redirection-file-server-load.png)<figcaption id="caption-attachment-3774" class="wp-caption-text">Logon impact of profile sizes with folder redirection enabled and file server under load*&lt;/figure&gt;

At 80% load on the file server, there's an impact on the logon. Users sensitive to changes in logon times will probably notice, but I suspect that the majority of users would not be affected.

However, looking at scenarios when the file server runs out of CPU resources (around 99%), it is just unable to service SMB requests in a reasonable time and the user logon times more than triple or quadruple.

Even though we've implemented folder redirection, by itself it's not a silver bullet. It helps considerably for large profiles, but once the file serve is busy, users will see the impact on performance.

## Logon Times of Different Profile Sizes with Citrix Profile Management

Let's look again at the effectiveness of a streaming approach to profile and data access instead of folder redirection, while the file server is under load.

<figure id="attachment_3776" aria-describedby="caption-attachment-3776" style="width: 1703px" class="wp-caption alignnone">[<img class="size-full wp-image-3776" src="http://stealthpuppy.com/wp-content/uploads/2014/11/citrix-profile-management-file-server-load.png" alt="Logon impact of profile sizes with Citrix Profile Management and file server under load" width="1703" height="1082" srcset="https://stealthpuppy.com/wp-content/uploads/2014/11/citrix-profile-management-file-server-load.png 1703w, https://stealthpuppy.com/wp-content/uploads/2014/11/citrix-profile-management-file-server-load-150x95.png 150w, https://stealthpuppy.com/wp-content/uploads/2014/11/citrix-profile-management-file-server-load-300x190.png 300w, https://stealthpuppy.com/wp-content/uploads/2014/11/citrix-profile-management-file-server-load-1024x650.png 1024w, https://stealthpuppy.com/wp-content/uploads/2014/11/citrix-profile-management-file-server-load-624x396.png 624w" sizes="(max-width: 1703px) 100vw, 1703px" />](http://stealthpuppy.com/wp-content/uploads/2014/11/citrix-profile-management-file-server-load.png)<figcaption id="caption-attachment-3776" class="wp-caption-text">Logon impact of profile sizes with Citrix Profile Management and file server under load*&lt;/figure&gt;

What's interesting here, is that where folder redirection reduced the differences between the logon times of the different profiles sizes, Citrix Profile Management does not. This can be explained by the need to transfer additional file data locally. Files are streamed to the client as they are accessed, so it's likely that more data is transferred than when using folder redirection.

This approach is still a significant improvement over roaming user profiles. So, if you combine folder redirection and profile management, you should get the best of both worlds to improve the logon experience.

But... don't let your file server run out of CPU resources.

# Conclusion

Based on these results, we can see the benefits of enabling folder redirection, especially if you're using roaming user profiles. Combining folder redirection with 3rd party profile management solutions should further improve the logon experience.

For hosted desktop customers (Citrix XenApp, XenDesktop, VMware Horizon etc.) there are usually inbox solutions to profile management; however for physical desktops 3rd party licensing is often required (or UE-V is available as a part of MDOP).

Whatever the approach, these are only parts of the equation, as we've seen, file server performance is crucial to providing good user experience. More importantly, consistent file server performance is important.

Logon storms, transient environment issues and undersized file servers can have a direct impact on logon times.

<figure id="attachment_3778" aria-describedby="caption-attachment-3778" style="width: 347px" class="wp-caption alignnone"><img class="wp-image-3778 size-full" src="http://stealthpuppy.com/wp-content/uploads/2014/11/ComputerDumpster.gif" alt="ComputerDumpster" width="347" height="200" /><figcaption id="caption-attachment-3778" class="wp-caption-text">Long logon times makes users unhappy...*&lt;/figure&gt;
</figcaption></figure></figcaption></figure></figcaption></figure></figcaption></figure></figcaption></figure></figcaption></figure></figcaption></figure>

  </div><a class="u-url" href="/measure-impact-folder-redirection/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">aaron parker</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">{&quot;name&quot;=&gt;&quot;Aaron Parker&quot;, &quot;location&quot;=&gt;&quot;Melbourne, Australia&quot;, &quot;email&quot;=&gt;&quot;aaron@stealthpuppy.com&quot;, &quot;github&quot;=&gt;&quot;aaronparker&quot;, &quot;linkedin&quot;=&gt;&quot;aaronedwardparker&quot;, &quot;twitter&quot;=&gt;&quot;stealthpuppy&quot;}</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/aaronparker"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">aaronparker</span></a></li><li><a href="https://www.twitter.com/stealthpuppy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">stealthpuppy</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>on end user computing and enterprise mobility
</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
