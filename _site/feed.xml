<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.5">Jekyll</generator><link href="/feed.xml" rel="self" type="application/atom+xml" /><link href="/" rel="alternate" type="text/html" /><updated>2019-04-09T09:49:05+10:00</updated><id>/feed.xml</id><title type="html">stealthpuppy</title><subtitle>on end user computing and enterprise mobility</subtitle><entry><title type="html"></title><link href="/2019/04/09/2007-02-13-software-quality-whats-that.html" rel="alternate" type="text/html" title="" /><published>2019-04-09T09:49:05+10:00</published><updated>2019-04-09T09:49:05+10:00</updated><id>/2019/04/09/2007-02-13-software-quality-whats-that</id><content type="html" xml:base="/2019/04/09/2007-02-13-software-quality-whats-that.html">&lt;p&gt;I’ve seen some dumb software in my travels and &lt;a href=&quot;http://www.mercury.com/us/products/quality-center/&quot;&gt;Mercury Quality Center&lt;/a&gt; is no exception; however this one has got me scratching my head.&lt;/p&gt;

&lt;p&gt;Mercury Quality Center “provides a web-based system for &lt;em&gt;automated&lt;/em&gt; software quality testing and management”. It uses a browser front-end with ActiveX controls connecting to a back-end process (I really don’t know much about the back-end). Now, as you would expect from the product description, Mercury Quality Center should be a nice quality package from end to end. In my view this would include a scriptable client installation package. Scripting any client software installation is important because it should be a consistent repeatable process.&lt;/p&gt;

&lt;p&gt;Except that’s where they strike out. The incredibly dumb thing about this is the client software is packaged up in an &lt;em&gt;InstallShield&lt;/em&gt; package which is only used to unpack some files and launch another custom installer. (See the screenshot). No silent install for you!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://stealthpuppy.com/wp-content/uploads/2007/02/1000.14.897.MercuryQualityCenterInstall.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Who’s the dolt who created this? InstallShield’s not good enough to install your software? Surely quality software should extend to the installation experience as well? It makes you wonder.&lt;/p&gt;</content><author><name></name></author></entry><entry><title type="html"></title><link href="/2019/04/09/2007-01-18-ts-logon-issues-its-not-what-you-think.html" rel="alternate" type="text/html" title="" /><published>2019-04-09T09:49:05+10:00</published><updated>2019-04-09T09:49:05+10:00</updated><id>/2019/04/09/2007-01-18-ts-logon-issues-its-not-what-you-think</id><content type="html" xml:base="/2019/04/09/2007-01-18-ts-logon-issues-its-not-what-you-think.html">&lt;p&gt;Every six to eight months or so, I have an issue logging onto a Terminal Server and then have to research the issue each time from scratch because I can’t remember how I fixed it. Here’s how it starts - after logging onto a Terminal Server I receive the following helpful error message:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;To log on to this computer, you must have Terminal Server User Access permissions on this computer. By default, members of the Remote Desktop Users group have these permissions. If you are not a member of the Remote Desktop User group or another group that has these permissions, or if the Remote Desktop User group does not have these permissions, you must be granted these permissions manually.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;After troubleshooting by checking and double checking that the account I am using has the correct privileges to login remotely, I realise that I can still login to the console via MSTSC /CONSOLE. Sounds like licensing, so sure enough in the System log; an event with ID 1010 from source TermService is logged:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The terminal server could not locate a license server. Confirm that all license servers on the network are registered in WINS/DNS, accepting network requests, and the Terminal Server Licensing Service is running.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Fixing the licensing issue fixes the logon issue and I can logon to the server remotely, but I’ve still wasted a 1/2 hour troubleshooting because the original error message lead me in a wrong direction. Surely Windows could present a dialog detailing the correct problem rather than something else completely, especially given that it logs a licensing related event at the same time.&lt;/p&gt;

&lt;p&gt;The Citrix support site has detailed documents on troubleshooting Terminal Server logon issues, far better than anything I could find on the Microsoft support site:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://support.citrix.com/article/CTX106920&quot;&gt;CTX106920 - Error: You do not have access to logon to this Session….&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://support.citrix.com/article/CTX564283&quot;&gt;CTX564283 - Troubleshooting 1003 and 1004 Terminal Server Licensing Errors&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author></entry><entry><title type="html"></title><link href="/2019/04/09/2006-12-07-access-gateway-vs-secure-gateway-part-2-its-in-the-details.html" rel="alternate" type="text/html" title="" /><published>2019-04-09T09:49:05+10:00</published><updated>2019-04-09T09:49:05+10:00</updated><id>/2019/04/09/2006-12-07-access-gateway-vs-secure-gateway-part-2-its-in-the-details</id><content type="html" xml:base="/2019/04/09/2006-12-07-access-gateway-vs-secure-gateway-part-2-its-in-the-details.html">&lt;p&gt;In &lt;a href=&quot;http://www.stealthpuppy.com/blogs/travelling/archive/2006/10/24/Access-Gateway-vs-Secure-Gateway-and-a-case-of-mistaken-Identity.aspx&quot;&gt;part 1&lt;/a&gt; I discussed how I believe that proving identity should be your most important consideration when deciding to implement the Citrix Access Gateway or Secure Gateway for remote access. In this second part I want to discuss some of the features of both the Access Gateway (CAG) and the Secure Gateway (CSG) and how they compare.&lt;/p&gt;

&lt;h2 id=&quot;licensing&quot;&gt;Licensing&lt;/h2&gt;

&lt;p&gt;One of the biggest differences between these two solutions is licensing. CSG comes as a part of Presentation Server and does not require any additional licensing. You will have to pay for a Windows Server license on which to run CSG however. The CAG, on the other hand, uses concurrent user licenses that are purchased separately to your Presentation Server licenses. You will also have to purchase the CAG hardware as the license agreement prohibits you from running the CAG software on any device not purchased from Citrix.&lt;/p&gt;

&lt;h2 id=&quot;presentation-server-integration&quot;&gt;Presentation Server Integration&lt;/h2&gt;

&lt;p&gt;Strictly speaking, Presentation Server is not integrated into either the CAG or the CSG, though they do both provide an SSL relay function to Presentation Server. User interface access to published applications is provided via Web Interface (WI) or Advanced Access Control (AAC, a component of Access Gateway Advanced Edition). What the CAG has over the CSG is integration with AAC. AAC makes it simple to control what users can do in their ICA sessions and what applications are available externally. In this sense, it’s easier to manage application access via AAC than it is via CAG and WI or CSG and WI alone.&lt;/p&gt;

&lt;h2 id=&quot;other-features&quot;&gt;Other Features&lt;/h2&gt;

&lt;p&gt;This is where the similarities between the two gateway solutions end. Secure Gateway does not offer any of the advanced features of the Access Gateway such as:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;SSL: this is essentially a Winsock redirector client that’s improves on an L2TP/IPSec or PPTP VPN by not relying on routes and using SSL only;&lt;/li&gt;
  &lt;li&gt;Web Application Access: users can access internal web applications including integration with SharePoint Server;&lt;/li&gt;
  &lt;li&gt;Web-based File Share Access: users are able access internal file shares via a web browser with access to features such as uploading files control depending on the access scenario. Word, Excel, PowerPoint, Visio and PDF files can also be viewed directly in the browser without the requirement for local applications;&lt;/li&gt;
  &lt;li&gt;Web-based E-mail: provide users integrated access to Outlook Web Access or iNotes. Citrix also provides a custom interface which allows the administrator to define what users can do in their session such as downloading attachments.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;If you are looking to implement remote access with either of the Citrix offerings, don’t listen to the hype - choose the option that best fits. Before you choose the Access Gateway (and I’m sure you’ll be happy you did) answer the question of user identity first. I recommend starting &lt;a href=&quot;http://www.citrix.com/English/ps2/products/feature.asp?contentID=26143&quot;&gt;here&lt;/a&gt; for information on the Access Gateway.&lt;/p&gt;</content><author><name></name></author></entry><entry><title type="html"></title><link href="/2019/04/09/2006-10-31-now-thats-not-what-i-expected.html" rel="alternate" type="text/html" title="" /><published>2019-04-09T09:49:05+10:00</published><updated>2019-04-09T09:49:05+10:00</updated><id>/2019/04/09/2006-10-31-now-thats-not-what-i-expected</id><content type="html" xml:base="/2019/04/09/2006-10-31-now-thats-not-what-i-expected.html">&lt;p&gt;I’ve been checking out the excellent &lt;a href=&quot;http://www.ultramon.com/&quot;&gt;UltraMon&lt;/a&gt; on Windows Vista, which provides some cool hacks for multiple displays under Windows. One of the excellent hacks is the ability to assign a hotkey that moves an application between screens - when you hit the hotkey the application or window appears on the next screen, very handy. However, this appears to work on the Start Menu too. I’m not sure if this happens on Windows XP but here’s what you get with the Start Menu open and then hit the hotkey:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://stealthpuppy.com/wp-content/uploads/2007/06/1000_14_167_startmenu1.jpg&amp;quot;&quot; alt=&quot;Start menu&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When you hit the hotkey again you get this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://stealthpuppy.com/wp-content/uploads/2007/06/1000_14_168_startmenu2.jpg&quot; alt=&quot;Start menu&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As you can see the user tile stays where it is and if you keep hitting your hotkey the start menu moves back and forth between these two locations. It must be a feature ;).&lt;/p&gt;</content><author><name></name></author></entry><entry><title type="html"></title><link href="/2019/04/09/2006-07-18-citrix-aac-and-microsofts-nap.html" rel="alternate" type="text/html" title="" /><published>2019-04-09T09:49:05+10:00</published><updated>2019-04-09T09:49:05+10:00</updated><id>/2019/04/09/2006-07-18-citrix-aac-and-microsofts-nap</id><content type="html" xml:base="/2019/04/09/2006-07-18-citrix-aac-and-microsofts-nap.html">&lt;p&gt;One of the great features of Citrix Advanced Access Control is the ability to control access to internal resources from trusted machines with End Point Analysis. Citrix have implemented their own client and server components to perform end-point analysis and ensure that client machines are safe for access.&lt;/p&gt;

&lt;p&gt;Microsoft are implementing their own tools for controlling access to the network with &lt;a href=&quot;http://www.microsoft.com/nap&quot;&gt;Network Access Protection&lt;/a&gt;. Microsoft are touting NAP as a platform rather than a product. Third parties will be able to extend NAP with server components (Symantec for example, will be able to make their AntiVirus server NAP aware). The client from Microsoft will be integrated into Windows Vista and Longhorn Server, plus supported on Windows XP Service Pack 2 and Windows Server 2003 Service Pack 1. Support for third party clients will also be made available (from 3rd party vendors, not Microsoft), so that NAP can be extended to Linux and Mac OS machines.&lt;/p&gt;

&lt;p&gt;Given the fairly broad install base that the NAP client will eventually enjoy and what I expect to be broad support from third party vendors, surely it would be advantageous to remove the End Point Analysis components from AAC and support NAP instead. This way AAC could interoperate with complete platform including any components that will extend NAP beyond what is out if the box. AAC could also then support other clients rather than just Windows 2000 Service Pack 4 and Windows XP Service Pack 2 that the current version supports. As as network engineer, it would be far simpler to support a single policy framework.&lt;/p&gt;

&lt;p&gt;There’s a reasonably detailed webcast about NAP worth checking out that can be found &lt;a href=&quot;https://www118.livemeeting.com/cc/mseventsbmo/view?id=1032297525&amp;amp;role=attend&amp;amp;pw=63A049C8&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</content><author><name></name></author></entry><entry><title type="html"></title><link href="/2019/04/09/2006-05-22-we-dont-need-no-stinking-anti-virus.html" rel="alternate" type="text/html" title="" /><published>2019-04-09T09:49:05+10:00</published><updated>2019-04-09T09:49:05+10:00</updated><id>/2019/04/09/2006-05-22-we-dont-need-no-stinking-anti-virus</id><content type="html" xml:base="/2019/04/09/2006-05-22-we-dont-need-no-stinking-anti-virus.html">&lt;p&gt;I’ve recently had conversations about running anti-virus software on some specialised servers. Specifically Windows Servers running ISA Server 2004 or VMware Server (or Virtual Server). The argument for installing anti-virus software on these servers is to ensure they are protected against viruses and worms. I’ve been arguing against installing anti-virus software to ensure maximum performance. The reasons I have argued against are the following:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;The server should utilise a known, good configuration. That is, a scripted build so that installation can be repeated or easily documented, and good change management;&lt;/li&gt;
  &lt;li&gt;Other than services, code should not be executed on the server. The administrator should never browse the Internet on the server, for example;&lt;/li&gt;
  &lt;li&gt;A patch managment process should be in place to keep the operating system and applications current;&lt;/li&gt;
  &lt;li&gt;A host-based firewall should be implemented (ISA Server 2004 firewalls all interfaces). Firewall rules should be stringent, only allowing trusted traffic to the host;&lt;/li&gt;
  &lt;li&gt;Management of the servers should be performed remotely with the administration tools installed on an administrators workstation. It could be argued, however, that for ISA Server, perhaps only allowing RDP inbound would be more secure.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;I don’t run anti-virus software on my home machine - I actually haven’t done for about two years. It comes down to how the machine is used:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The Windows XP host-based firewall is enabled;&lt;/li&gt;
  &lt;li&gt;The machine is patched and applications are kept up-to-date as well;&lt;/li&gt;
  &lt;li&gt;I use a second copy of Windows XP in a VM to test software and control what is installed on the host;&lt;/li&gt;
  &lt;li&gt;E-mail is scanned before being downloaded locally.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The point is controlling what can run rather than attempting to control what cannot run. Apparently this is the way the original version of Norton AntiVirus worked, until they found there was more money in definition updates. Windows XP and Windows Server 2003 include &lt;a href=&quot;http://technet2.microsoft.com/WindowsServer/en/Library/90b75a83-bca7-4871-a661-d67eafcfd86c1033.mspx&quot;&gt;Software Restriction Policy&lt;/a&gt; that can be used to define what software can run on a system. This is not a new concept, but it make far more sense than, in this age of 0 day exploits, ensuring definitions are up-to-date.&lt;/p&gt;

&lt;p&gt;Software Restriction Policy can be a challenge to implement in complex scenarios, however there are a number of third party tools available, including &lt;a href=&quot;http://www.appsense.com/default.asp&quot;&gt;AppSense Application Manager&lt;/a&gt; (excellent gear) and &lt;a href=&quot;http://www.desktopstandard.com/PolicyMakerApplicationSecurity.aspx&quot;&gt;DesktopStandard PolicyMaker Application Security&lt;/a&gt; (haven’t tested this tool yet). I’ve also come across &lt;a href=&quot;http://force.coresecurity.com/&quot;&gt;Core Force&lt;/a&gt;. This tool is free but only for the technically advanced.&lt;/p&gt;</content><author><name></name></author></entry><entry><title type="html"></title><link href="/2019/04/09/2005-08-25-didnt-we-just-have-an-ad.html" rel="alternate" type="text/html" title="" /><published>2019-04-09T09:49:05+10:00</published><updated>2019-04-09T09:49:05+10:00</updated><id>/2019/04/09/2005-08-25-didnt-we-just-have-an-ad</id><content type="html" xml:base="/2019/04/09/2005-08-25-didnt-we-just-have-an-ad.html">&lt;p&gt;There are 3 reasons why I use Firefox:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Standards support;&lt;/li&gt;
  &lt;li&gt;Tabs;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://adblock.mozdev.org/&quot;&gt;Adblock&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Adblock makes using the Internet usable again by blocking unwanted elements in web pages and it does this very well. Unfortunately there is no version for Internet Explorer, and I’m painfully reminded of that everytime I go back to IE. You can utilise the HOSTS file but this is a little cumbersome. However I found &lt;a href=&quot;http://hostsman.abelhadigital.com/&quot;&gt;HostsMan&lt;/a&gt; via &lt;a href=&quot;http://www.mvps.org/winhelp2002/hosts.htm&quot;&gt;MVPS.org&lt;/a&gt; yesterday. This is a very well designed tool that works extremely well and allows for automatically downloading HOSTS lists from MVPS.org and &lt;a href=&quot;http://www.hosts-file.net/&quot;&gt;hpHosts&lt;/a&gt;, integrating this into your local HOSTS file and for quickly editing the hosts file. It even includes a HTTP server for serving a page for the blocked host (It listens on 127.0.0.x only).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://pwp.netcabo.pt/0413933601/abelhadigital/pics/hostsman201.jpg&amp;quot;&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This then got me thinking about blocking hosts in an ISA Server rule. At the moment I import the list via a custom VBScript into a domain set and create a rule to redirect access to those hosts to an internal web server that returns a simple white page. However, managment of the domain list is cumbersome when that list is very large. By using HostsMan, I could import the list into the local HOSTS file, create a rule that redirects all requests for some IP address, e.g. 172.16.100.200, configure the HOSTs file appropriately and voila! A nice easy method for blocking access to and maintaining a list of ad sites and even spyware/nasty sites. Would this be faster? ISA Server doesn’t have to check the domain set. Hmm.. need to test.&lt;/p&gt;</content><author><name></name></author></entry><entry><title type="html"></title><link href="/2019/04/09/2015-08-06-folder-redirection-2015-part-3.html" rel="alternate" type="text/html" title="" /><published>2019-04-09T09:49:05+10:00</published><updated>2019-04-09T09:49:05+10:00</updated><id>/2019/04/09/2015-08-06-folder-redirection-2015-part-3</id><content type="html" xml:base="/2019/04/09/2015-08-06-folder-redirection-2015-part-3.html">&lt;p&gt;This is a multi-part article detailing our testing results and presentations for the 2015 series on Folder Redirection:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://stealthpuppy.com/folder-redirection-2015-part-1/&quot;&gt;I’ve Got 99 Problems and Folder Redirection is Every One of Them. 2015 Testing Results. Part 1&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://stealthpuppy.com/folder-redirection-2015-part-2/&quot;&gt;I’ve Got 99 Problems and Folder Redirection is Every One of Them. 2015 Testing Results. Part 2&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;I’ve Got 99 Problems and Folder Redirection is Every One of Them. 2015 Testing Results. Part 3. (this article)&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;file-access-performance&quot;&gt;File Access Performance&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://twitter.com/magnarjohnsen&quot;&gt;Magnar Johnsen&lt;/a&gt; detailed an interesting scenario where application performance suffered when &lt;a href=&quot;http://j.mp/ini-smb&quot;&gt;moving a XenApp environment from Windows Server 2008 R2 to Windows Server 2o12 R2&lt;/a&gt;. Magnar documented the results of the changing of OS versions had on application performance - due to the way in which a specific application reads settings from an INI file, a mismatch between the client and server was creating file access performance issues.&lt;/p&gt;

&lt;p&gt;To replicate the testing, Helge wrote a small utility that can be used to simulate the file access performance by reading and writing from a file using different methods. The tool, &lt;a href=&quot;https://helgeklein.com/blog/2015/08/fileiotest-times-duration-file-io-operations/&quot;&gt;FileIOTest&lt;/a&gt; runs 4 different tests:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Write with custom function (creates a file and writes &lt;em&gt;iteration&lt;/em&gt; lines individually opening and closing the handle for each line)&lt;/li&gt;
  &lt;li&gt;ReadPrivateProfileString (calls the GetPrivateProfileString API to read &lt;em&gt;iteration&lt;/em&gt; lines individually)&lt;/li&gt;
  &lt;li&gt;Read with custom function (opens the file once and reads &lt;em&gt;iteration&lt;/em&gt; lines individually)&lt;/li&gt;
  &lt;li&gt;Create/delete loop (creates the file, writes one line, deletes the file. This happens &lt;em&gt;iteration&lt;/em&gt; times)&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;This is useful for testing this scenario and is quite flexible:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Can be pointed at any UNC path (makes comparing different targets easy)&lt;/li&gt;
  &lt;li&gt;All file names generated are unique&lt;/li&gt;
  &lt;li&gt;Iteration count was 10,000&lt;/li&gt;
  &lt;li&gt;Antivirus off on client &amp;amp; server (otherwise you measure AV not SMB performance)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This testing showed that file IO performance is generally not significantly impacted by client and server SMB versions. As long as both are capable of SMB 2.x or better performance is stable. The chart below details the results across 4 scenarios:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Both client and server capable of using (and having negotiated) SMB 3.02&lt;/li&gt;
  &lt;li&gt;The client capable of using SMB 3.02 (Windows 8.1), but the server only capable of SMB 2.1 (Windows Server 2008 R2)&lt;/li&gt;
  &lt;li&gt;The client only capable of using SMB 2.1 (Windows Server 2008 R2), but the server able to use SMB 3.02 (Windows Server 2012 R2)&lt;/li&gt;
  &lt;li&gt;The client and server only able to use SMB 2.1 (both Windows Server 2008 R2)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The exception here is the API function GetPrivateProfileString() which performs significantly better when called on a client using SMB 2.1, targeting a server capable of SMB 3.02. SMB improvements in Windows Server 2012 R2 have actually benefited older clients, but seem to have had the reverse effect on more recent versions of Windows.&lt;/p&gt;

&lt;p&gt;While all VMs in our environments are patched via Windows Update, we did not get a chance to re-run the tests with all of the currently &lt;a href=&quot;https://support.microsoft.com/en-us/kb/2899011&quot;&gt;available hotfixes for file services&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://stealthpuppy.com/wp-content/uploads/2015/08/FileIOTests.png&quot; alt=&quot;SMB Versions Have Little Impact on IO Performance&quot; /&gt;&lt;em&gt;SMB Versions Have Little Impact on IO Performance&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;If you’re redirecting AppData, you’ll need to understand how your applications are interacting with files in the user profile. If they use this method (which is very common), performance could suffer as a result if you aren’t matching your client and server versions of Windows.&lt;/p&gt;

&lt;p&gt;One additional behaviour that we noticed, contrary to Magnar’s article, is that the negotiation between client and server only happens once, rather than for each file IO access. This can be shown by capturing traffic between client and server with a Wireshark trace. The screenshot below shows the protocol negotiation and then several read requests by the client to the server:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://stealthpuppy.com/wp-content/uploads/2015/08/GetPrivateProfileString.png&quot; alt=&quot;SMB Negotiations Occur only Once Per Session&quot; /&gt;&lt;em&gt;SMB Negotiations Occur only Once Per Session&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;recommendations&quot;&gt;Recommendations&lt;/h2&gt;

&lt;p&gt;Folder redirection is a feature that most environments will not be able to avoid. The various reasons including abstracting data or specific architecture choices for virtual or physical desktops, means that folder redirection will remain an integral part of the enterprise desktop. While there are a number of 3rd party alternatives and approaches, I may cover those in seperate articles.&lt;/p&gt;

&lt;p&gt;To that end, here are our recommendations for getting the best out of folder redirection. In no particular order:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Simulate client load to determine file server breaking point&lt;/strong&gt; - the &lt;a href=&quot;https://stealthpuppy.com/replicate-2015-folder-redirection-test/&quot;&gt;File Server Capacity Tool&lt;/a&gt; is, so far, the best solution I’ve seen for simulating user access to home folders. This is a useful tool for determining the expected load on your file server/s and working out the number of servers required to support your environment.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Multiple vCPUs in file servers&lt;/strong&gt; - file servers will require multiple CPUs to provide good performance. Servicing multiple simultaneous connections will require more than a single CPU - start with 2 and scale up as required.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Size for peaks&lt;/strong&gt; - just like we do with VDI workloads, size for your expected peaks to ensure continued good user experience as your environment becomes busy.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Hypervisor resource sharing, watch overcommit&lt;/strong&gt; - resource contention at multiple levels including storage and compute will impact how well file servers can response to requests.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Scale out&lt;/strong&gt; - Scaling out across multiple physical hosts and making sure you don’t over commit compute resources will ensure file servers remain responsive. Scaling out may require solutions such as &lt;a href=&quot;https://technet.microsoft.com/en-us/library/dn281957.aspx&quot;&gt;DFS&lt;/a&gt; and even third party solutions such as Citrix Melio might be worth investigating.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;High performance mode&lt;/strong&gt; - put hypervisor hosts in high performance mode to ensure good response for 4K and 8K blocks. You can schedule placing hosts into low performance mode after hours if power consumption is of concern.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Expect performance impacts of anti-virus&lt;/strong&gt; - there are very few environments that can do without anti-virus and the performance impact is very high as we’ve shown. Test various anti-virus solutions to find the best performing product if you can; however expect that AV will contribute to high CPU.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Update Windows versions, especially on servers&lt;/strong&gt; - best results might be gained from matching client and server, but we have shown that SMB 3+ reduces the CPU load on the file server.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Update client and servers&lt;/strong&gt; - keep clients and servers updated with the latest service packs and available hotfixes for folder redirection and file services. Here are some knowledgebase articles that are important references:
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://support.microsoft.com/en-us/kb/2820927&quot;&gt;Current hotfixes for Windows 7 SP1 enterprise clients that have folder redirection enabled&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://support.microsoft.com/en-us/kb/2899011&quot;&gt;List of currently available hotfixes for the File Services technologies in Windows Server 2012 and in Windows Server 2012 R2&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;These are general recommendations for all environments and depending on your own requirements and how you are managing your virtual or physical desktop estate, there may be additional considerations.&lt;/p&gt;

&lt;p&gt;We do continue to recommend looking at alternatives to AppData redirection - there are plenty of user environment management / profile management solutions available to you.&lt;/p&gt;

&lt;h3 id=&quot;determining-the-version-of-smb-negotiated&quot;&gt;Determining the Version of SMB Negotiated&lt;/h3&gt;

&lt;p&gt;If you are using Windows 8 and above, PowerShell now includes a cmdlet to determine the version of SMB that is negotiated for each connection - &lt;a href=&quot;https://technet.microsoft.com/en-us/library/jj635713&quot;&gt;Get-SmbConnection&lt;/a&gt;. PoweShell must be elevated, but this will show all connections from the local client.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://stealthpuppy.com/wp-content/uploads/2015/08/get-smbconnection2.png&quot; alt=&quot;Use PowerShell to View SMB Connections&quot; /&gt;&lt;em&gt;Use PowerShell to View SMB Connections&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;

&lt;p&gt;This year, we’ve covered additional scenarios, and there are always additional tests to cover. Future editions of these presentations will include the impact of folder redirection on Login VSI results and we’ll look at whether Windows 10 and Windows Server 2016 improves performance.&lt;/p&gt;

&lt;p&gt;To summarise this round, I’ll leave you with these key points:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Little effective performance difference between SMB 2.1 &amp;amp; 3.02; however SMB 3.02 lowers file server CPU utilisation&lt;/li&gt;
  &lt;li&gt;Size file servers for peak workload&lt;/li&gt;
  &lt;li&gt;Simulate workloads using FSCT&lt;/li&gt;
  &lt;li&gt;Anti-virus has a big impact&lt;/li&gt;
  &lt;li&gt;Don’t overcommit resources&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Want good user experience for your users with folder redirection enabled? You’ll need to put in the effort to determine the optimal configuration in your environment.&lt;/p&gt;</content><author><name></name></author></entry><entry><title type="html"></title><link href="/2019/04/09/2017-10-04-melbourne-cugc-october-2017-meetup.html" rel="alternate" type="text/html" title="" /><published>2019-04-09T09:49:05+10:00</published><updated>2019-04-09T09:49:05+10:00</updated><id>/2019/04/09/2017-10-04-melbourne-cugc-october-2017-meetup</id><content type="html" xml:base="/2019/04/09/2017-10-04-melbourne-cugc-october-2017-meetup.html">&lt;p&gt;We’ve been busy planning our next CUGC meet-up for 2017, which will be on the 24th of October at the Telstra Conference Center at 242 Exhibition St. To attend the meet-up, ensure you’ve signed up at the MyCUGC.org site: &lt;a href=&quot;https://www.mycugc.org/page/melbourne-oct24-2017Meeting&quot;&gt;Melbourne Citrix User Group Local Meeting&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;agenda&quot;&gt;Agenda&lt;/h2&gt;

&lt;p&gt;We’ve got Christian Lloyd from Citrix to take us through the XenDesktop / XenApp 7.15 LTSR release. This release is not to be underestimated and I’m expecting to see many organisations finally moving off XenApp 6.5 and those still on 7.6 LTSR, upgrade to 7.15 to take advantage of the new features. Because the latest release has so many features, the theme for this meeting will be ‘&lt;em&gt;Doing more with what you have&lt;/em&gt;’; so we’ll also take you through some of the really interesting features (e.g. &lt;a href=&quot;https://docs.citrix.com/en-us/xenapp-and-xendesktop/7-15-ltsr/secure/federated-authentication-service/fas-architectures.html&quot;&gt;FAS&lt;/a&gt;, App Layering, &lt;a href=&quot;https://docs.citrix.com/en-us/workspace-environment-management/current-release.html&quot;&gt;Workspace Environment Management&lt;/a&gt;, etc.) that you can be taking advantage of to improve your XD/XA environments. Plus get your questions about how to migrate answered.&lt;/p&gt;

&lt;h3 id=&quot;cugc-community-presentation&quot;&gt;CUGC Community Presentation&lt;/h3&gt;

&lt;p&gt;We still have space for a community presentation - if you’re interested in presenting on any topic related to Citrix technologies, we would love for you to present.&lt;/p&gt;

&lt;h2 id=&quot;sponsor&quot;&gt;Sponsor&lt;/h2&gt;

&lt;p&gt;This month, we’re really happy to have &lt;a href=&quot;https://www.eginnovations.com/&quot;&gt;eG Innovations&lt;/a&gt; sponsoring our meet-up and to discuss proactive monitoring, assessment and management of your Citrix XenDesktop and XenApp environments. To get an idea what eG Innovations is doing, check out this recent Citrix blog article: &lt;a href=&quot;https://www.citrix.com/blogs/2017/09/26/monitor-logon-performance-seamlessly-with-eg-innovations/&quot;&gt;Monitor Logon Performance Seamlessly with eG Innovations&lt;/a&gt;. Did you know they have a logon simulator? Check it out:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://stealthpuppy.com/wp-content/uploads/2017/10/eG-Enterprise-Express-Free-Logon-Simulator-Image-02-720x478.png&quot; alt=&quot;eG Enterprise Express-Free-Logon Simulator&quot; /&gt;&lt;em&gt;eG Enterprise Express-Free-Logon Simulator screenshot&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;eG Innovations enables us to rent the venue and also provide beer and pizza for XenBeers afterwards, so we’d love to see you there. Even better, they’ll be giving away a &lt;a href=&quot;https://madeby.google.com/home/&quot;&gt;Google Home&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://stealthpuppy.com/wp-content/uploads/2017/10/GoogleHome.jpg&quot; alt=&quot;Win Google Home at our next CUGC meet-up&quot; /&gt;&lt;em&gt;Win Google Home at our next CUGC meet-up&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;special-announcement&quot;&gt;Special Announcement&lt;/h2&gt;

&lt;p&gt;Be sure to come along to this month’s event to hear about our extra special December event. This is not something you’re going to want to miss.&lt;/p&gt;</content><author><name></name></author></entry><entry><title type="html"></title><link href="/2019/04/09/2015-08-04-folder-redirection-2015-part-2.html" rel="alternate" type="text/html" title="" /><published>2019-04-09T09:49:05+10:00</published><updated>2019-04-09T09:49:05+10:00</updated><id>/2019/04/09/2015-08-04-folder-redirection-2015-part-2</id><content type="html" xml:base="/2019/04/09/2015-08-04-folder-redirection-2015-part-2.html">&lt;p&gt;This is a multi-part article detailing our testing results and presentations for the 2015 series on Folder Redirection:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://stealthpuppy.com/folder-redirection-2015-part-1/&quot;&gt;I’ve Got 99 Problems and Folder Redirection is Every One of Them. 2015 Testing Results. Part 1&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;I’ve Got 99 Problems and Folder Redirection is Every One of Them. 2015 Testing Results. Part 2. (this article)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://stealthpuppy.com/folder-redirection-2015-part-3/&quot;&gt;I’ve Got 99 Problems and Folder Redirection is Every One of Them. 2015 Testing Results. Part 3&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;file-server-capacity-tool&quot;&gt;File Server Capacity Tool&lt;/h2&gt;

&lt;p&gt;The File Server Capacity Tool (FSCT) is great for modelling a user home drive hosted on Windows file servers. I’ve covered &lt;a href=&quot;https://stealthpuppy.com/replicate-2015-folder-redirection-test/&quot;&gt;how to use the FSCT previously&lt;/a&gt;, and the results of our tests have included various scenarios looking at CPU and disk performance.&lt;/p&gt;

&lt;h3 id=&quot;file-server-capacity-toolcpu-performance&quot;&gt;File Server Capacity Tool CPU Performance&lt;/h3&gt;

&lt;p&gt;In this test with Windows Server 2008 R2 running on the file server, SMB 2.1 shows quite a large difference between the average and maximum CPU seen across each test, especially from 400 users and beyond.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://stealthpuppy.com/wp-content/uploads/2015/08/FSCT-SMB21-CPU.png&quot; alt=&quot;SMB 2.1 showed a big difference between the average and maximum CPU seen across each test.&quot; /&gt;&lt;em&gt;SMB 2.1 showed a big difference between the average and maximum CPU seen across each test.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The results from the tests with Windows Server 2012 R2 on the file server shows very similar average CPU, but a greatly reduced maximum CPU, which is great for overall file server resource consumption.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://stealthpuppy.com/wp-content/uploads/2015/08/FSCT-SMB3-CPU.png&quot; alt=&quot;Lower CPU Utilization with SMB 3.02&quot; /&gt;&lt;em&gt;Lower CPU Utilization with SMB 3.02&lt;/em&gt;&lt;/p&gt;

&lt;h3 id=&quot;looking-at-the-impact-of-anti-virus&quot;&gt;Looking at the Impact of Anti-Virus&lt;/h3&gt;

&lt;p&gt;Running the same test with Windows Server 2012 R2, but this time with one of the major anti-virus products installed on the file server. This was installed with all of the default settings. This test shows a very interesting result when compared against the previous test - the chart below displays the same results as the previous test with the results from a testing run with AV:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://stealthpuppy.com/wp-content/uploads/2015/08/FSCT-SMB3-CPUwithAV.png&quot; alt=&quot;Anti-Virus Has a Large Impact on CPU&quot; /&gt;&lt;em&gt;Anti-Virus Has a Large Impact on CPU&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;With anti-virus installed, the average CPU is now getting up around the maximum CPU seen without AV, especially from 600 users and beyond. Look at that maximum CPU recorded with anti-virus, that’s a massive difference from the previous test and will have a large impact on the file server!&lt;/p&gt;

&lt;p&gt;To see if we could improve on this result, we re-ran the test with on-access scans disabled in the anti-virus configuration. This had little impact on the result, which could be explained by the FSCT workload being very write heavy.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://stealthpuppy.com/wp-content/uploads/2015/08/OnAccessScans.png&quot; alt=&quot;Disabling On Access Scans for AV Had Little Impact&quot; /&gt;&lt;em&gt;Disabling On Access Scans for AV Had Little Impact&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;There might be additional tweaking that may improve performance; however given the massive difference between with and without AV, I’m not confident that any considerable gains could be made. We haven’t yet had a chance to test with multiple anti-virus products.&lt;/p&gt;

&lt;h3 id=&quot;file-server-capacity-tooldisk-performance&quot;&gt;File Server Capacity Tool Disk Performance&lt;/h3&gt;

&lt;p&gt;The FSCT workloads show some interesting results in regards to disk performance. First up is a correlation between high IO and high CPU - the more blocks generated on the storage (i.e. more blocks that are read or written from and to the file server, requires the file server to process it).&lt;/p&gt;

&lt;p&gt;In the result below, we can see that when the IO peaks at near 2500 IOPS, the CPU makes a big jump as well:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://stealthpuppy.com/wp-content/uploads/2015/08/DiskIO-CorrelateCPU.png&quot; alt=&quot;CPU Peaks Correlate With IO Peaks&quot; /&gt;&lt;em&gt;CPU Peaks Correlate With IO Peaks&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;While all of the previous FSCT tests have been performed on SSDs, we also looked at comparing performance when running FSCT workloads on HDDs and comparing that against SSDs.&lt;/p&gt;

&lt;p&gt;When comparing the CPU load of the same workload running on HDD and SSDs, the average CPU is higher on HDDs.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://stealthpuppy.com/wp-content/uploads/2015/08/FSCT-HDDs.png&quot; alt=&quot;Higher CPU with HDDs&quot; /&gt;&lt;em&gt;Higher CPU with HDDs&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;This higher CPU on HDDs is, in part, explained by the higher disk queue length seen with HDDs. The chart below shows the results of these tests with the disk queue length on HDDs significantly higher as the number of users in the tests increases.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://stealthpuppy.com/wp-content/uploads/2015/08/FSCT-SSDs.png&quot; alt=&quot;Higher Avg. Disk Queue Length with HDDs&quot; /&gt;&lt;em&gt;Higher Avg. Disk Queue Length with HDDs&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;It’s clear then that any &lt;a href=&quot;http://www.atlantiscomputing.com/hyperscale&quot;&gt;high performing storage platform&lt;/a&gt; will not only improve storage performance, it will reduce the load on your compute, providing improved user experience across multiple layers of your infrastructure.&lt;/p&gt;

&lt;h2 id=&quot;part-3&quot;&gt;Part 3&lt;/h2&gt;

&lt;p&gt;In part 3, I’ll cover &lt;a href=&quot;https://stealthpuppy.com/folder-redirection-2015-part-3&quot;&gt;file access performance and summarise our recommendations&lt;/a&gt; for what you should be doing to get the best performance out of folder redirection.&lt;/p&gt;</content><author><name></name></author></entry></feed>