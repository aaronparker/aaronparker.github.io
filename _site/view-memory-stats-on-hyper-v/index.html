<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>View Memory Stats on a Hyper-V Server | stealthpuppy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="View Memory Stats on a Hyper-V Server" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I’ve got a very simple setup in my home lab with a couple of machine running either Hyper-V or ESXi. I typically don’t have monitoring solutions running and manage each host directly, rather than part of a cluster or with SCVMM or vCenter. For Hyper-V, I try to manage it remotely via PowerShell as much as I can and so it’s handy to be able to see memory utilisation on the remote host to understand how much capacity I’ve got before powering on a VM. I’ve written a PowerShell function to return various memory stats: Total RAM available in the host - using Get-VMHost. Total memory in use by running VMs - by returning the running VMs and finding the current amount of RAM assigned to each VM with Get-VM. This works with dynamic memory. Available memory to run additional VMs - using Get-Counter to gather the ‘\Memory\Available Bytes’ performance counter How much memory is used by the system - this is calculated by adding what’s in use by VMs, to the available memory and subtracting the results from the physical RAM in the host. This is a rough calculation, but an interesting metric to view. The function returns an array that includes each stat. Here’s an example of what the function returns. All values are in gigabytes and multiple hosts can be specified to gather details from. PS C:\&gt; Get-HvMem -ComputerName hv1 Name : hv1 HostRAMGB : 11.904224395752 VMInUseGB : 7.12890625 SystemUsedGB : 1.46017837524414 AvailableGB : 3.31513977050781 Here’s the code listing for the Get-HvMem function: Function Get-HvMem { &lt;# .SYNOPSIS Return Hyper-V host RAM details. .DESCRIPTION This function returns the total available RAM, RAM in use by VMs and the available RAM on a Hyper-V host. .PARAMETER ComputerName Specifies one or more Hyper-V hosts to retrieve stats from. .EXAMPLE Get-HvRAM -ComputerName hyperv1 .NOTES .LINK https://stealthpuppy.com/hyperv-memory-powershell #&gt; param( [Parameter(Mandatory=$true, Position=0,HelpMessage=&quot;Hyper-V host.&quot;)] [string[]]$ComputerName = $(throw = &quot;Please specify a remote Hyper-V host to gather memory details from.&quot;) ) # Create an array to return $allStats = @() ForEach ( $computer in $ComputerName ) { # Create an array to contain this computer&#39;s metrics $a = @() # Get details for Hyper-V host $vmHost = Get-VMHost -ComputerName $computer If ($vmHost) { # Get total RAM consumed by running VMs. $total = 0 Get-VM -ComputerName $computer | Where-Object { $_.State -eq &quot;Running&quot; } | Select-Object Name, MemoryAssigned | ForEach-Object { $total = $total + $_.MemoryAssigned } #Get available RAM via performance counters $Bytes = Get-Counter -ComputerName $computer -Counter &quot;\Memory\Available Bytes&quot; # Convert values to GB $availGB = ($Bytes[0].CounterSamples.CookedValue / 1GB) $hostGB = ($vmhost.MemoryCapacity / 1GB) $vmInUse = ($total / 1GB) # Construct an array of properties to return $item = New-Object PSObject # Add host name $item | Add-Member -type NoteProperty -Name &#39;Name&#39; -Value $vmHost.Name # Host RAM in GB $item | Add-Member -type NoteProperty -Name &#39;HostRAMGB&#39; -Value $hostGB # In use RAM in GB $item | Add-Member -type NoteProperty -Name &#39;VMInUseGB&#39; -Value $vmInUse # System used in GB $item | Add-Member -type NoteProperty -Name &#39;SystemUsedGB&#39; -Value ($hostGB - ($vmInUse + $availGB)) # Available RAM in GB $item | Add-Member -type NoteProperty -Name &#39;AvailableGB&#39; -Value $availGB $a += $item } # Add the current machine details to the array to return $allStats += $a } Return $allStats } Comments or feedback on bugs, better ways to do things or additional steps is welcome." />
<meta property="og:description" content="I’ve got a very simple setup in my home lab with a couple of machine running either Hyper-V or ESXi. I typically don’t have monitoring solutions running and manage each host directly, rather than part of a cluster or with SCVMM or vCenter. For Hyper-V, I try to manage it remotely via PowerShell as much as I can and so it’s handy to be able to see memory utilisation on the remote host to understand how much capacity I’ve got before powering on a VM. I’ve written a PowerShell function to return various memory stats: Total RAM available in the host - using Get-VMHost. Total memory in use by running VMs - by returning the running VMs and finding the current amount of RAM assigned to each VM with Get-VM. This works with dynamic memory. Available memory to run additional VMs - using Get-Counter to gather the ‘\Memory\Available Bytes’ performance counter How much memory is used by the system - this is calculated by adding what’s in use by VMs, to the available memory and subtracting the results from the physical RAM in the host. This is a rough calculation, but an interesting metric to view. The function returns an array that includes each stat. Here’s an example of what the function returns. All values are in gigabytes and multiple hosts can be specified to gather details from. PS C:\&gt; Get-HvMem -ComputerName hv1 Name : hv1 HostRAMGB : 11.904224395752 VMInUseGB : 7.12890625 SystemUsedGB : 1.46017837524414 AvailableGB : 3.31513977050781 Here’s the code listing for the Get-HvMem function: Function Get-HvMem { &lt;# .SYNOPSIS Return Hyper-V host RAM details. .DESCRIPTION This function returns the total available RAM, RAM in use by VMs and the available RAM on a Hyper-V host. .PARAMETER ComputerName Specifies one or more Hyper-V hosts to retrieve stats from. .EXAMPLE Get-HvRAM -ComputerName hyperv1 .NOTES .LINK https://stealthpuppy.com/hyperv-memory-powershell #&gt; param( [Parameter(Mandatory=$true, Position=0,HelpMessage=&quot;Hyper-V host.&quot;)] [string[]]$ComputerName = $(throw = &quot;Please specify a remote Hyper-V host to gather memory details from.&quot;) ) # Create an array to return $allStats = @() ForEach ( $computer in $ComputerName ) { # Create an array to contain this computer&#39;s metrics $a = @() # Get details for Hyper-V host $vmHost = Get-VMHost -ComputerName $computer If ($vmHost) { # Get total RAM consumed by running VMs. $total = 0 Get-VM -ComputerName $computer | Where-Object { $_.State -eq &quot;Running&quot; } | Select-Object Name, MemoryAssigned | ForEach-Object { $total = $total + $_.MemoryAssigned } #Get available RAM via performance counters $Bytes = Get-Counter -ComputerName $computer -Counter &quot;\Memory\Available Bytes&quot; # Convert values to GB $availGB = ($Bytes[0].CounterSamples.CookedValue / 1GB) $hostGB = ($vmhost.MemoryCapacity / 1GB) $vmInUse = ($total / 1GB) # Construct an array of properties to return $item = New-Object PSObject # Add host name $item | Add-Member -type NoteProperty -Name &#39;Name&#39; -Value $vmHost.Name # Host RAM in GB $item | Add-Member -type NoteProperty -Name &#39;HostRAMGB&#39; -Value $hostGB # In use RAM in GB $item | Add-Member -type NoteProperty -Name &#39;VMInUseGB&#39; -Value $vmInUse # System used in GB $item | Add-Member -type NoteProperty -Name &#39;SystemUsedGB&#39; -Value ($hostGB - ($vmInUse + $availGB)) # Available RAM in GB $item | Add-Member -type NoteProperty -Name &#39;AvailableGB&#39; -Value $availGB $a += $item } # Add the current machine details to the array to return $allStats += $a } Return $allStats } Comments or feedback on bugs, better ways to do things or additional steps is welcome." />
<link rel="canonical" href="/view-memory-stats-on-hyper-v/" />
<meta property="og:url" content="/view-memory-stats-on-hyper-v/" />
<meta property="og:site_name" content="stealthpuppy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-08-29T15:14:42+10:00" />
<script type="application/ld+json">
{"description":"I’ve got a very simple setup in my home lab with a couple of machine running either Hyper-V or ESXi. I typically don’t have monitoring solutions running and manage each host directly, rather than part of a cluster or with SCVMM or vCenter. For Hyper-V, I try to manage it remotely via PowerShell as much as I can and so it’s handy to be able to see memory utilisation on the remote host to understand how much capacity I’ve got before powering on a VM. I’ve written a PowerShell function to return various memory stats: Total RAM available in the host - using Get-VMHost. Total memory in use by running VMs - by returning the running VMs and finding the current amount of RAM assigned to each VM with Get-VM. This works with dynamic memory. Available memory to run additional VMs - using Get-Counter to gather the ‘\\Memory\\Available Bytes’ performance counter How much memory is used by the system - this is calculated by adding what’s in use by VMs, to the available memory and subtracting the results from the physical RAM in the host. This is a rough calculation, but an interesting metric to view. The function returns an array that includes each stat. Here’s an example of what the function returns. All values are in gigabytes and multiple hosts can be specified to gather details from. PS C:\\&gt; Get-HvMem -ComputerName hv1 Name : hv1 HostRAMGB : 11.904224395752 VMInUseGB : 7.12890625 SystemUsedGB : 1.46017837524414 AvailableGB : 3.31513977050781 Here’s the code listing for the Get-HvMem function: Function Get-HvMem { &lt;# .SYNOPSIS Return Hyper-V host RAM details. .DESCRIPTION This function returns the total available RAM, RAM in use by VMs and the available RAM on a Hyper-V host. .PARAMETER ComputerName Specifies one or more Hyper-V hosts to retrieve stats from. .EXAMPLE Get-HvRAM -ComputerName hyperv1 .NOTES .LINK https://stealthpuppy.com/hyperv-memory-powershell #&gt; param( [Parameter(Mandatory=$true, Position=0,HelpMessage=&quot;Hyper-V host.&quot;)] [string[]]$ComputerName = $(throw = &quot;Please specify a remote Hyper-V host to gather memory details from.&quot;) ) # Create an array to return $allStats = @() ForEach ( $computer in $ComputerName ) { # Create an array to contain this computer&#39;s metrics $a = @() # Get details for Hyper-V host $vmHost = Get-VMHost -ComputerName $computer If ($vmHost) { # Get total RAM consumed by running VMs. $total = 0 Get-VM -ComputerName $computer | Where-Object { $_.State -eq &quot;Running&quot; } | Select-Object Name, MemoryAssigned | ForEach-Object { $total = $total + $_.MemoryAssigned } #Get available RAM via performance counters $Bytes = Get-Counter -ComputerName $computer -Counter &quot;\\Memory\\Available Bytes&quot; # Convert values to GB $availGB = ($Bytes[0].CounterSamples.CookedValue / 1GB) $hostGB = ($vmhost.MemoryCapacity / 1GB) $vmInUse = ($total / 1GB) # Construct an array of properties to return $item = New-Object PSObject # Add host name $item | Add-Member -type NoteProperty -Name &#39;Name&#39; -Value $vmHost.Name # Host RAM in GB $item | Add-Member -type NoteProperty -Name &#39;HostRAMGB&#39; -Value $hostGB # In use RAM in GB $item | Add-Member -type NoteProperty -Name &#39;VMInUseGB&#39; -Value $vmInUse # System used in GB $item | Add-Member -type NoteProperty -Name &#39;SystemUsedGB&#39; -Value ($hostGB - ($vmInUse + $availGB)) # Available RAM in GB $item | Add-Member -type NoteProperty -Name &#39;AvailableGB&#39; -Value $availGB $a += $item } # Add the current machine details to the array to return $allStats += $a } Return $allStats } Comments or feedback on bugs, better ways to do things or additional steps is welcome.","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/view-memory-stats-on-hyper-v/","headline":"View Memory Stats on a Hyper-V Server","dateModified":"2014-08-29T15:14:42+10:00","datePublished":"2014-08-29T15:14:42+10:00","mainEntityOfPage":{"@type":"WebPage","@id":"/view-memory-stats-on-hyper-v/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="stealthpuppy" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">stealthpuppy</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">ABOUT</a><a class="page-link" href="/smb-not-cifs.html">SMB not CIFS</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">View Memory Stats on a Hyper-V Server</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2014-08-29T15:14:42+10:00" itemprop="datePublished">Aug 29, 2014
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>I’ve got a very simple setup in <a href="/lab-server-to-run-esxi-hyper-v/">my home lab</a> with a couple of machine running either Hyper-V or ESXi. I typically don’t have monitoring solutions running and manage each host directly, rather than part of a cluster or with SCVMM or vCenter. For Hyper-V, I try to manage it remotely via PowerShell as much as I can and so it’s handy to be able to see memory utilisation on the remote host to understand how much capacity I’ve got before powering on a VM. I’ve written a PowerShell function to return various memory stats:</p>

<ul>
  <li>Total RAM available in the host - using <a href="http://go.microsoft.com/fwlink/?LinkID=306853">Get-VMHost</a>.</li>
  <li>Total memory in use by running VMs - by returning the running VMs and finding the current amount of RAM assigned to each VM with <a href="http://go.microsoft.com/fwlink/?LinkID=306845">Get-VM</a>. This works with dynamic memory.</li>
  <li>Available memory to run additional VMs - using <a href="http://go.microsoft.com/fwlink/p/?linkid=289625">Get-Counter</a> to gather the ‘\Memory\Available Bytes’ performance counter</li>
  <li>How much memory is used by the system - this is calculated by adding what’s in use by VMs, to the available memory and subtracting the results from the physical RAM in the host. This is a rough calculation, but an interesting metric to view.</li>
</ul>

<p>The function returns an array that includes each stat. Here’s an example of what the function returns. All values are in gigabytes and multiple hosts can be specified to gather details from.</p>

<pre class="striped:false nums:false nums-toggle:false wrap-toggle:false plain:false plain-toggle:false show-plain-default:true lang:ps highlight:0 decode:true ">PS C:\&gt; Get-HvMem -ComputerName hv1


Name         : hv1
HostRAMGB    : 11.904224395752
VMInUseGB    : 7.12890625
SystemUsedGB : 1.46017837524414
AvailableGB  : 3.31513977050781</pre>

<p>Here’s the code listing for the Get-HvMem function:</p>

<pre class="lang:ps decode:true " title="Get-HvMem - get memory stats from Hyper-V">Function Get-HvMem {
    &lt;#
        .SYNOPSIS
            Return Hyper-V host RAM details.
 
        .DESCRIPTION
            This function returns the total available RAM, RAM in use by VMs and the available RAM on a Hyper-V host.
 
        .PARAMETER ComputerName
            Specifies one or more Hyper-V hosts to retrieve stats from.
 
        .EXAMPLE
            Get-HvRAM -ComputerName hyperv1

        .NOTES
 
        .LINK
            https://stealthpuppy.com/hyperv-memory-powershell
 
    #&gt;
    param(
        [Parameter(Mandatory=$true, Position=0,HelpMessage="Hyper-V host.")]
        [string[]]$ComputerName = $(throw = "Please specify a remote Hyper-V host to gather memory details from.")
    )

    # Create an array to return
    $allStats = @()

    ForEach ( $computer in $ComputerName ) {

        # Create an array to contain this computer's metrics
        $a = @()

        # Get details for Hyper-V host
        $vmHost = Get-VMHost -ComputerName $computer

        If ($vmHost) {

            # Get total RAM consumed by running VMs.
            $total = 0
            Get-VM -ComputerName $computer | Where-Object { $_.State -eq "Running" } | Select-Object Name, MemoryAssigned | ForEach-Object { $total = $total + $_.MemoryAssigned }

            #Get available RAM via performance counters
            $Bytes = Get-Counter -ComputerName $computer -Counter "\Memory\Available Bytes"

            # Convert values to GB
            $availGB = ($Bytes[0].CounterSamples.CookedValue / 1GB)
            $hostGB = ($vmhost.MemoryCapacity / 1GB)
            $vmInUse = ($total / 1GB)

            # Construct an array of properties to return
            $item = New-Object PSObject

            # Add host name
            $item | Add-Member -type NoteProperty -Name 'Name' -Value $vmHost.Name

            # Host RAM in GB
            $item | Add-Member -type NoteProperty -Name 'HostRAMGB' -Value $hostGB

            # In use RAM in GB
            $item | Add-Member -type NoteProperty -Name 'VMInUseGB' -Value $vmInUse

            # System used in GB
            $item | Add-Member -type NoteProperty -Name 'SystemUsedGB' -Value ($hostGB - ($vmInUse + $availGB))

            # Available RAM in GB
            $item | Add-Member -type NoteProperty -Name 'AvailableGB' -Value $availGB
            $a += $item    
        }

        # Add the current machine details to the array to return
        $allStats += $a
    }
    Return $allStats
}</pre>

<p>Comments or feedback on bugs, better ways to do things or additional steps is welcome.</p>

  </div><a class="u-url" href="/view-memory-stats-on-hyper-v/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">stealthpuppy</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">stealthpuppy</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/aaronparker"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">aaronparker</span></a></li><li><a href="https://www.twitter.com/stealthpuppy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">stealthpuppy</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>on end user computing and enterprise mobility</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
