<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Default Start Menu Customisation via Intune | aaron parker</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Default Start Menu Customisation via Intune" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The promise of a modern management approach to deployment and management of Windows 10 is that you no longer create and manage a custom SOE image. User experience is still important though and a large part of that experience in an enterprise environment, is the default Start menu." />
<meta property="og:description" content="The promise of a modern management approach to deployment and management of Windows 10 is that you no longer create and manage a custom SOE image. User experience is still important though and a large part of that experience in an enterprise environment, is the default Start menu." />
<link rel="canonical" href="/custom-default-start-menu-intune/" />
<meta property="og:url" content="/custom-default-start-menu-intune/" />
<meta property="og:site_name" content="aaron parker" />
<meta property="og:image" content="/wp-content/uploads/2018/12/Windows10ProDefaultStartMenu1080.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-12-18T23:28:30+11:00" />
<script type="application/ld+json">
{"description":"The promise of a modern management approach to deployment and management of Windows 10 is that you no longer create and manage a custom SOE image. User experience is still important though and a large part of that experience in an enterprise environment, is the default Start menu.","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/custom-default-start-menu-intune/","image":"/wp-content/uploads/2018/12/Windows10ProDefaultStartMenu1080.png","headline":"Default Start Menu Customisation via Intune","dateModified":"2018-12-18T23:28:30+11:00","datePublished":"2018-12-18T23:28:30+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"/custom-default-start-menu-intune/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="aaron parker" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">aaron parker</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">ABOUT</a><a class="page-link" href="/smb-not-cifs.html">SMB not CIFS</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Default Start Menu Customisation via Intune</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-12-18T23:28:30+11:00" itemprop="datePublished">Dec 18, 2018
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>The promise of a modern management approach to deployment and management of Windows 10 is that you no longer create and manage a custom SOE image. User experience is still important though and a large part of that experience in an enterprise environment, is the default Start menu.</p>

<p>The default Start menu, especially on Windows 10 Pro, is far from enterprise ready right? Take a look at this mess:</p>

<p><img src="https://stealthpuppy.com/wp-content/uploads/2018/12/StartMenu-1024x717.png" alt="Windows 10 Pro 1809 default Start menu" /><em>Windows 10 Pro 1809 default Start menu</em></p>

<p>Over-the-air provisioning of PCs via Windows AutoPilot &amp; Azure AD, Microsoft Intune (or insert your MDM solution here), limits the possibilities of customising the target PC before the user logs on. The administrator can <a href="https://docs.microsoft.com/en-us/windows/configuration/customize-windows-10-start-screens-by-using-mobile-device-management">define a Start menu</a>, but that’s a policy, not a preference. One size does not fit all, and users should be able to customise the Start menu to suit their style. </p>

<p>UWP / Microsoft Store apps can be targeted for removal, but those apps won’t be removed until well after login. Compounding the issue of default apps pinned to the Start menu is that some of them aren’t actually installed, so removal won’t occur until the Store downloads and installs updates. That can be hours after the user has provisioned the PC.</p>

<h2 id="customise-with-powershell">Customise with PowerShell?</h2>

<p>PowerShell scripts can be used to remove user and system provisioned Store apps (I have a couple of <a href="https://github.com/aaronparker/Intune/tree/master/Appx-Apps">scripts in my Intune GitHub repository</a>); however, PowerShell scripts in Intune can only be targeted to users and don’t fire until after the first logon. Additionally, I’ve had a crack at using <a href="https://github.com/aaronparker/Intune/blob/master/Start-Menu/PinStartMenuTile.ps1">PowerShell to pin and unpin tiles</a> from the Start menu, but found that I can’t interact with the shell (or at least the pin / unpin has no effect) when the script is delivered via Intune.</p>

<h2 id="looking-for-alternatives">Looking for Alternatives</h2>

<p>With the availability of the <a href="https://docs.microsoft.com/en-us/windows/deployment/windows-autopilot/enrollment-status">Windows Autopilot Enrolment Status</a> page in Windows 10 1803 and above, plus the recent addition of the feature to ‘<a href="https://docs.microsoft.com/en-us/intune/windows-enrollment-status#block-access-to-a-device-until-a-specific-application-is-installed">Block device use until these required apps are installed</a>’, we might have an opportunity to <a href="https://docs.microsoft.com/en-us/windows/configuration/customize-and-export-start-layout">deploy a customised default Start menu</a>.</p>

<p>The Enrolment Status page <a href="https://docs.microsoft.com/en-us/intune/windows-enrollment-status#enrollment-status-page-tracking-information">tracks security policies and line-of-business (MSI) applications</a>, so a custom default Start menu will have to be packaged into an MSI. Fingers and toes crossed then that this approach works.</p>

<h2 id="packaging-a-start-menu-customisation">Packaging a Start menu Customisation</h2>

<p>To package a customised Start menu, we need to create the desired layout and <a href="https://docs.microsoft.com/en-us/powershell/module/startlayout/export-startlayout?view=win10-ps">export</a> it with the<code class="highlighter-rouge">Export-StartLayout</code> command. It’s likely you’re familiar with this approach. To export the Start menu layout, I’ve used the following command - note the use of the <code class="highlighter-rouge">UseDesktopApplicationID</code> switch which will make pinning desktop application shortcuts as tiles successful.</p>

<p><code class="highlighter-rouge">Export-StartLayout -Path .\LayoutModification.xml -UseDesktopApplicationID</code></p>

<p>The next step is to create a custom Windows Installer package to deliver the layout file. I’m using <a href="https://www.advancedinstaller.com/">Advanced Installer</a> to create my deployment package. For this particular project, <a href="https://www.advancedinstaller.com/top-freeware-features.html">the Freeware version</a> of Advanced Installer provides all of the features you’ll need to deploy the custom layout file.</p>

<h3 id="create-a-windows-installer-package">Create a Windows Installer Package</h3>

<p>Advanced Installer makes short work of creating the package - create a new Simple Installer package and configure the product name, version and publisher. Note that if you want to update the package, save your project and update the version number each time you produce an updated installer.</p>

<p><img src="https://stealthpuppy.com/wp-content/uploads/2018/12/AdvancedInstaller01-ProductDetails.png" alt="Advanced Installer package Product details" /></p>

<p>Add the Start menu layout file to the project under Files and Folders. The project must define the correct target path and file name because it will be deployed into the default profile. Use this path:</p>

<p><code class="highlighter-rouge">Windows Volume\Users\Default\AppData\Local\Microsoft\Windows\Shell</code></p>

<p>And add the <code class="highlighter-rouge">LayoutModification.xml</code> file that you’ve exported with <code class="highlighter-rouge">Export-StartLayout</code> into this path. If your target path and file name aren’t correct, this won’t work so ensure your package looks the same as the screenshots here.</p>

<p><img src="https://stealthpuppy.com/wp-content/uploads/2018/12/AdvancedInstaller02-FilesFolders.png" alt="Adding the Start menu layout file to Files and Folders in Advanced Installer" /></p>

<p>For this package, I’ve configured the following install parameters:</p>

<ul>
  <li>Package type - 64-bit package</li>
  <li>Installation type - Per-machine only</li>
  <li>Reboot behaviour - Suppress all reboots and Reboot prompts</li>
</ul>

<p><img src="https://stealthpuppy.com/wp-content/uploads/2018/12/AdvancedInstaller02a-InstallParameters.png" alt="Configure Install Parameters in Advanced Installer" /></p>

<p>Configure the default build to produce a Single MSI file and define the name. In the example below, I’ve used <code class="highlighter-rouge">DefaultStartMenuLayout.msi</code>.</p>

<p><img src="https://stealthpuppy.com/wp-content/uploads/2018/12/AdvancedInstaller03-Builds.png" alt="Configure Advanced Installer to build a single MSI file with all resources embedded" /></p>

<p>Build your package and add the MSI into Microsoft Intune as <a href="https://docs.microsoft.com/en-us/intune/lob-apps-windows">a line-of-business application</a>. Assign the new application as <strong>Required</strong> for <strong>All Devices</strong>, so that the Enrolment Status Page can track the installation before the user logs on.</p>

<h2 id="configure-the-enrolment-status-page">Configure the Enrolment Status Page</h2>

<p>To ensure that the package is delivered to the target PCs before the user logs on, we’ll leverage the Enrolment Status Page (ESP). The ESP is supported on Windows 10 1803 and above, so if you’ve gotten this far into the article and haven’t yet updated to 1803 or higher, you should stop reading and update those machines.</p>

<p>Configure the ESP and enable the ‘Block device use until these required apps are installed if they are assigned to the user/device’ feature. Here select at least the applications whose shortcuts you have configured in your Start layout customisation. This list must include the MSI package containing the customisation itself.</p>

<p>Here’s the applications that I’ve configured in my test environment:</p>

<p><img src="https://stealthpuppy.com/wp-content/uploads/2018/12/EnrollmentStatusPage.png" alt="Configure the Enrolment Status Page with the list of apps and the default Start menu" /></p>

<p>Today the ESP <a href="https://docs.microsoft.com/en-us/windows/deployment/windows-autopilot/enrollment-status">tracks specific application deployments</a> - Microsoft Store apps and single MSI files, while Office 365 ProPlus applications are tracked on Windows 10 1809 and above.</p>

<h2 id="user-experience">User Experience</h2>

<p>Most of my testing is on Windows 10 1809 - with a PC enrolled into Azure AD and Microsoft Intune during the out of box experience, the Enrolment Status Page tracks the installation of policies and applications, including our Start menu customisation.</p>

<p>After the enrollment and deployment is complete, the user sees a customised Start menu after first logon. There’s a few tiles that didn’t remain pinned from the default customisation, but this is much cleaner and enterprise ready than what we end up with out of the box.</p>

<p><img src="https://stealthpuppy.com/wp-content/uploads/2018/12/UserDeployment-StartMenu.png" alt="Start menu" /></p>

<h2 id="wrapping-up">Wrapping Up</h2>

<p>Provisioning PCs via Windows AutoPilot and Microsoft Intune is a rapidly changing landscape. So what may not be possible today, is likely to be addressed quickly. In the meantime, there’s usually a custom approach to achieving the end-user experience that you need and this is a great example.</p>

  </div><a class="u-url" href="/custom-default-start-menu-intune/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">aaron parker</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">aaron parker</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/aaronparker"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">aaronparker</span></a></li><li><a href="https://www.twitter.com/stealthpuppy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">stealthpuppy</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>on end user computing and enterprise mobility</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
