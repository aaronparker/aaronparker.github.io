<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Sequencing Apple iTunes 11 with App-V 5 | stealthpuppy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Sequencing Apple iTunes 11 with App-V 5" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Two recent releases presents an opportunity to revisit the state of virtualizing Apple iTunes. iTunes 11 looks great, but is it just lipstick on a pig? Under the hood, it doesn’t appear to differ that much from previous versions, but lets see whether a combination of Apple’s latest and greatest along with App-V 5 offers a better virtualisation experience." />
<meta property="og:description" content="Two recent releases presents an opportunity to revisit the state of virtualizing Apple iTunes. iTunes 11 looks great, but is it just lipstick on a pig? Under the hood, it doesn’t appear to differ that much from previous versions, but lets see whether a combination of Apple’s latest and greatest along with App-V 5 offers a better virtualisation experience." />
<link rel="canonical" href="/sequencing-apple-itunes-11-with-app-v-5/" />
<meta property="og:url" content="/sequencing-apple-itunes-11-with-app-v-5/" />
<meta property="og:site_name" content="stealthpuppy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2012-12-01T15:32:33+11:00" />
<script type="application/ld+json">
{"description":"Two recent releases presents an opportunity to revisit the state of virtualizing Apple iTunes. iTunes 11 looks great, but is it just lipstick on a pig? Under the hood, it doesn’t appear to differ that much from previous versions, but lets see whether a combination of Apple’s latest and greatest along with App-V 5 offers a better virtualisation experience.","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/sequencing-apple-itunes-11-with-app-v-5/","headline":"Sequencing Apple iTunes 11 with App-V 5","dateModified":"2012-12-01T15:32:33+11:00","datePublished":"2012-12-01T15:32:33+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"/sequencing-apple-itunes-11-with-app-v-5/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="stealthpuppy" /></head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">stealthpuppy</a></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Sequencing Apple iTunes 11 with App-V 5</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2012-12-01T15:32:33+11:00" itemprop="datePublished">Dec 1, 2012
      </time><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card"
          itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><img class="alignright size-full wp-image-2976" style="margin-left: 5px; margin-right: 5px;" title="iTunes 11 128x128" alt="" src="/media/2012/12/iTunes-128.png" width="128" height="128" />Two recent releases presents an opportunity to revisit the state of virtualizing Apple iTunes. iTunes 11 looks great, but is it just lipstick on a pig? Under the hood, it doesn’t appear to differ that much from previous versions, but lets see whether a combination of Apple’s latest and greatest along with App-V 5 offers a better virtualisation experience.</p>

<h1 id="itunes-10-with-app-v-46">iTunes 10 with App-V 4.6</h1>

<p>Previously delivering <a href="/virtualisation/sequencing-apple-itunes-10/">iTunes 10 with App-V 4.6</a>, resulted in some loss of functionality and some minor annoyances with benign error messages. A lack of the Jumpt List under Windows 7 changed the user experience. App-V 5 now fixes this.</p>

<h1 id="itunes-components">iTunes Components</h1>

<p>To virtualize iTunes, you’ll need to extract the installer - simply run the installer and find the extracted MSI files in a folder under %TEMP%. This results in several files:</p>

<ul>
  <li>SetupAdmin.exe – the setup wrapper application. This can be discarded</li>
  <li>AppleSoftwareUpdate.msi – Software Update is used to download and Apple software and updates</li>
  <li>AppleApplicationSupport.msi – all Apple applications on Windows require this as a dependency</li>
  <li>AppleMobileDeviceSupport.msi – required for Apple mobile device support (iPhone, iPad etc.). This installer includes the drivers for Apple’s devices</li>
  <li>Bonjour.msi - <a href="http://support.apple.com/kb/HT2250">iTunes uses Bonjour</a> to find shared music libraries, to find AirPort Express devices for streaming music to, and to find Apple TVs</li>
  <li>iTunes.msi – the iTunes installer itself</li>
</ul>

<p>It is important that <em>Apple Software Update</em> is not included in the App-V package – allowing the applications in the package to update will at best fail and at worst, most likely bloat the package if it were allowed to run after deployment. Before copying the iTunes setup files into your sequencing VM, delete <em>AppleSoftwareUpdate.msi</em> and <em>SetupAdmin.exe</em>. This will prevent the iTunes installer from automatically installing Software Update during sequencing.</p>

<h1 id="prepare-the-sequencing-vm">Prepare the Sequencing VM</h1>

<p>Before starting the Sequencer, the following steps must be completed:</p>

<ol>
  <li>Install <em>Apple Application Support</em>– this is required because the Apple Mobile Device service will not start without it.</li>
  <li>Install <em>Apple Mobile Device Support</em> – this is required to be installed outside of the package because it contains the mobile device drivers and related services</li>
</ol>

<p>These same steps will need to be followed on the App-V client computer that will run iTunes. Fortunately Apple Application Support and the Mobile Device Support come as Windows Installer files, so they will be easy to deploy.</p>

<p>It is possible to include Apple Application Support in the iTunes package. This will allow you to run iTunes without any pre-requisites on client PCs; however both of the above components must be installed on client PCs if you want to connect mobile devices to iTunes.</p>

<h1 id="user-profile">User Profile</h1>

<p>iTunes has the potential to store a massive amount of data in the user’s profile:</p>

<p><a href="/media/2011/06/09AppData.png">&lt;img style=”background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;” title=”09AppData” alt=”09AppData” src=”/media/2011/06/09AppData_thumb.png</a></p>

<p>It is highly recommended to exclude %APPDATA% in the iTunes package to avoid this data being virtualized at runtime.</p>

<h1 id="sequencer-template">Sequencer Template</h1>

<p>There are a number of locations that should be excluded from the package during sequencing, including %APPDATA%. I have included these in a Package Template for iTunes that you can download from here:</p>

<p class="download">
  [download id="59&#8243; format="1&#8243;]
</p>

<h1 id="installing-itunes">Installing iTunes</h1>

<p>Sequencing is as simple as capturing the installation of the following files and configuring iTunes the way we want:</p>

<ul>
  <li>Bonjour.msi</li>
  <li>iTunes.msi</li>
  <li>Optionally - AppleApplicationSupport.msi</li>
</ul>

<p>The installation and configuration of the above can be scripted, which would be a good approach for repeatability.</p>

<h1 id="sequencing-itunes">Sequencing iTunes</h1>

<p>To sequence iTunes, follow the basic outline here:</p>

<ol>
  <li>
    <p>Start the Sequencer and load the Sequencer Template provided here</p>
  </li>
  <li>
    <p>Create a new Virtual Application Package and choose Create Package (default)</p>
  </li>
  <li>
    <p>Choose Standard Application (default)</p>
  </li>
  <li>
    <p>Select the installer – select either a script to automate the iTunes install command or <em>C:\Windows\System32\cmd.exe</em> to manually run each MSI file</p>
  </li>
  <li>
    <p>Add a Virtual Application Package Name (e.g. <em>Apple iTunes 11</em>). Use a Primary Virtual Application Directory of <em>C:\iTunes11</em></p>
  </li>
  <li>
    <p>Install both Bonjour and iTunes and optionally Apple Application Support. Use the following command lines to control the installation options including target folders:</p>
  </li>
</ol>

<p>[code]MSIEXEC /I Bonjour.msi INSTALLDIR=C:\iTunes11\Bonjour /QB-<br />
MSIEXEC /I iTunes.msi INSTALLDIR=C:\iTunes11\iTunes SCHEDULE_ASUW=0 REGSRCH_DESKTOP_SHORTCUTS=0[/code]</p>

<p>When installing iTunes, be sure to install to C:\iTunes11\iTunes and remove the following options during install:</p>

<ul>
  <li>Add iTunes shortcut to my desktop</li>
  <li>Automatically update iTunes and other Apple software</li>
  <li>Open iTunes after the installer exits</li>
</ul>

<div>
  <span style="font-size: medium;"><span style="line-height: 24px;"><strong>Note</strong>: do not launch iTunes during sequencing.</span></span>
</div>

<ol>
  <li>
    <p>Finish the install and continue to the Configure Software step. There is no need to launch any applications at this point</p>
  </li>
  <li>
    <p>Review the installation report. This will list a couple of issues which I’ll discuss later.</p>
  </li>
  <li>
    <p>Continue and customize the package (do not stop at this point).</p>
  </li>
  <li>
    <p>There is no need to configure streaming at this point, so skip the optimisation step.</p>
  </li>
  <li>
    <p>If you are capturing iTunes on Windows 7 x86, allow the package to run on any operating system.</p>
  </li>
  <li>
    <p>At the Create Package step, continue on to modify the package rather than stop now.</p>
  </li>
  <li>
    <p>Add a description to the package and check each tab in the Sequencer to ensure the package looks OK. Under Virtual Services, two services should be listed - <em>Bonjour Service</em> and <em>iPod Service</em>.</p>
  </li>
  <li>
    <p>Edit the Shortcuts and remove the <em>About Bonjour</em> and <em>About iTunes</em> shortcuts.</p>
  </li>
</ol>

<h1 id="virtualization-issues">Virtualization Issues</h1>

<p>The Sequencer will highlight a a couple of issues:</p>

<ul>
  <li>DCOM subsystem detected</li>
  <li>Unsupported driver detected</li>
</ul>

<h2 id="dcom">DCOM</h2>

<p>iTunes includes some DCOM components - the report shows:</p>

<blockquote>
  <p>The sequencer detected a DCOM subsystem. Application components that use DCOM will not work with App-V. The DCOM subsystems detected are as follows:</p>

  <p>IpodService (LocalService)</p>

  <p>iTunesAdmin (AccessPermission)</p>
</blockquote>

<p>With the Apple Mobile Device Support, syncing with a virtualized iTunes should still work. The iTunesAdmin component appears to be related restricting access to Parental controls in Preferences. Clicking the lock will result the following error:</p>

<p><img class="alignnone size-full wp-image-2983" title="iTunes Parental error" alt="" src="/media/2012/12/Parental.png" width="381" height="109" srcset="/media/2012/12/Parental.png 381w, /media/2012/12/Parental-150x42.png 150w, /media/2012/12/Parental-300x85.png 300w" sizes="(max-width: 381px) 100vw, 381px" /></p>

<h2 id="driver">Driver</h2>

<p>iTunes installs the <a href="http://www.gearsoftware.com/support/drivers.php">GEARAspiWDM</a> driver, which results in the following report:</p>

<blockquote>
  <p>The sequencer detected an unsupported driver. Kernel and user-mode drivers are not supported in the App-V virtual environment.</p>

  <p>The unsupported drivers detected are as follows: SYSTEM\CurrentControlSet\services\GEARAspiWDM</p>
</blockquote>

<p>This is related to writing CD/DVDs - once iTunes is virtualized, that feature will be unavailable.</p>

<h1 id="deploying-itunes">Deploying iTunes</h1>

<p>Deploying the iTunes package will require the deployment of Apple Application Support and Apple Mobile Device Support to the client computers first. Apple Application Support can be included in the package; however it is required to be installed if the Mobile Device Support is also deployed.</p>

<p>Without Apple Application Support the following will be the result of launching iTunes:</p>

<p><a href="/media/2011/06/NoAppleAppSupport.png">&lt;img style=”background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;” title=”NoAppleAppSupport” alt=”NoAppleAppSupport” src=”/media/2011/06/NoAppleAppSupport_thumb.png</a></p>

<p>Last, but not least, for media sharing to work, firewall exceptions will be required for the following processes:</p>

<ul>
  <li>iTunes.exe</li>
  <li>mDNSResponder.exe</li>
</ul>

<p>The path to each process will be dependent on your package.</p>

<h1 id="finally">Finally</h1>

<p>Running iTunes on the client for the first time will result in a prompt to the user to set iTunes as the default audio player. With App-V 5 this is now supported and should work just like an installed application.</p>

<p><a href="/media/2012/12/iTunesFirstRun.png">&lt;img style=”background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;” title=”iTunesFirstRun” alt=”iTunesFirstRun” src=”/media/2012/12/iTunesFirstRun_thumb.png</a></p>

<p>View the gallery below for a screenshot walkthrough of sequencing iTunes 11:</p>

<p>[nggallery id=2]</p>

  </div><a class="u-url" href="/sequencing-apple-itunes-11-with-app-v-5/" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col one-half">
      <h2 class="footer-heading">stealthpuppy</h2>
        <ul class="contact-list">
          <li class="p-name">stealthpuppy</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col one-half">
        <p>on end user computing and enterprise mobility</p>
      </div>

      <div class="social-links"><ul class="social-media-list"><li><a href="https://github.com/aaronparker" title="aaronparker"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a href="https://www.linkedin.com/in/aaronedwardparker" title="aaronedwardparker"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a href="https://twitter.com/stealthpuppy" title="stealthpuppy"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li><li><a href="/feed.xml" title="atom"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg></a></li></ul>
</div>
    </div>

  </div>

</footer>
</body>

</html>
