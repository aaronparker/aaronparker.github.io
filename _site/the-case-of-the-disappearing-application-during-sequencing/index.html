<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>The Case of the Disappearing Application during Sequencing | stealthpuppy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="The Case of the Disappearing Application during Sequencing" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In the official Microsoft TechNet forums, a question had been asked about sequencing Google Chrome and the poster states that when using the Chrome Enterprise Installer (a downloadable MSI for deployment inside an organisation), Chrome installs OK during the monitoring phase, but the folder is deleted at the end of monitoring and thus isn’t captured." />
<meta property="og:description" content="In the official Microsoft TechNet forums, a question had been asked about sequencing Google Chrome and the poster states that when using the Chrome Enterprise Installer (a downloadable MSI for deployment inside an organisation), Chrome installs OK during the monitoring phase, but the folder is deleted at the end of monitoring and thus isn’t captured." />
<link rel="canonical" href="/the-case-of-the-disappearing-application-during-sequencing/" />
<meta property="og:url" content="/the-case-of-the-disappearing-application-during-sequencing/" />
<meta property="og:site_name" content="stealthpuppy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2011-11-04T11:52:42+11:00" />
<script type="application/ld+json">
{"description":"In the official Microsoft TechNet forums, a question had been asked about sequencing Google Chrome and the poster states that when using the Chrome Enterprise Installer (a downloadable MSI for deployment inside an organisation), Chrome installs OK during the monitoring phase, but the folder is deleted at the end of monitoring and thus isn’t captured.","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/the-case-of-the-disappearing-application-during-sequencing/","headline":"The Case of the Disappearing Application during Sequencing","dateModified":"2011-11-04T11:52:42+11:00","datePublished":"2011-11-04T11:52:42+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"/the-case-of-the-disappearing-application-during-sequencing/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="stealthpuppy" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">stealthpuppy</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">ABOUT</a><a class="page-link" href="/smb-not-cifs.html">SMB not CIFS</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">The Case of the Disappearing Application during Sequencing</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2011-11-04T11:52:42+11:00" itemprop="datePublished">Nov 4, 2011
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>In the official Microsoft TechNet forums, a question had been asked <a href="http://social.technet.microsoft.com/Forums/en-GB/appvgeneralsequencing/thread/1683399a-fcaa-48bb-a354-733a57e9fd4b">about sequencing Google Chrome</a> and the poster states that when using the <a href="http://www.google.com/chrome/eula.html?msi=true">Chrome Enterprise Installer</a> (a downloadable MSI for deployment inside an organisation), Chrome installs OK during the monitoring phase, but the folder is deleted at the end of monitoring and thus isn’t captured.</p>

<p>I thought that that behaviour was a little strange, so decided to test this out myself and to my surprise I could replicate the issue. To track down what was going on, I had to perform some troubleshooting.</p>

<p>I tested this on a virtual machine running Windows 7 SP1 x86 and could see from browsing to the Google installation folder (C:\Program Files\Google\Chrome) that the Application sub-folder was being removed after the monitoring phase was complete. To work out which process was deleting the folder, I’ve used <a href="http://technet.microsoft.com/en-us/sysinternals/bb896645">Process Monitor</a>. To see what was going on, I’ve reset my VM back to a clean snapshot, started the App-V Sequencer and Process Monitor and set a filter in Process Monitor for <strong>Path</strong> beginning with <strong>C:\Program Files\Google\Chrome\Application</strong> and then re-started the sequencing process.</p>

<p><img style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="ProcessMonitorFilter" src="https://stealthpuppy.com/wp-content/uploads/2011/11/ProcessMonitorFilter1.png" alt="ProcessMonitorFilter" width="639" height="370" border="0" /></p>

<p>With this filter, I was able to see that the process that was deleting the folder is the Sequencer itself (SFTSequencer.exe). Click the screenshot for a larger view.</p>

<p><a href="https://stealthpuppy.com/wp-content/uploads/2011/11/ProcessMonitorDeletes.png"><img style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="ProcessMonitorDeletes" src="https://stealthpuppy.com/wp-content/uploads/2011/11/ProcessMonitorDeletes_thumb.png" alt="ProcessMonitorDeletes" width="660" height="270" border="0" /></a></p>

<p>The next most obvious place to look then is the Sequencer log file, hopefully it will hold some information about why the folder is being deleted. To view the Sequencer log, browse to <strong>C:\Program Files\Microsoft Application Virtualization Sequencer\Logs</strong> and open <strong>sft-seq-log.txt</strong>.</p>

<p>In this file I can see a number of lines where the Sequencer is attempting to copy files that no longer exist:</p>

<p>[code][11/03/2011 21:45:34 VRB VFSX] …failed getting long path name for the file (C:\Program Files\Google\Chrome). Error: 2<br />
[11/03/2011 21:45:34 VRB CORE] GetShortPathName failure using: C:\Program Files\Google\Chrome. Error is: 2<br />
[11/03/2011 21:45:34 VRB CORE] Could not copy C:\Program Files\Google\Chrome to Q:\Google Chrome\VFS\CSIDL_PROGRAM_FILES\Google\Chrome.  Error is: 2.<br />
[11/03/2011 21:45:34 VRB VFSX] …failed getting long path name for the file (C:\Program Files\Google\Chrome\Application). Error: 3<br />
[11/03/2011 21:45:34 VRB CORE] GetShortPathName failure using: C:\Program Files\Google\Chrome. Error is: 2<br />
[11/03/2011 21:45:34 VRB CORE] Could not copy C:\Program Files\Google\Chrome to Q:\Google Chrome\VFS\CSIDL_PROGRAM_FILES\Google\Chrome.  Error is: 2.<br />
[11/03/2011 21:45:34 VRB CORE] CopyResourceToVFS failed.<br />
[11/03/2011 21:45:34 VRB VFSX] …failed getting long path name for the file (C:\Program Files\Google\Chrome\Application\15.0.874.106). Error: 3<br />
[11/03/2011 21:45:34 VRB CORE] GetShortPathName failure using: C:\Program Files\Google\Chrome. Error is: 2<br />
[11/03/2011 21:45:34 VRB CORE] Could not copy C:\Program Files\Google\Chrome to Q:\Google Chrome\VFS\CSIDL_PROGRAM_FILES\Google\Chrome.  Error is: 2.<br />
[11/03/2011 21:45:34 VRB CORE] CopyResourceToVFS failed.[/code]</p>

<p>A few lines previous to these is this line:</p>

<p>[code][11/03/2011 21:45:26 VRB RTSK] Reboot processing detected need to delete \??\C:\Program Files\Google\Chrome.[/code]</p>

<p>The Sequencer is doing exactly what’s it being told to do – process a reboot task at the end of the monitoring phase and delete the application. Interestingly though, only the Application sub-folder is being deleted, not the entire Chrome parent folder.</p>

<p>To get an idea of why, I’ve used <a href="http://exodusdev.com/products/whyreboot">WhyReboot</a>, a fantastic free tool for finding out why a reboot has been requested. How many times have you suspected that an application installer asks to reboot Windows when it’s not actually needed?</p>

<p>Going through the sequencing process again and running WhyReboot before ending monitoring, gives me an idea of why the reboot has been requested:</p>

<p><img style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="WhyReboot" src="https://stealthpuppy.com/wp-content/uploads/2011/11/WhyReboot1.png" alt="WhyReboot" width="609" height="381" border="0" /></p>

<p><strong>Note</strong>: I could also use <a href="http://technet.microsoft.com/en-us/sysinternals/bb897556">PendMoves</a> another Sysinternals tool to query this information as well.</p>

<p><a href="http://technet.microsoft.com/en-us/library/cc960241.aspx">PendingFileRenameOperations</a> is a Registry value that lists file system operations that must be processed during a reboot or shutdown. Generally these types of operations need to be processed on reboot because there are open file handles that are only released once the system shuts down.</p>

<p>So what’s writing this entry to PendingFileRenameOperations and why does this only happen during sequencing? To find out, I’ve reached for Process Monitor again, but unfortunately I haven’t been able find which process is writing to the PendingFileRenameOperations value, as Process Monitor didn’t find any RegSetValue operations.</p>

<p><a href="https://stealthpuppy.com/wp-content/uploads/2011/11/ProcessMonitorPendingFileRenameOperations.png"><img style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="ProcessMonitorPendingFileRenameOperations" src="https://stealthpuppy.com/wp-content/uploads/2011/11/ProcessMonitorPendingFileRenameOperations_thumb.png" alt="ProcessMonitorPendingFileRenameOperations" width="660" height="167" border="0" /></a></p>

<p>Circumstantial evidence points to SETUP.EXE, but without Process Monitor giving me more information I can’t say for sure. I do however, have a workaround that allow me to sequence Chrome – before finishing the monitoring phase, I clear the PendingFileRenameOperations data with this command:</p>

<p>[code]REG ADD “HKLM\System\CurrentControlSet\Control\Session Manager” /v PendingFileRenameOperations /d “” /t REG_MULTI_SZ /f[/code]</p>

  </div><a class="u-url" href="/the-case-of-the-disappearing-application-during-sequencing/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">stealthpuppy</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">stealthpuppy</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/aaronparker"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">aaronparker</span></a></li><li><a href="https://www.twitter.com/stealthpuppy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">stealthpuppy</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>on end user computing and enterprise mobility</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
