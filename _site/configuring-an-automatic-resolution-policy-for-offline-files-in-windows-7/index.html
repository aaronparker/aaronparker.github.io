<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Configuring an Automatic Resolution Policy for Offline Files in Windows 7 | stealthpuppy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Configuring an Automatic Resolution Policy for Offline Files in Windows 7" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="If you’ve ever had any experience implementing Offline Files for Windows laptops, you’re no doubt aware that users are required to manually resolve synchronisation conflicts. Well that’s the impression I’ve always been under until recently – there’s no documentation on TechNet on how to automatically resolve conflicts and certainly no Group Policy controls available either." />
<meta property="og:description" content="If you’ve ever had any experience implementing Offline Files for Windows laptops, you’re no doubt aware that users are required to manually resolve synchronisation conflicts. Well that’s the impression I’ve always been under until recently – there’s no documentation on TechNet on how to automatically resolve conflicts and certainly no Group Policy controls available either." />
<link rel="canonical" href="/configuring-an-automatic-resolution-policy-for-offline-files-in-windows-7/" />
<meta property="og:url" content="/configuring-an-automatic-resolution-policy-for-offline-files-in-windows-7/" />
<meta property="og:site_name" content="stealthpuppy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2010-08-25T16:00:00+10:00" />
<script type="application/ld+json">
{"description":"If you’ve ever had any experience implementing Offline Files for Windows laptops, you’re no doubt aware that users are required to manually resolve synchronisation conflicts. Well that’s the impression I’ve always been under until recently – there’s no documentation on TechNet on how to automatically resolve conflicts and certainly no Group Policy controls available either.","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/configuring-an-automatic-resolution-policy-for-offline-files-in-windows-7/","headline":"Configuring an Automatic Resolution Policy for Offline Files in Windows 7","dateModified":"2010-08-25T16:00:00+10:00","datePublished":"2010-08-25T16:00:00+10:00","mainEntityOfPage":{"@type":"WebPage","@id":"/configuring-an-automatic-resolution-policy-for-offline-files-in-windows-7/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="stealthpuppy" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">stealthpuppy</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">About</a><a class="page-link" href="/smb-not-cifs.html">SMB not CIFS</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Configuring an Automatic Resolution Policy for Offline Files in Windows 7</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2010-08-25T16:00:00+10:00" itemprop="datePublished">Aug 25, 2010
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>If you’ve ever had any experience implementing Offline Files for Windows laptops, you’re no doubt aware that users are required to manually resolve synchronisation conflicts. Well that’s the impression I’ve always been under until recently – there’s no documentation on TechNet on how to automatically resolve conflicts and certainly no Group Policy controls available either.</p>

<h3 id="why-do-we-need-an-automatic-resolution-policy">Why do we need an Automatic Resolution Policy?</h3>

<p>Consider this example – I want to store the User Data Directory for the App-V client on the network (e.g. the users’ home drive) instead of the default location of AppData. This will allow me to deliver application settings between different desktop types (such as a physical desktop and a XenApp server), without having to implement roaming profiles.</p>

<p>Laptops will need to cache the network location so that users can access their applications when disconnected from the network. So I configure Offline Files (via Group Policy) to cache the network folder that hosts the User Data Directory.</p>

<p>The problem with this approach is that when the laptop synchronises the folder, the user may need to resolve file conflicts and is presented with a dialog box that looks something like this:</p>

<p><a href="http://stealthpuppy.com/wp-content/uploads/2010/08/OfflineFilesResolveConflict.png"><img style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="Offline Files Resolve Conflict" src="http://stealthpuppy.com/wp-content/uploads/2010/08/OfflineFilesResolveConflict_thumb.png" border="0" alt="Offline Files Resolve Conflict" width="498" height="429" /></a></p>

<p>Most users are not going to know which option they should choose (and they certainly aren’t going to <a href="http://windows.microsoft.com/en-us/windows-vista/Resolving-sync-conflicts-frequently-asked-questions">read the help</a>). How many will know what the <em>UsrVol_sftfs_v.tmp</em> file is? I’d like to avoid this scenario as often as I can.</p>

<h3 id="the-feature-does-exist">The feature does exist!</h3>

<p>Last week I came across a knowledgebase article that Microsoft recently updated – <a href="http://support.microsoft.com/kb/2189014">Automatic resolution policy for an offline file synchronization conflict does not work if the “keep all changes” setting is enabled in Windows Vista or in Windows Server 2008</a>. It appears that an automatic resolution policy does exist even though there’s no documentation on this feature, beyond one page on MSDN on the <a href="http://msdn.microsoft.com/en-us/library/bb530653(v=VS.85).aspx">OFFLINEFILES_SYNC_CONFLICT_RESOLVE</a> enumerator in the Offline Files API.</p>

<h3 id="configuring-an-automatic-resolution-policy">Configuring an Automatic Resolution Policy</h3>

<p>An automatic resolution policy for Offline Files is implemented by adding a registry value for each network share for which you wish to control synchronisation, then specifying the policy for automatic resolution.</p>

<ol>
  <li>Click <strong>Start</strong>, type <strong>regedit</strong> in the <strong>Start Search</strong> box, and then press ENTER</li>
  <li>Locate and then click the following registry subkey: <em>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\NetCache</em> </li>
  <li>On the <strong>Edit</strong> menu, point to <strong>New</strong>, and then click <strong>Key</strong>. Type <strong>SyncConflictHandling</strong>, and then press ENTER</li>
  <li>Right-click <strong>SyncConflictHandling</strong>, point to <strong>New</strong>, and then click <strong>Expandable String Value</strong>. Type the path of the network share as the value name (for example \servername\share)</li>
  <li>Right-click the value name, and then click <strong>Modify</strong>. In the <strong>Value</strong> data box, enter a value listed in the table below, and then click <strong>OK</strong></li>
</ol>

<p>The possible values for SyncConflictHandling and a description of each value is listed is this table:</p>

<p>[table id=24 /]</p>

<p>When added to the Registry, it will look something like this:</p>

<p><a href="http://stealthpuppy.com/wp-content/uploads/2010/08/SyncConflictHandling1.png"><img style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="SyncConflictHandling" src="http://stealthpuppy.com/wp-content/uploads/2010/08/SyncConflictHandling_thumb1.png" border="0" alt="SyncConflictHandling" width="660" height="173" /></a></p>

<p>To test that the policy is working update a file at multiple locations when the file is offline (for example, delete the file in one location, but make changes to it in the other location). Connect back to the network and initiate a synchronisation operation (via Sync Centre) for the network share. Windows will trigger a conflict in the synchronisation process when it synchronises the file. Your policy should kick in and Sync Centre should automatically handle the conflict.</p>

<h3 id="implementing-a-policy">Implementing a Policy</h3>

<p>So which policy should you implement? This will depend on the share and the type of client machine. Based on the descriptions of the possible values, the default policy is 5, which requires the user to manually resolve conflicts.</p>

<p>In most cases, laptops have a one to one relationship with a user and it will be their primary device. Those machines could then use a policy of 1 (keep the local state) thus preferring changes made on the laptop rather than other computers. Of course, what’s right for me might not be right for you, so I recommend testing and be certain of your choice before implementing.</p>

<p>To deploy the policy you could use a script or a tool such as Group Policy Preferences:</p>

<ol>
  <li>Create a Group Policy Object and apply it to a laptop OU or open an existing GPO that applies to your laptops</li>
  <li>Navigate to <em>Computer Configuration / Preferences / Windows Settings / Registry</em></li>
  <li>Create a new registry item – HKLM should be the default <strong>Hive</strong>, add <em>Software\Microsoft\Windows\CurrentVersion\NetCache\SyncConflictHandling</em> to the <strong>Key Path</strong></li>
  <li>In <strong>Value Name</strong>, enter the UNC path to the share you want to apply the policy to</li>
  <li>Change <strong>Value Type</strong> to REG_EXPAND_SZ</li>
  <li>Enter a numeric value from 0 to 7 (1 or 2 would be most common)</li>
  <li>Repeat for each share you want to manage</li>
</ol>

<p><a href="http://stealthpuppy.com/wp-content/uploads/2010/08/GPPrefReg.png"><img style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="GPPrefReg" src="http://stealthpuppy.com/wp-content/uploads/2010/08/GPPrefReg_thumb.png" border="0" alt="GPPrefReg" width="404" height="448" /></a></p>

<p>Continuing the App-V User Data Directory as my example, I’ve hosted this on a network share and I want to ensure that the laptop copy always wins any conflict resolution. Therefore I’m using a value of 1 to ensure that in the event of changes on both the laptop and another machine, the changes on the laptop will be written back to the network.</p>

<h3 id="conclusion">Conclusion</h3>

<p>This feature should be extremely useful for scenarios, including the App-V User Data Directory example I’ve used here; however it’s disappointing to find so little documentation given that it’s been available since Windows Vista. It would be great to see this feature expanded upon in later releases including Group Policy support (rather than GP Preferences) as well as the ability to implement rules that can control conflict handling for file types.</p>

  </div><a class="u-url" href="/configuring-an-automatic-resolution-policy-for-offline-files-in-windows-7/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">stealthpuppy</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">stealthpuppy</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/aaronparker"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">aaronparker</span></a></li><li><a href="https://www.twitter.com/stealthpuppy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">stealthpuppy</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>on end user computing and enterprise mobility
</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
