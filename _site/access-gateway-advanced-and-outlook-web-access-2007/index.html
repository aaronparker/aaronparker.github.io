<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Access Gateway Advanced and Outlook Web Access 2007 | stealthpuppy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Access Gateway Advanced and Outlook Web Access 2007" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="If you are looking at implementing remote access to Outlook Web Access 2007 through Citrix Access Gateway Advanced you’ll find that things aren’t going to work as expect and currently this configuration is not supported by Citrix." />
<meta property="og:description" content="If you are looking at implementing remote access to Outlook Web Access 2007 through Citrix Access Gateway Advanced you’ll find that things aren’t going to work as expect and currently this configuration is not supported by Citrix." />
<link rel="canonical" href="/access-gateway-advanced-and-outlook-web-access-2007/" />
<meta property="og:url" content="/access-gateway-advanced-and-outlook-web-access-2007/" />
<meta property="og:site_name" content="stealthpuppy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2007-05-09T00:05:00+10:00" />
<script type="application/ld+json">
{"description":"If you are looking at implementing remote access to Outlook Web Access 2007 through Citrix Access Gateway Advanced you’ll find that things aren’t going to work as expect and currently this configuration is not supported by Citrix.","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/access-gateway-advanced-and-outlook-web-access-2007/","headline":"Access Gateway Advanced and Outlook Web Access 2007","dateModified":"2007-05-09T00:05:00+10:00","datePublished":"2007-05-09T00:05:00+10:00","mainEntityOfPage":{"@type":"WebPage","@id":"/access-gateway-advanced-and-outlook-web-access-2007/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="stealthpuppy" /></head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">stealthpuppy</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">ABOUT</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Access Gateway Advanced and Outlook Web Access 2007</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2007-05-09T00:05:00+10:00" itemprop="datePublished">May 9, 2007
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>If you are looking at implementing remote access to Outlook Web Access 2007 through Citrix Access Gateway Advanced you’ll find that things aren’t going to work as expect and currently this configuration is not supported by Citrix.</p>

<p>After upgrading our internal Exchange organisation to Exchange Server 2007 (we have a single server implementation), I’ve found that Outlook Web Access no longer works through the Access Gateway Advanced Access Navigator interface. Instead of the user being presented with OWA they see this page:</p>

<p><img src="/media/2007/05/1000141406aac-owa.gif" alt="1000141406aac-owa.gif" /></p>

<p>No amount of attempting to log into OWA through this interface will result in a successful login. Looking at a packet capture of the initial logon attempt the Access Gateway sends the initial GET request and the Exchange server responds with a 401 and sends back the authentication options as you can see here:</p>

<font face="courier new,courier">- HTTP: Response, HTTP/1.1, Status Code = 401<br /> ProtocolVersion: HTTP/1.1<br /> StatusCode: 401, Unauthorized<br /> Reason: Unauthorized<br /> ContentLength: 1656<br /> ContentType: text/html<br /> Server: Microsoft-IIS/6.0<br /> WWWAuthenticate: Negotiate<br /> WWWAuthenticate: NTLM<br /> WWWAuthenticate: Basic realm="exchange.company.local"<br /> X-Powered-By: ASP.NET<br /> Date: Wed, 09 May 2007 05:10:18 GMT<br /> HeaderEnd: CRLF</font>

<p>One glaring issue with this response is that realm used for Basic authentication is the name of the server, not the domain name as specified in the IIS configuration, but I think that’s another issue. AAC does attempt NTLM authentication in the next packet - this is the GET request (I’ve truncated the Authorisation field):</p>

<font face="courier new,courier">- HTTP: Request, GET /owa<br /> Command: GET<br /> + URI: /owa<br /> ProtocolVersion: HTTP/1.1<br /> Connection: Keep-Alive<br /> Via: 1.1 FW<br /> Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-ms-application, application/vnd.ms-xpsdocument, application/xaml+xml, application/x-ms-xbap, application/x-shockwave-flash, application/vnd.ms-excel, application/vnd.ms-powerpoint<br /> Accept-Language: en-au<br /> Cookie: LPNAME=/CitrixLogonPoint/navui/;<br /> UA-CPU: x86<br /> UserAgent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; SLCC1; .NET CLR 2.0.50727; .NET CLR 3.0.04506; .NET CLR 1.1.4322; InfoPath.2)<br /> Host: exchange.company.local<br /> Cache-Control: no-cache<br /> Pragma: no-cache<br /> Authorization: Negotiate YIIKuAYGKwYBBQUCoIIKrDCCCqigJDAiBgkqhki..</font>

<p>The Exchange server again responds with HTTP 401 and this process then repeats for another round until the AAC gives up on authenticating and displays the page seen above. Unfortunately I can’t work out a reason for this behaviour and don’t have a solution, but it’s something you should be aware of before you start upgrading to Exchange Server 2007. Hopefully we’ll see a resolution from Citrix soon.</p>

<p><strong>UPDATE</strong>: I haven’t had an opportunity to test this out yet, but check out <a href="http://support.citrix.com/forums/thread.jspa?forumID=101&amp;threadID=88407">this thread at the Citrix Forums</a> for some information on getting the CAG and OWA 2007 working.</p>

  </div><a class="u-url" href="/access-gateway-advanced-and-outlook-web-access-2007/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col one-half">
      <h2 class="footer-heading">stealthpuppy</h2>
        <ul class="contact-list">
          <li class="p-name">stealthpuppy</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col one-half">
        <p>on end user computing and enterprise mobility</p>
      </div>

      <div class="social-links"><ul class="social-media-list"><li><a href="https://github.com/aaronparker" title="aaronparker"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a href="https://www.linkedin.com/in/aaronedwardparker" title="aaronedwardparker"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a href="https://twitter.com/stealthpuppy" title="stealthpuppy"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li><li><a href="/feed.xml" title="rss"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg></a></li></ul>
</div>
    </div>

  </div>

</footer>
</body>

</html>
