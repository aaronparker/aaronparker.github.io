<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Storage Sense on Windows 10 configured with Intune | stealthpuppy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Storage Sense on Windows 10 configured with Intune" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In a modern management scenario, enabling end-points to perform automatic maintenance tasks will reduce TCO by avoiding scenarios that might result in support calls. Storage Sense in Windows 10 is a great way to manage free disk space on PCs by clearing caches, temporary files, old downloads, Windows Update cleanup, previous Windows Versions, and more, but it it’s not fully enabled by default. Storage Sense can potentially remove gigabytes of data, freeing up valuable space on smaller drives." />
<meta property="og:description" content="In a modern management scenario, enabling end-points to perform automatic maintenance tasks will reduce TCO by avoiding scenarios that might result in support calls. Storage Sense in Windows 10 is a great way to manage free disk space on PCs by clearing caches, temporary files, old downloads, Windows Update cleanup, previous Windows Versions, and more, but it it’s not fully enabled by default. Storage Sense can potentially remove gigabytes of data, freeing up valuable space on smaller drives." />
<link rel="canonical" href="/windows-10-storage-sense-intune/" />
<meta property="og:url" content="/windows-10-storage-sense-intune/" />
<meta property="og:site_name" content="stealthpuppy" />
<meta property="og:image" content="/media/2018/09/florian-perennes-583674-unsplash.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-09-02T20:46:04+10:00" />
<script type="application/ld+json">
{"description":"In a modern management scenario, enabling end-points to perform automatic maintenance tasks will reduce TCO by avoiding scenarios that might result in support calls. Storage Sense in Windows 10 is a great way to manage free disk space on PCs by clearing caches, temporary files, old downloads, Windows Update cleanup, previous Windows Versions, and more, but it it’s not fully enabled by default. Storage Sense can potentially remove gigabytes of data, freeing up valuable space on smaller drives.","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/windows-10-storage-sense-intune/","image":"/media/2018/09/florian-perennes-583674-unsplash.jpg","headline":"Storage Sense on Windows 10 configured with Intune","dateModified":"2018-09-02T20:46:04+10:00","datePublished":"2018-09-02T20:46:04+10:00","mainEntityOfPage":{"@type":"WebPage","@id":"/windows-10-storage-sense-intune/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="stealthpuppy" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">stealthpuppy</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">ABOUT</a><a class="page-link" href="/smb-not-cifs.html">SMB not CIFS</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Storage Sense on Windows 10 configured with Intune</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-09-02T20:46:04+10:00" itemprop="datePublished">Sep 2, 2018
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>In a modern management scenario, enabling end-points to perform automatic maintenance tasks will reduce TCO by avoiding scenarios that might result in support calls. Storage Sense in Windows 10 is a great way to <a href="https://support.microsoft.com/en-us/help/12425/windows-10-free-up-drive-space">manage free disk space</a> on PCs by clearing caches, temporary files, old downloads, Windows Update cleanup, previous Windows Versions, and more, but it it’s not fully enabled by default. Storage Sense can potentially remove gigabytes of data, freeing up valuable space on smaller drives.</p>

<p>Here’s how to enable this feature on Windows 10 PCs enrolled in Microsoft Intune.</p>

<h1 id="storage-sense-settings">Storage Sense Settings</h1>

<p>Storage Sense can be found in the Windows 10 Settings app and has only a few settings that can be changed. Typically a user may enable Storage Sense and accept the default settings and for most PCs, the defaults are likely good enough. Here’s what’s available in Windows 10 1803:</p>

<p><img src="https://stealthpuppy.com/media/2018/09/Windows10StorageSense.png" alt="Enabling Storage Sense in Windows 10 Settings" /><em>Enabling Storage Sense in Windows 10 Settings</em></p>

<p>Settings are stored in the user profile at:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\StorageSense\Parameters\StoragePolicy
</code></pre></div></div>

<p>Settings are stored somewhat cryptically with numbers representing various options.</p>

<p><img src="https://stealthpuppy.com/media/2018/09/StorageSense-Registry.png" alt="Storage Sense settings in the Registry" /><em>Storage Sense settings in the Registry</em></p>

<p>These values translate to following options and values in the table below:</p>

<table>
  <thead>
    <tr>
      <th>Setting</th>
      <th>Registry Value</th>
      <th>Option</th>
      <th>Registry Data</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Storage Sense</td>
      <td>01</td>
      <td>Off</td>
      <td>0</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>On</td>
      <td>1</td>
    </tr>
    <tr>
      <td>Run Storage Sense</td>
      <td>2048</td>
      <td>Every Day</td>
      <td>1</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Every Week</td>
      <td>7</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Every Month</td>
      <td>30</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>When Windows decides</td>
      <td>0</td>
    </tr>
    <tr>
      <td>Delete temporary files that my apps aren’t using</td>
      <td>04</td>
      <td>Selected</td>
      <td>0</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Not selected</td>
      <td>1</td>
    </tr>
    <tr>
      <td>Delete files in my recycle bin if they have been there for over</td>
      <td>08</td>
      <td>Off</td>
      <td>0</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>On</td>
      <td>1</td>
    </tr>
    <tr>
      <td> </td>
      <td>256</td>
      <td>Never</td>
      <td>0</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>1 day</td>
      <td>1</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>14 days</td>
      <td>14</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>30 days</td>
      <td>30</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>60 days</td>
      <td>60</td>
    </tr>
    <tr>
      <td>Delete files in my Downloads folder if they have been there for over</td>
      <td>32</td>
      <td>Off</td>
      <td>0</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>On</td>
      <td>1</td>
    </tr>
    <tr>
      <td> </td>
      <td>512</td>
      <td>Never</td>
      <td>0</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>1 day</td>
      <td>1</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>14 days</td>
      <td>14</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>30 days</td>
      <td>30</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>60 days</td>
      <td>60</td>
    </tr>
  </tbody>
</table>

<p>Now that we know what the options are, we can decide on what to deploy and deliver them to enrolled end-points.</p>

<h1 id="configure-via-powershell">Configure via PowerShell</h1>

<p>Using the values from the table above, a PowerShell script can be deployed via Intune to configure our desired settings. The script below will enable Storage Sense along with several settings to regularly remove outdated or temporary files.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Enable Storage Sense</span>
<span class="c1"># Ensure the StorageSense key exists</span>
<span class="nv">$key</span> <span class="o">=</span> <span class="s2">"HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\StorageSense"</span>
<span class="k">If</span> <span class="o">(!(</span><span class="nb">Test-Path</span> <span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span><span class="o">))</span> <span class="o">{</span>
    <span class="nb">New-Item</span> -Path <span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span> | Out-Null
<span class="o">}</span>
<span class="k">If</span> <span class="o">(!(</span><span class="nb">Test-Path</span> <span class="s2">"</span><span class="nv">$key</span><span class="s2">\Parameters"</span><span class="o">))</span> <span class="o">{</span>
    <span class="nb">New-Item</span> -Path <span class="s2">"</span><span class="nv">$key</span><span class="s2">\Parameters"</span> | Out-Null
<span class="o">}</span>
<span class="k">If</span> <span class="o">(!(</span><span class="nb">Test-Path</span> <span class="s2">"</span><span class="nv">$key</span><span class="s2">\Parameters\StoragePolicy"</span><span class="o">))</span> <span class="o">{</span>
    <span class="nb">New-Item</span> -Path <span class="s2">"</span><span class="nv">$key</span><span class="s2">\Parameters\StoragePolicy"</span> | Out-Null
<span class="o">}</span>

<span class="c1"># Set Storage Sense settings</span>
<span class="c1"># Enable Storage Sense</span>
<span class="nb">Set-ItemProperty</span> -Path <span class="s2">"</span><span class="nv">$key</span><span class="s2">\Parameters\StoragePolicy"</span> -Name <span class="s2">"01"</span> -Type DWord -Value 1

<span class="c1"># Set 'Run Storage Sense' to Every Week</span>
<span class="nb">Set-ItemProperty</span> -Path <span class="s2">"</span><span class="nv">$key</span><span class="s2">\Parameters\StoragePolicy"</span> -Name <span class="s2">"2048"</span> -Type DWord -Value 7

<span class="c1"># Enable 'Delete temporary files that my apps aren't using'</span>
<span class="nb">Set-ItemProperty</span> -Path <span class="s2">"</span><span class="nv">$key</span><span class="s2">\Parameters\StoragePolicy"</span> -Name <span class="s2">"04"</span> -Type DWord -Value 1

<span class="c1"># Set 'Delete files in my recycle bin if they have been there for over' to 14 days</span>
<span class="nb">Set-ItemProperty</span> -Path <span class="s2">"</span><span class="nv">$key</span><span class="s2">\Parameters\StoragePolicy"</span> -Name <span class="s2">"08"</span> -Type DWord -Value 1
<span class="nb">Set-ItemProperty</span> -Path <span class="s2">"</span><span class="nv">$key</span><span class="s2">\Parameters\StoragePolicy"</span> -Name <span class="s2">"256"</span> -Type DWord -Value 14

<span class="c1"># Set 'Delete files in my Downloads folder if they have been there for over' to 60 days</span>
<span class="nb">Set-ItemProperty</span> -Path <span class="s2">"</span><span class="nv">$key</span><span class="s2">\Parameters\StoragePolicy"</span> -Name <span class="s2">"32"</span> -Type DWord -Value 1
<span class="nb">Set-ItemProperty</span> -Path <span class="s2">"</span><span class="nv">$key</span><span class="s2">\Parameters\StoragePolicy"</span> -Name <span class="s2">"512"</span> -Type DWord -Value 60

<span class="c1"># Set value that Storage Sense has already notified the user</span>
<span class="nb">Set-ItemProperty</span> -Path <span class="s2">"</span><span class="nv">$key</span><span class="s2">\Parameters\StoragePolicy"</span> -Name <span class="s2">"StoragePoliciesNotified"</span> -Type DWord -Value 1
</code></pre></div></div>

<p>Modify the script as desired - at the very least the script should enable Storage Sense and leave the remaining settings as default. Save the script as a PowerShell file and <a href="https://docs.microsoft.com/en-us/intune/intune-management-extension">deploy via the Intune console in the Azure portal</a>. Ensure that the script runs with the logged on user’s credentials because it will write to HKCU.</p>

<p><img src="https://stealthpuppy.com/media/2018/09/StorageSense-PowerShellIntune.png" alt="Enabling Storage Sense with a PowerShell script in Intune" /><em>Enabling Storage Sense with a PowerShell script in Intune</em></p>

<p>Assign the script to All Users and their PC will receive the script. It’s important to note that, because the settings are stored in HKCU and are not policies, the user can either disable Storage Sense or change other settings.</p>

<h1 id="wrapping-up">Wrapping Up</h1>

<p>Storage Sense is a great feature to enable on Windows 10 PCs for both personal and corporate PCs. In a modern management scenario, it’s another tool in our kit for enabling end-points to be self-sufficient, so I highly recommend testing and enabling the feature by default. This article has shown you how to configure Storage Sense via Intune and PowerShell with all of the possible combinations required to configure it to suit your requirements.</p>

<h2 id="hold-on">Hold On…</h2>

<p>Storage Sense shows you how much disk capacity has been cleaned in the previous month in the Settings app. For a bit of a laugh, you can modify the value where this is stored so that Settings displays spaced saved that’s clearly not genuine.</p>

<p><img src="https://stealthpuppy.com/media/2018/09/StorageSense-SpaceSaved.png" alt="Messing around with the value of saved space" /><em>Messing around with the value of saved space</em></p>

<p>You’ll find the registry value (20180901) in this key:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\StorageSense\Parameters\StoragePolicy\SpaceHistory
</code></pre></div></div>

  </div><a class="u-url" href="/windows-10-storage-sense-intune/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">stealthpuppy</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">stealthpuppy</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/aaronparker"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">aaronparker</span></a></li><li><a href="https://www.twitter.com/stealthpuppy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">stealthpuppy</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>on end user computing and enterprise mobility</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
