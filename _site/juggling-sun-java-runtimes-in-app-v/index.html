<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Juggling Sun Java Runtimes in App-V | stealthpuppy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Juggling Sun Java Runtimes in App-V" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I don’t know why I keep getting involved with Java. I know I’ve written about it more than a few times before, but it’s not because I like Java… So before I get into a tirade about it, here’s yet another post on the subject.." />
<meta property="og:description" content="I don’t know why I keep getting involved with Java. I know I’ve written about it more than a few times before, but it’s not because I like Java… So before I get into a tirade about it, here’s yet another post on the subject.." />
<link rel="canonical" href="/juggling-sun-java-runtimes-in-app-v/" />
<meta property="og:url" content="/juggling-sun-java-runtimes-in-app-v/" />
<meta property="og:site_name" content="stealthpuppy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2008-10-22T12:39:00+11:00" />
<script type="application/ld+json">
{"description":"I don’t know why I keep getting involved with Java. I know I’ve written about it more than a few times before, but it’s not because I like Java… So before I get into a tirade about it, here’s yet another post on the subject..","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/juggling-sun-java-runtimes-in-app-v/","headline":"Juggling Sun Java Runtimes in App-V","dateModified":"2008-10-22T12:39:00+11:00","datePublished":"2008-10-22T12:39:00+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"/juggling-sun-java-runtimes-in-app-v/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="stealthpuppy" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">stealthpuppy</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">ABOUT</a><a class="page-link" href="/smb-not-cifs.html">SMB not CIFS</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Juggling Sun Java Runtimes in App-V</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2008-10-22T12:39:00+11:00" itemprop="datePublished">Oct 22, 2008
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><a href="https://stealthpuppy.com/media/2008/10/softgridcube-java.png"><img class="alignleft size-medium wp-image-775" style="border: 0px;" title="softgridcube-java" src="https://stealthpuppy.com/media/2008/10/softgridcube-java.png" border="0" alt="" width="120" height="120" /></a>I don’t know why I keep getting involved with Java. I know I’ve <a href="https://stealthpuppy.com/deployment/sun-jre-install-script-update">written</a> <a href="https://stealthpuppy.com/deployment/new-java-runtime-coming-set-phasers-to-yawn">about</a> <a href="https://stealthpuppy.com/deployment/running-the-latest-oracle-jinitiator">it</a> <a href="https://stealthpuppy.com/deployment/sun-java-6-update-3-deployment-script">more</a> <a href="https://stealthpuppy.com/terminal-server/juggling-java-vms">than</a> a <a href="https://stealthpuppy.com/hall-of-shame/symantec-gateway-security-1600-and-sun-java">few</a> <a href="https://stealthpuppy.com/terminal-server/presentation-server-and-the-sun-java-vm">times</a> before, but it’s not because I like Java… So before I get into a tirade about it, here’s yet another post on the subject..</p>

<h3 id="introduction">Introduction</h3>

<p>We’ve had some issues taking an existing sequence of the Sun JRE created in 4.2 and running it on a 4.5 client (maybe more on that at a later date), so I’ve gone back to drawing board to get version <a href="http://java.sun.com/products/archive/j2se/1.3.1_10/index.html">1.3.1_10</a> working in the bubble, while <a href="http://java.sun.com/products/archive/j2se/6u3/index.html">1.6.0._03</a> and <a href="http://javadl.sun.com/webapps/download/AutoDL?BundleId=23111">1.6.0_07</a> exist on our client machines.</p>

<p>Justin Zarb has <a href="http://blogs.technet.com/virtualworld/archive/2007/08/14/troubleshooting-softgrid-with-process-monitor.aspx">a post on running different versions of the JRE</a> which works great, but I would prefer to get it working without resorting to scripting. To do that I’ve taken advantage of behaviour of the sequencer that takes registry keys deleted during the sequencing process, and hiding them from the resulting bubble when the application is executed on the client.</p>

<p>To achieve separation between the JRE in the bubble and the JRE installed on the system, I’ve followed this basic process:</p>

<ol>
  <li>Configure a sequencing virtual machine that does not have (or ever had) any version of the JRE installed</li>
  <li>Add the registry keys for the version or versions installed on your client machines</li>
  <li>During sequencing, delete those keys added in the previous step and create dummy entries for other keys and folders you want to fully virtualise</li>
  <li>Install the older version of the JRE</li>
</ol>

<p>By implementing steps 2 and 3 you essentially create the anti-JRE which enables you to completely hide the versions of the JRE installed on workstations in your environment – no scripting at runtime required.</p>

<p>Here’s an example of this process in play: the first image below shows some of the HKCUSoftwareClassesCLSID keys, added by 1.6.0_07, seen in the real (non-virtualised) registry:</p>

<p><img style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" title="CLSID-Real" src="https://stealthpuppy.com/media/2008/10/clsidreal.png" border="0" alt="CLSID-Real" width="336" height="244" /></p>

<p>By adding those keys to the sequencer machine and deleting during sequencing, we end up with only the keys added by the 1.3.1_10 installer. Here is the same HKCUSoftwareClassesCLSID key seen inside the bubble:</p>

<p><img style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" title="CLSID-Virtual" src="https://stealthpuppy.com/media/2008/10/clsidvirtual.png" border="0" alt="CLSID-Virtual" width="335" height="117" /></p>

<h3 id="building-the-pre-sequencing-environment">Building the Pre-sequencing Environment</h3>

<p>All sequencing was performed on a clean installation of Windows where no versions of the JRE had ever been installed. This was done to ensure complete control over the sequencing environment and to ensure</p>

<p>To capture the keys that are installed by 1.6.0_03 and 1.6.0_07, I sequenced those versions and opened the resulting package in the <a href="http://en.wikipedia.org/wiki/Bill_%26_Ted's_Excellent_Adventure">most excellent</a> <a href="http://www.virtualapp.net/sft-explorer.html">SFT Explorer</a>. From there you can export the registry keys created by the installer.</p>

<p><img style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" title="16007Export" src="https://stealthpuppy.com/media/2008/10/16007export.png" border="0" alt="16007Export" width="354" height="428" /></p>

<p>From that exported registry file I’ve created a script that will add those keys to the sequencing machine (keys only, values are not required):</p>

<p class="download">
  <a href="https://stealthpuppy.com/media/2008/10/PRE-SEQUENCE.txt">Download the pre-sequence script here</a>
</p>

<p>This script is then run before sequencing takes place so that the same keys can be deleted before installing the older version of the JRE, and those deletions are then picked up by the sequencer.</p>

<h3 id="installing-and-capturing-the-jre">Installing and Capturing the JRE</h3>

<p>I’ve scripted the install process to make things simple, so here’s the process the occurs during sequencing:</p>

<ol>
  <li>Delete the keys created during by the pre-sequencing step. The JRE installer does recreate some of those keys, but with different values, and the sequencer will pick them up and virtualise correctly;</li>
  <li>Install version 1.3.1_10 of the JRE using an unattended script (SETUP.ISS created using SETUP –R, before sequencing);</li>
  <li>A dummy registry key is created under HKCUSoftwareClassesCLSID, but this step isn’t completely necessary;</li>
  <li>A dummy file is created in the default install location of the Sun JRE (%ProgramFiles%Java%). This will allow the default install folder to be fully virtualised, hiding the real folder from the bubble;</li>
  <li>The Control Panel applet for the just installed JRE is run, so that the sequencing engineer can check settings, such as Internet Explorer integration, is enabled.</li>
</ol>

<p>Here’s a copy of the install script:</p>

<p class="download">
  <a href="https://stealthpuppy.com/media/2008/10/INSTALL.txt">Download the install script here</a>
</p>

<p>After installation and capture is complete, a few steps must be completed in the Sequencer before saving:</p>

<ul>
  <li>Remove the JAVAW.EXE application item that the sequencer picks up;</li>
  <li>Add a shortcut to IEXPLORE.EXE. You can then copy and customise the resultant OSD file if you are using this process for web applications;</li>
  <li>Ensure that CSIDL_PROGRAM_FILESJava is set to ‘Override Local Directory’;</li>
  <li>Ensure the registry key USER%SFT_SID%SoftwareJavaSoft is set to ‘Override Local Key’;</li>
</ul>

<h3 id="testing-the-package">Testing the Package</h3>

<p>Once you have completed the sequence and are running the package on your client, you should see the virtualised JRE as the default Java machine in Internet Explorer inside the bubble:</p>

<p><img style="display: inline" title="Java13IEOptions" src="https://stealthpuppy.com/media/2008/10/java13ieoptions.png" border="0" alt="Java13IEOptions" width="413" height="386" /></p>

<p>Whilst running Internet Explorer normally, the installed version of the JRE will be the default:</p>

<p><img style="display: inline" title="Java16IEOptions" src="https://stealthpuppy.com/media/2008/10/java16ieoptions.png" border="0" alt="Java16IEOptions" width="413" height="386" /></p>

  </div><a class="u-url" href="/juggling-sun-java-runtimes-in-app-v/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">stealthpuppy</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">stealthpuppy</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/aaronparker"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">aaronparker</span></a></li><li><a href="https://www.twitter.com/stealthpuppy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">stealthpuppy</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>on end user computing and enterprise mobility</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
