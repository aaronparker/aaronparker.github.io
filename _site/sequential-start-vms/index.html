<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Sequential Starting of a List of VMs | aaron parker</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Sequential Starting of a List of VMs" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In my lab environment, I often want to start a list of virtual machines, but without taxing the system in the process by starting them all at the same time.  I could do that manually, but that’s no fun. Here’s a short function I wrote to sequentially start a list of virtual machines - the script will start a VM and wait for that VM to boot before starting the next VM. You can optionally also wait additional time before starting the next VM to give the first one some time to finish starting it’s services etc. This version currently supports Hyper-V only. The script does not currently return anything, but has a number of parameters: ComputerName - the name of the Hyper-V host. Specify “.” for the local machine (without quotes) VM - specify a comma separated list of VMs Wait - the number of seconds to wait between starting a VM after the previous VM. Specify the number of VMs as a number (integer) only. This will default to 180 seconds ShowProgress - Specify whether to show progress while starting the VMs. This is cosmetic only, but does give some indication as to how far through the boot process the script is. Other standard parameters such as Verbose are supported. Function Start-SequentialVMs { &lt;# .SYNOPSIS Starts a list of VMs. .DESCRIPTION This function starts a list of VMs sequentially. It will wait until a VM is booted, optionally pause for a number of seconds, before starting the next VM. .PARAMETER ComputerName Specifies the Hyper-V host to start the VM on. .PARAMETER VM Specifies a list of VMs to start. .PARAMETER Wait Specifies a number of seconds to wait after the previous VM has booted successfully. Defaults to 180 seconds. .PARAMETER ShowProgress Specified whether to show progress as VMs are started. .EXAMPLE Start-SequentialVMs -ComputerName hyperv1 -VMList &quot;sql1&quot;, &quot;pvs1&quot;, &quot;xd71&quot; -Wait 20 .NOTES .LINK Sequential Starting of a List of VMs #&gt; param( [Parameter(Mandatory=$true, Position=0,HelpMessage=&quot;Hyper-V host.&quot;)] [string]$ComputerName = $(throw = &quot;Please specify a remote Hyper-V host to start VMs on.&quot;), [Parameter(Mandatory=$true, Position=1,HelpMessage=&quot;List of VMs to start.&quot;)] [string[]]$VMList = $(throw = &quot;Please specifiy a list of VMs to start&quot;), [Parameter(Mandatory=$false)] [int]$Wait = 180, [Parameter(Mandatory=$false)] [bool]$ShowProgress ) # Connect to Hyper-V host before attempting to start VMs. Stop script if unable to connect Write-Verbose &quot;Connecting to VM host.&quot; Get-VMHost -ComputerName $ComputerName -Verbose $False -ErrorAction Stop # Start progress at 0 $Percent = 0 # Step through list of provided VMs ForEach ( $vm in $VMList ) { # Convert current location in list of VMs to a percentage $Percent = ($VMList.IndexOf($vm)/$VMList.Count) * 100 # Show progress if specified on the command line If ($ShowProgress -eq $True) { Write-Progress -Activity &quot;Starting VMs.&quot; -Status &quot;Starting VM $vm.&quot; -PercentComplete $Percent } # Get status for current VM Remove-Variable currentVM -ErrorAction SilentlyContinue Write-Verbose &quot;Getting status for VM $vm...&quot; $currentVM = Get-VM -ComputerName $ComputerName -Name $vm -ErrorAction SilentlyContinue # If the VM exists, then power it on if it is in an Off state If ($currentVM.Length -gt 0) { If ($currentVM.State -eq &quot;Off&quot; ) { Start-VM -ComputerName $ComputerName -Name $vm -Verbose # Wait for VM to boot and report a heartbeat Write-Verbose &quot;Waiting for VM heartbeat.&quot; Do { Start-Sleep -milliseconds 100 } Until ((Get-VMIntegrationService $currentVM | ?{$_.name -eq &quot;Heartbeat&quot;}).PrimaryStatusDescription -eq &quot;OK&quot;) # Wait the specified number of seconds before booting the next VM, unless this is the last VM in the list If ($Wait -gt 0 -and $VMList.IndexOf($vm) -lt ($VMList.Count-1)) { Write-Verbose &quot;Waiting for $Wait seconds before starting next VM.&quot; Start-Sleep -Seconds $Wait } } Else { Write-Verbose &quot;VM $vm already running.&quot; } } Else { Write-Error -Message &quot;Unable to find VM $vm on host $ComputerName.&quot; -Category ObjectNotFound } } Write-Verbose &quot;Started VMs.&quot; # Show progress if specified on the command line If ($ShowProgress -eq $True) { Write-Progress -Activity &quot;Starting VMs.&quot; -Status &quot;Started all VMs.&quot; -PercentComplete 100 } Start-Sleep -Seconds 1 } Save the script as Start-SequentialVMs.ps1 and run it or add the function to your PowerShell profile so that the function is available when starting PowerShell. Use Get-Help to see the full syntax and examples from within a PowerShell window." />
<meta property="og:description" content="In my lab environment, I often want to start a list of virtual machines, but without taxing the system in the process by starting them all at the same time.  I could do that manually, but that’s no fun. Here’s a short function I wrote to sequentially start a list of virtual machines - the script will start a VM and wait for that VM to boot before starting the next VM. You can optionally also wait additional time before starting the next VM to give the first one some time to finish starting it’s services etc. This version currently supports Hyper-V only. The script does not currently return anything, but has a number of parameters: ComputerName - the name of the Hyper-V host. Specify “.” for the local machine (without quotes) VM - specify a comma separated list of VMs Wait - the number of seconds to wait between starting a VM after the previous VM. Specify the number of VMs as a number (integer) only. This will default to 180 seconds ShowProgress - Specify whether to show progress while starting the VMs. This is cosmetic only, but does give some indication as to how far through the boot process the script is. Other standard parameters such as Verbose are supported. Function Start-SequentialVMs { &lt;# .SYNOPSIS Starts a list of VMs. .DESCRIPTION This function starts a list of VMs sequentially. It will wait until a VM is booted, optionally pause for a number of seconds, before starting the next VM. .PARAMETER ComputerName Specifies the Hyper-V host to start the VM on. .PARAMETER VM Specifies a list of VMs to start. .PARAMETER Wait Specifies a number of seconds to wait after the previous VM has booted successfully. Defaults to 180 seconds. .PARAMETER ShowProgress Specified whether to show progress as VMs are started. .EXAMPLE Start-SequentialVMs -ComputerName hyperv1 -VMList &quot;sql1&quot;, &quot;pvs1&quot;, &quot;xd71&quot; -Wait 20 .NOTES .LINK Sequential Starting of a List of VMs #&gt; param( [Parameter(Mandatory=$true, Position=0,HelpMessage=&quot;Hyper-V host.&quot;)] [string]$ComputerName = $(throw = &quot;Please specify a remote Hyper-V host to start VMs on.&quot;), [Parameter(Mandatory=$true, Position=1,HelpMessage=&quot;List of VMs to start.&quot;)] [string[]]$VMList = $(throw = &quot;Please specifiy a list of VMs to start&quot;), [Parameter(Mandatory=$false)] [int]$Wait = 180, [Parameter(Mandatory=$false)] [bool]$ShowProgress ) # Connect to Hyper-V host before attempting to start VMs. Stop script if unable to connect Write-Verbose &quot;Connecting to VM host.&quot; Get-VMHost -ComputerName $ComputerName -Verbose $False -ErrorAction Stop # Start progress at 0 $Percent = 0 # Step through list of provided VMs ForEach ( $vm in $VMList ) { # Convert current location in list of VMs to a percentage $Percent = ($VMList.IndexOf($vm)/$VMList.Count) * 100 # Show progress if specified on the command line If ($ShowProgress -eq $True) { Write-Progress -Activity &quot;Starting VMs.&quot; -Status &quot;Starting VM $vm.&quot; -PercentComplete $Percent } # Get status for current VM Remove-Variable currentVM -ErrorAction SilentlyContinue Write-Verbose &quot;Getting status for VM $vm...&quot; $currentVM = Get-VM -ComputerName $ComputerName -Name $vm -ErrorAction SilentlyContinue # If the VM exists, then power it on if it is in an Off state If ($currentVM.Length -gt 0) { If ($currentVM.State -eq &quot;Off&quot; ) { Start-VM -ComputerName $ComputerName -Name $vm -Verbose # Wait for VM to boot and report a heartbeat Write-Verbose &quot;Waiting for VM heartbeat.&quot; Do { Start-Sleep -milliseconds 100 } Until ((Get-VMIntegrationService $currentVM | ?{$_.name -eq &quot;Heartbeat&quot;}).PrimaryStatusDescription -eq &quot;OK&quot;) # Wait the specified number of seconds before booting the next VM, unless this is the last VM in the list If ($Wait -gt 0 -and $VMList.IndexOf($vm) -lt ($VMList.Count-1)) { Write-Verbose &quot;Waiting for $Wait seconds before starting next VM.&quot; Start-Sleep -Seconds $Wait } } Else { Write-Verbose &quot;VM $vm already running.&quot; } } Else { Write-Error -Message &quot;Unable to find VM $vm on host $ComputerName.&quot; -Category ObjectNotFound } } Write-Verbose &quot;Started VMs.&quot; # Show progress if specified on the command line If ($ShowProgress -eq $True) { Write-Progress -Activity &quot;Starting VMs.&quot; -Status &quot;Started all VMs.&quot; -PercentComplete 100 } Start-Sleep -Seconds 1 } Save the script as Start-SequentialVMs.ps1 and run it or add the function to your PowerShell profile so that the function is available when starting PowerShell. Use Get-Help to see the full syntax and examples from within a PowerShell window." />
<link rel="canonical" href="/sequential-start-vms/" />
<meta property="og:url" content="/sequential-start-vms/" />
<meta property="og:site_name" content="aaron parker" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-02-27T13:16:51+11:00" />
<script type="application/ld+json">
{"description":"In my lab environment, I often want to start a list of virtual machines, but without taxing the system in the process by starting them all at the same time.  I could do that manually, but that’s no fun. Here’s a short function I wrote to sequentially start a list of virtual machines - the script will start a VM and wait for that VM to boot before starting the next VM. You can optionally also wait additional time before starting the next VM to give the first one some time to finish starting it’s services etc. This version currently supports Hyper-V only. The script does not currently return anything, but has a number of parameters: ComputerName - the name of the Hyper-V host. Specify “.” for the local machine (without quotes) VM - specify a comma separated list of VMs Wait - the number of seconds to wait between starting a VM after the previous VM. Specify the number of VMs as a number (integer) only. This will default to 180 seconds ShowProgress - Specify whether to show progress while starting the VMs. This is cosmetic only, but does give some indication as to how far through the boot process the script is. Other standard parameters such as Verbose are supported. Function Start-SequentialVMs { &lt;# .SYNOPSIS Starts a list of VMs. .DESCRIPTION This function starts a list of VMs sequentially. It will wait until a VM is booted, optionally pause for a number of seconds, before starting the next VM. .PARAMETER ComputerName Specifies the Hyper-V host to start the VM on. .PARAMETER VM Specifies a list of VMs to start. .PARAMETER Wait Specifies a number of seconds to wait after the previous VM has booted successfully. Defaults to 180 seconds. .PARAMETER ShowProgress Specified whether to show progress as VMs are started. .EXAMPLE Start-SequentialVMs -ComputerName hyperv1 -VMList &quot;sql1&quot;, &quot;pvs1&quot;, &quot;xd71&quot; -Wait 20 .NOTES .LINK Sequential Starting of a List of VMs #&gt; param( [Parameter(Mandatory=$true, Position=0,HelpMessage=&quot;Hyper-V host.&quot;)] [string]$ComputerName = $(throw = &quot;Please specify a remote Hyper-V host to start VMs on.&quot;), [Parameter(Mandatory=$true, Position=1,HelpMessage=&quot;List of VMs to start.&quot;)] [string[]]$VMList = $(throw = &quot;Please specifiy a list of VMs to start&quot;), [Parameter(Mandatory=$false)] [int]$Wait = 180, [Parameter(Mandatory=$false)] [bool]$ShowProgress ) # Connect to Hyper-V host before attempting to start VMs. Stop script if unable to connect Write-Verbose &quot;Connecting to VM host.&quot; Get-VMHost -ComputerName $ComputerName -Verbose $False -ErrorAction Stop # Start progress at 0 $Percent = 0 # Step through list of provided VMs ForEach ( $vm in $VMList ) { # Convert current location in list of VMs to a percentage $Percent = ($VMList.IndexOf($vm)/$VMList.Count) * 100 # Show progress if specified on the command line If ($ShowProgress -eq $True) { Write-Progress -Activity &quot;Starting VMs.&quot; -Status &quot;Starting VM $vm.&quot; -PercentComplete $Percent } # Get status for current VM Remove-Variable currentVM -ErrorAction SilentlyContinue Write-Verbose &quot;Getting status for VM $vm...&quot; $currentVM = Get-VM -ComputerName $ComputerName -Name $vm -ErrorAction SilentlyContinue # If the VM exists, then power it on if it is in an Off state If ($currentVM.Length -gt 0) { If ($currentVM.State -eq &quot;Off&quot; ) { Start-VM -ComputerName $ComputerName -Name $vm -Verbose # Wait for VM to boot and report a heartbeat Write-Verbose &quot;Waiting for VM heartbeat.&quot; Do { Start-Sleep -milliseconds 100 } Until ((Get-VMIntegrationService $currentVM | ?{$_.name -eq &quot;Heartbeat&quot;}).PrimaryStatusDescription -eq &quot;OK&quot;) # Wait the specified number of seconds before booting the next VM, unless this is the last VM in the list If ($Wait -gt 0 -and $VMList.IndexOf($vm) -lt ($VMList.Count-1)) { Write-Verbose &quot;Waiting for $Wait seconds before starting next VM.&quot; Start-Sleep -Seconds $Wait } } Else { Write-Verbose &quot;VM $vm already running.&quot; } } Else { Write-Error -Message &quot;Unable to find VM $vm on host $ComputerName.&quot; -Category ObjectNotFound } } Write-Verbose &quot;Started VMs.&quot; # Show progress if specified on the command line If ($ShowProgress -eq $True) { Write-Progress -Activity &quot;Starting VMs.&quot; -Status &quot;Started all VMs.&quot; -PercentComplete 100 } Start-Sleep -Seconds 1 } Save the script as Start-SequentialVMs.ps1 and run it or add the function to your PowerShell profile so that the function is available when starting PowerShell. Use Get-Help to see the full syntax and examples from within a PowerShell window.","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/sequential-start-vms/","headline":"Sequential Starting of a List of VMs","dateModified":"2014-02-27T13:16:51+11:00","datePublished":"2014-02-27T13:16:51+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"/sequential-start-vms/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="aaron parker" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">aaron parker</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">ABOUT</a><a class="page-link" href="/smb-not-cifs.html">SMB not CIFS</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Sequential Starting of a List of VMs</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2014-02-27T13:16:51+11:00" itemprop="datePublished">Feb 27, 2014
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>In my lab environment, I often want to start a list of virtual machines, but without taxing the system in the process by starting them all at the same time.  I could do that manually, but that’s no fun.</p>

<p>Here’s a short function I wrote to sequentially start a list of virtual machines - the script will start a VM and wait for that VM to boot before starting the next VM. You can optionally also wait additional time before starting the next VM to give the first one some time to finish starting it’s services etc.</p>

<p>This version currently supports Hyper-V only. The script does not currently return anything, but has a number of parameters:</p>

<ul>
  <li>ComputerName - the name of the Hyper-V host. Specify “.” for the local machine (without quotes)</li>
  <li>VM - specify a comma separated list of VMs</li>
  <li>Wait - the number of seconds to wait between starting a VM after the previous VM. Specify the number of VMs as a number (integer) only. This will default to 180 seconds</li>
  <li>ShowProgress - Specify whether to show progress while starting the VMs. This is cosmetic only, but does give some indication as to how far through the boot process the script is.</li>
  <li>Other standard parameters such as Verbose are supported.</li>
</ul>

<pre class="lang:ps decode:true " title="Start-SequentialVMs">Function Start-SequentialVMs {
    &lt;#
        .SYNOPSIS
            Starts a list of VMs.
 
        .DESCRIPTION
            This function starts a list of VMs sequentially. It will wait until a VM is booted, optionally pause for a number of seconds, before starting the next VM.
 
        .PARAMETER ComputerName
            Specifies the Hyper-V host to start the VM on.
 
        .PARAMETER VM
            Specifies a list of VMs to start.
 
        .PARAMETER Wait
            Specifies a number of seconds to wait after the previous VM has booted successfully. Defaults to 180 seconds.

        .PARAMETER ShowProgress
            Specified whether to show progress as VMs are started.
 
        .EXAMPLE
            Start-SequentialVMs -ComputerName hyperv1 -VMList "sql1", "pvs1", "xd71" -Wait 20

        .NOTES
 
        .LINK
            

<blockquote class="wp-embedded-content" data-secret="WXxzFe2uBt">
  <a href="http://stealthpuppy.com/sequential-start-vms/">Sequential Starting of a List of VMs</a>
</blockquote>
 
    #&gt;
    param(
        [Parameter(Mandatory=$true, Position=0,HelpMessage="Hyper-V host.")]
        [string]$ComputerName = $(throw = "Please specify a remote Hyper-V host to start VMs on."),

        [Parameter(Mandatory=$true, Position=1,HelpMessage="List of VMs to start.")]
        [string[]]$VMList = $(throw = "Please specifiy a list of VMs to start"),

        [Parameter(Mandatory=$false)]
        [int]$Wait = 180,

        [Parameter(Mandatory=$false)]
        [bool]$ShowProgress
    )

    # Connect to Hyper-V host before attempting to start VMs. Stop script if unable to connect
    Write-Verbose "Connecting to VM host."
    Get-VMHost -ComputerName $ComputerName -Verbose $False -ErrorAction Stop

    # Start progress at 0
    $Percent = 0

    # Step through list of provided VMs
    ForEach ( $vm in $VMList ) {

        # Convert current location in list of VMs to a percentage
        $Percent = ($VMList.IndexOf($vm)/$VMList.Count) * 100

        # Show progress if specified on the command line
        If ($ShowProgress -eq $True) { Write-Progress -Activity "Starting VMs." -Status "Starting VM $vm." -PercentComplete $Percent }

        # Get status for current VM
        Remove-Variable currentVM -ErrorAction SilentlyContinue
        Write-Verbose "Getting status for VM $vm..."
        $currentVM = Get-VM -ComputerName $ComputerName -Name $vm -ErrorAction SilentlyContinue

        # If the VM exists, then power it on if it is in an Off state
        If ($currentVM.Length -gt 0) {
            If ($currentVM.State -eq "Off" ) {
                Start-VM -ComputerName $ComputerName -Name $vm -Verbose
                
                # Wait for VM to boot and report a heartbeat
                Write-Verbose "Waiting for VM heartbeat."
                Do {
                    Start-Sleep -milliseconds 100
                } Until ((Get-VMIntegrationService $currentVM | ?{$_.name -eq "Heartbeat"}).PrimaryStatusDescription -eq "OK")

                # Wait the specified number of seconds before booting the next VM, unless this is the last VM in the list
                If ($Wait -gt 0 -and $VMList.IndexOf($vm) -lt ($VMList.Count-1)) {
                    Write-Verbose "Waiting for $Wait seconds before starting next VM."
                    Start-Sleep -Seconds $Wait
                }

            } Else {
                Write-Verbose "VM $vm already running."
            }

        } Else {
            Write-Error -Message "Unable to find VM $vm on host $ComputerName." -Category ObjectNotFound
        }

     }

     Write-Verbose "Started VMs."

     # Show progress if specified on the command line
     If ($ShowProgress -eq $True) { Write-Progress -Activity "Starting VMs." -Status "Started all VMs." -PercentComplete 100 }
     Start-Sleep -Seconds 1
}</pre>

<p>Save the script as <em>Start-SequentialVMs.ps1</em> and run it or add the function to your <a href="http://technet.microsoft.com/en-us/library/ee692764.aspx">PowerShell profile</a> so that the function is available when starting PowerShell. Use Get-Help to see the full syntax and examples from within a PowerShell window.</p>

  </div><a class="u-url" href="/sequential-start-vms/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">aaron parker</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">aaron parker</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/aaronparker"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">aaronparker</span></a></li><li><a href="https://www.twitter.com/stealthpuppy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">stealthpuppy</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>on end user computing and enterprise mobility
</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
