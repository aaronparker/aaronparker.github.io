<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Windows PE 2.0 and VMware Workstation | stealthpuppy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Windows PE 2.0 and VMware Workstation" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I’m working on a Presentation Server deployment project at the moment, and am deploying the servers with Windows PE 2.0 via Windows Deployment Services (WDS). I need to launch Windows Setup via WINNT32.EXE because the servers have two RAID sets and the client wants the user profiles on the second disk set. So before deploying the unattended setup to hardware, I’m testing the deployment in VMware Workstation. Unfortunately Windows PE 2.0 does not recognise the VMware network card out of the box, so I’ve had to create a custom WinPE image with the drivers in it. This is the first time I’ve done this with Windows PE 2.0 so there was a little trial and error. Here are the steps I completed to create my custom image:" />
<meta property="og:description" content="I’m working on a Presentation Server deployment project at the moment, and am deploying the servers with Windows PE 2.0 via Windows Deployment Services (WDS). I need to launch Windows Setup via WINNT32.EXE because the servers have two RAID sets and the client wants the user profiles on the second disk set. So before deploying the unattended setup to hardware, I’m testing the deployment in VMware Workstation. Unfortunately Windows PE 2.0 does not recognise the VMware network card out of the box, so I’ve had to create a custom WinPE image with the drivers in it. This is the first time I’ve done this with Windows PE 2.0 so there was a little trial and error. Here are the steps I completed to create my custom image:" />
<link rel="canonical" href="/windows-pe-20-and-vmware-workstation/" />
<meta property="og:url" content="/windows-pe-20-and-vmware-workstation/" />
<meta property="og:site_name" content="stealthpuppy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2006-12-14T06:32:00+11:00" />
<script type="application/ld+json">
{"description":"I’m working on a Presentation Server deployment project at the moment, and am deploying the servers with Windows PE 2.0 via Windows Deployment Services (WDS). I need to launch Windows Setup via WINNT32.EXE because the servers have two RAID sets and the client wants the user profiles on the second disk set. So before deploying the unattended setup to hardware, I’m testing the deployment in VMware Workstation. Unfortunately Windows PE 2.0 does not recognise the VMware network card out of the box, so I’ve had to create a custom WinPE image with the drivers in it. This is the first time I’ve done this with Windows PE 2.0 so there was a little trial and error. Here are the steps I completed to create my custom image:","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/windows-pe-20-and-vmware-workstation/","headline":"Windows PE 2.0 and VMware Workstation","dateModified":"2006-12-14T06:32:00+11:00","datePublished":"2006-12-14T06:32:00+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"/windows-pe-20-and-vmware-workstation/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="stealthpuppy" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">stealthpuppy</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">About</a><a class="page-link" href="/appv-faqs.html">App-V 4.x FAQs</a><a class="page-link" href="/appv5-faqs.html">Microsoft Application Virtualization 5 FAQs</a><a class="page-link" href="/appvrecipes.html">App-V Recipes</a><a class="page-link" href="/home-page.html">Home Page</a><a class="page-link" href="/scriptcorner.html">Script Corner</a><a class="page-link" href="/smb-not-cifs.html">SMB not CIFS</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Windows PE 2.0 and VMware Workstation</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2006-12-14T06:32:00+11:00" itemprop="datePublished">Dec 14, 2006
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>I’m working on a Presentation Server deployment project at the moment, and am deploying the servers with Windows PE 2.0 via <a href="http://www.microsoft.com/windowsserver/longhorn/deployment/services.mspx">Windows Deployment Services</a> (WDS). I need to launch Windows Setup via WINNT32.EXE because the servers have two RAID sets and the client wants the user profiles on the second disk set. So before deploying the unattended setup to hardware, I’m testing the deployment in VMware Workstation. Unfortunately Windows PE 2.0 does not recognise the VMware network card out of the box, so I’ve had to create a custom WinPE image with the drivers in it. This is the first time I’ve done this with Windows PE 2.0 so there was a little trial and error. Here are the steps I completed to create my custom image:</p>

<p>First I mounted the WIM image with ImageX. I have a copy of the original WINPE.WIM under D:\Images and I’ve created a folder D:\Mount, in which to mount the image:</p>

<p>[code]imagex.exe /mountrw d:\images\winpe.wim 1 d:\mount[/code]</p>

<p>Next I injected the VMware drivers into the mounted image. I installed both drivers, but in my case VMware Workstation only required the vmware-nic.inf driver:</p>

<p>[code]peimg.exe /inf=D:\vmdrv\vmxnet.inf d:\mount\Windows<br />
peimg.exe /inf=D:\vmdrv\vmware-nic.inf d:\mount\Windows[/code]</p>

<p>The next step was to install the scripting packages into the image to allow advanced tools such as HTA applications:</p>

<p>[code]peimg.exe /install=*HTA* /image=d:\mount\Windows<br />
peimg.exe /install=*Scripting* /image=d:\mount\Windows<br />
peimg.exe /install=*WMI* /image=d:\mount\Windows<br />
peimg.exe /install=*XML* /image=d:\mount\Windows[/code]</p>

<p>Then I needed to prepare the image, which optimises the image by removing non-required packages and language packs. This is a one way process, so if you need to add more packages at a later date, you’ll have to recreate your image:</p>

<p>[code]peimg.exe /prep /image=d:\mount\Windows[/code]</p>

<p>Then unmount the image and commit the changes:</p>

<p>[code]imagex.exe /unmount d:\mount /commit[/code]</p>

<p>Lastly I added the boot image into WDS and booted my VM to the network and I finally had an IP address and network client to connect to the deployment server. One thing I did notice but didn’t get a chance to troubleshoot is that I occasionally had to restart WDS to get Windows PE to boot after making changes to the image.</p>

<p>The documentation that comes with the <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=c7d4bc6d-15f3-4284-9123-679830d629f2&amp;DisplayLang=en">Windows Automated Installation Kit</a> is fairly detailed but it doesn’t really fill in a lot of the gaps. To help me out I found a couple of links around the place, like <a href="http://www.msfn.org/board/index.php?act=ST&amp;f=81&amp;t=81802">this thread on MSFN.org</a> and this <a href="http://www.uvm.edu/~jgm/wordpress/?p=51">WinPE2 with BDD 3.0 beta</a> post at J. Greg’s Blog-o-rama.</p>

<p><strong>UPDATE</strong>: Of course you could just select Windows Vista as the virtual machine type when creating the virtual machine, but where’s the fun in that?</p>

  </div><a class="u-url" href="/windows-pe-20-and-vmware-workstation/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">stealthpuppy</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">stealthpuppy</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/aaronparker"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">aaronparker</span></a></li><li><a href="https://www.twitter.com/stealthpuppy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">stealthpuppy</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>on end user computing and enterprise mobility
</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
