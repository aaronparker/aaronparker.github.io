<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Unattended Citrix Advanced Access Control Part 1 | stealthpuppy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Unattended Citrix Advanced Access Control Part 1" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I’ve spent some time in the past couple of days working out how to do an unattended install of Web Interface and Advanced Access Control and certainly been a challenge. Whilst I haven’t worked everything out, I thought that I would outline what I’ve found out thus far. Why would we want to automate the installation of AAC? Just like your Terminal Servers, the servers running AAC should be stateless, so an unattended installation will provide a method for replicating servers and for disaster recovery." />
<meta property="og:description" content="I’ve spent some time in the past couple of days working out how to do an unattended install of Web Interface and Advanced Access Control and certainly been a challenge. Whilst I haven’t worked everything out, I thought that I would outline what I’ve found out thus far. Why would we want to automate the installation of AAC? Just like your Terminal Servers, the servers running AAC should be stateless, so an unattended installation will provide a method for replicating servers and for disaster recovery." />
<link rel="canonical" href="/unattended-citrix-advanced-access-control-part-1/" />
<meta property="og:url" content="/unattended-citrix-advanced-access-control-part-1/" />
<meta property="og:site_name" content="stealthpuppy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2007-03-22T18:30:00+11:00" />
<script type="application/ld+json">
{"description":"I’ve spent some time in the past couple of days working out how to do an unattended install of Web Interface and Advanced Access Control and certainly been a challenge. Whilst I haven’t worked everything out, I thought that I would outline what I’ve found out thus far. Why would we want to automate the installation of AAC? Just like your Terminal Servers, the servers running AAC should be stateless, so an unattended installation will provide a method for replicating servers and for disaster recovery.","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/unattended-citrix-advanced-access-control-part-1/","headline":"Unattended Citrix Advanced Access Control Part 1","dateModified":"2007-03-22T18:30:00+11:00","datePublished":"2007-03-22T18:30:00+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"/unattended-citrix-advanced-access-control-part-1/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="stealthpuppy" /></head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">stealthpuppy</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">ABOUT</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Unattended Citrix Advanced Access Control Part 1</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2007-03-22T18:30:00+11:00" itemprop="datePublished">Mar 22, 2007
      </time><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card"
          itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>I’ve spent some time in the past couple of days working out how to do an unattended install of Web Interface and Advanced Access Control and certainly been a challenge. Whilst I haven’t worked everything out, I thought that I would outline what I’ve found out thus far. Why would we want to automate the installation of AAC? Just like your Terminal Servers, the servers running AAC should be stateless, so an unattended installation will provide a method for replicating servers and for disaster recovery.</p>

<p>In this scenario I’m installing everything on a single server to make it easier to illustrate the installation of each component; however it won’t be take much to apply this to a distributed system. I tested this on Windows Server 2003 Service Pack 2 with the database hosted in SQL Server 2005 Express Edition Service Pack 2.</p>

<h3 id="internet-information-services">Internet Information Services</h3>

<p>In most cases I would recommend installing IIS as a part of an unattended installation of Windows Server, however if that’s not the case, installing IIS after the OS is on the box here’s how:</p>

<p>First we need to create an unattended answer file. I’m doing this by using the script to creating the answer file. For a full listing of the options in the answer file you should check out the <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=a34edcf2-ebfd-4f99-bbc4-e93154c332d6&amp;DisplayLang=en">Windows Server 2003 Deployment Tools</a>. As you can see in this script, I’m enabling ASP.NET along with IIS.</p>

<p>[code]ECHO [InternetServer] &gt; IIS.TXT<br />
ECHO PathWWWRoot = C:\Inetpub\wwwroot » IIS.TXT<br />
ECHO [Components] » IIS.TXT<br />
ECHO aspnet=on » IIS.TXT<br />
ECHO iis_asp=on » IIS.TXT<br />
ECHO iis_common=on » IIS.TXT<br />
ECHO iis_ftp=off » IIS.TXT<br />
ECHO iis_inetmgr=on » IIS.TXT<br />
ECHO iis_internetdataconnector=off » IIS.TXT<br />
ECHO iis_nntp=off » IIS.TXT<br />
ECHO iis_serversideincludes=off » IIS.TXT<br />
ECHO iis_smtp=off » IIS.TXT<br />
ECHO iis_webdav=off » IIS.TXT<br />
ECHO iis_www=on » IIS.TXT[/code]</p>

<p>To install IIS, we can use SYSOCMGR.EXE and the answer file (also see the Deployment Tools on how to use SYSOCMGR):</p>

<p>[code]START /WAIT SYSOCMGR /u:IIS.TXT /i:%systemroot%\inf\sysoc.inf[/code]</p>

<h3 id="net-framework-20">.NET Framework 2.0</h3>

<p>I’ve got more details on installing the .NET Framework <a href="http://www.stealthpuppy.com/blogs/travelling/pages/Unattended-Install_3A00_-Microsoft-.NET-Framework.aspx">here</a>, but all we need is .NET Framework 2.0:</p>

<p>[code]START /WAIT DOTNETFX.EXE /Q:A /C:”INSTALL.EXE /Q”[/code]</p>

<h3 id="sql-server-2005-express-edition-and-sql-server-management-studio-express">SQL Server 2005 Express Edition and SQL Server Management Studio Express</h3>

<p>I wanted to use the <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=31711d5d-725c-4afa-9d65-e4465cdff1e7&amp;DisplayLang=en">latest version</a> of SQL Server 2005 Express Edition rather than the Service Pack 1 version included on the Advanced Access Control CD. For AAC we need to install an instance of SQL Server named CitrixACC. In the script, I’m extracting the contents of the downloaded file before installing (%CD% is the current folder):</p>

<p>[code]MD %CD%\SQLExpress<br />
START /WAIT SQLEXPR32 /X:%CD%\SQLExpress<br />
START /WAIT %CD%\SQLExpress\SETUP INSTANCENAME=CitrixAAC /QB<br />
START /WAIT MSIEXEC /I SQLServer2005_SSMSEE.MSI ALLUSERS=TRUE REBOOT=SUPRESS /QB-[/code]</p>

<h3 id="visual-j-version-20-redistributable">Visual J# Version 2.0 Redistributable</h3>

<p>The <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=f72c74b3-ed0e-4af8-ae63-2f0e42501be1&amp;DisplayLang=en">Visual J#</a> install command is similar to the .NET Framework:</p>

<p>[code]START /WAIT VJREDIST.EXE /Q:A /C:”INSTALL.EXE /Q”[/code]</p>

<h3 id="citrix-access-management-console">Citrix Access Management Console</h3>

<p>The different components of the Access Management Console are Windows Installer files so the installation is pretty straightforward. Here I’m installing the components that come on the AAC CD as well as the Web Interface plug-in:</p>

<p>[code]START /WAIT MSIEXEC /I ASC_Framework.msi ALLUSERS=TRUE REBOOT=SUPRESS /QB-<br />
START /WAIT MSIEXEC /I ASC_Diagnostics.msi ALLUSERS=TRUE REBOOT=SUPRESS /QB-<br />
START /WAIT MSIEXEC /I ASC_Licensing.msi ALLUSERS=TRUE REBOOT=SUPRESS /QB-<br />
START /WAIT MSIEXEC /I ASC_WebInterface ALLUSERS=TRUE REBOOT=SUPRESS /QB-[/code]</p>

<h3 id="web-interface-45">Web Interface 4.5</h3>

<p>Unattended installation of Web Interface is in two parts. The first is installing Web Interface itself and the second is using SITEMGR.EXE to create Web Interface and Program Neighbourhood sites. To get a full list of the command line options for SITEMGR, run SITEMGR /?.</p>

<p>[code]START /WAIT WebInterface.exe -q<br />
PUSHD “%ProgramFiles%\Citrix\Web Interface\4.5”<br />
START /WAIT sitemgr.exe -c “WIDest=1:/Citrix/AccessPlatform,Config=Local,XMLService=ts1.company.local,ts2.company.local,XMLSPort=80,AppAccessMethods=Remote”<br />
START /WAIT sitemgr.exe -c “PNADest=1:/Citrix/PNAgent,Config=Local,XMLService=ts1.company.local;ts2.company.local,XMLSPort=80,AppAccessMethods=Remote”<br />
POPD[/code]</p>

<h3 id="microsoft-office-and-visio-2003">Microsoft Office and Visio 2003</h3>

<p>To create an unattended installation of Office 2003 you’ll need the Custom Installation Wizard from the <a href="http://office.microsoft.com/en-au/products/FX011511471033.aspx">Office Resource Kit</a>. I recommend installing the minimum Office components only; I’ll have a bit more on this in another post. In this script, I’m installing Office from the CD image (rather than an administrative install) and then installing the latest service pack:</p>

<p>[code]START /WAIT Office2003SP2-KB887616-FullFile-ENU.exe /T:%CD%\UNPACK /Q /C<br />
START /WAIT MSIEXEC /P %CD%\UNPACK\MAINSP2ff.MSP /QB-<br />
RD /Q /S %CD%\UNPACK &amp; MD %CD%\UNPACK<br />
START /WAIT Visio2003SP2-KB887622-FullFile-ENU.EXE /T:%CD%\UNPACK /Q /C<br />
START /WAIT MSIEXEC /P %CD%\UNPACK\VISIOSP2.MSP /QB-[/code]</p>

<h3 id="exchange-server-2003-management-tools">Exchange Server 2003 Management Tools</h3>

<p>Installing Exchange Server requires creating an answer file which you can do with the <a href="http://www.microsoft.com/technet/prodtechnol/exchange/2003/unattend.mspx"><em>createunattend</em></a> command line switch. These lines install the management tools and Service Pack 2:</p>

<p>[code]START /WAIT SETUP /unattendfile ExchangeManagementToolSetup.ini<br />
START /WAIT UPDATE /unattendfile ExchangeSP2Setup.ini[/code]</p>

<h3 id="advanced-access-control">Advanced Access Control</h3>

<p>Now here’s we the unattended setup falls down a bit. The setup application for AAC (SETUP.EXE) has some command line switches however documentation of those switches is extremely slim. I can only find <em>logfilepath</em> in the documentation and I’ve come across <em>silent</em> but it doesn’t appear to do much. I presume there are more and I’m attempting to track those down through Citrix, so hopefully more on this later.</p>

<p>Once Advanced Access Control is installed you can then use Citrix.Msam.ServerConfig.ConfigTool.exe to create the Access Gateway farm or add servers to the farm. This is similar to Exchange where we create an answer file and then use it to automate server installs. To create an answer file use the <em>createconfig</em> switch and then <em>fromconfig</em> to automate the configuration. To see the full list of switches run Citrix.Msam.ServerConfig.ConfigTool.exe /?.</p>

<p>[code]”C:\Program Files\Citrix\Access Gateway\Bin\Citrix.Msam.ServerConfig.ConfigTool.exe” /fromconfg AACConfig.txt[/code]</p>

<p>Here’s what AACConfig.TXT looks like:</p>

<blockquote>
  <MsamServerConfig>  
<ServiceAccount>  
<Username>username</Username>  
<Password>password</Password>  
<Domain>DOMAIN</Domain>  
</ServiceAccount>  
<ServerFarm type="Create">  
<DBServer>SERVER\CITRIXAAC</DBServer>  
<FarmName>AccessGateway</FarmName>  
<ServerRoles>Admin|HTML Preview</ServerRoles>  
<DatabaseAccount type="windows" />  
</ServerFarm>  
<RadiusConfig>  
<Secret></Secret>  
</RadiusConfig>  
<LicenseConfig>  
<LicServer>localhost</LicServer>  
<Port>27000</Port>  
</LicenseConfig>  
<WSVirtualPath>IIS://LocalHost/W3SVC/1/Root</WSVirtualPath>  
<WSBasePath>c:\inetpub\wwwroot</WSBasePath>  
<WSPort>80</WSPort>  
<SSlEnabled>False</SSlEnabled>  
</MsamServerConfig>
</blockquote>

<h3 id="what-have-we-got-so-far">What Have We Got So Far?</h3>

<p>Whilst this won’t get you all the way through an unattended installation, most of the components that are time consuming and make you watch a blue progress bar have been automated. I’ve still got a few more components to look at and I’ll go over these in a second article.</p>

  </div><a class="u-url" href="/unattended-citrix-advanced-access-control-part-1/" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col one-half">
      <h2 class="footer-heading">stealthpuppy</h2>
        <ul class="contact-list">
          <li class="p-name">stealthpuppy</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col one-half">
        <p>on end user computing and enterprise mobility</p>
      </div>

      <div class="social-links"><ul class="social-media-list"><li><a href="https://github.com/aaronparker" title="aaronparker"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a href="https://www.linkedin.com/in/aaronedwardparker" title="aaronedwardparker"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a href="https://twitter.com/stealthpuppy" title="stealthpuppy"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li><li><a href="/feed.xml" title="atom"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg></a></li></ul>
</div>
    </div>

  </div>

</footer>
</body>

</html>
