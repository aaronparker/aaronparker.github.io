<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>A Better Way to Customize the Windows Default Profile | aaron parker</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="A Better Way to Customize the Windows Default Profile" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Multiple Methods The Deployment Guys have a great article from 2009 that I recommend reading for a overview of customisation methods: Configuring Default User Settings – Full Update for Windows 7 and Windows Server 2008 R2. This article is still applicable today and the process hasn’t changed that much between Windows versions. Here are most of the ways that you could edit the default user profile: Copy a configured profile over the default profile - this is the most common way of changing the default user experience but this approach is unsupported by Microsoft and therefore I recommend against using it. Using Sysprep and the CopyProfile value - this approach requires creating a reference image and using Sysprep to generalise the image. Many enterprise desktop deployments will use reference images so this isn’t too hard; however Microsoft has not documented every setting that is copied to the default user profile, so it’s a bit of pot luck. Place a default profile in NETLOGON - a default profile copied to the NETLOGON share of a domain controller (and replicated) will be copied down to the local machine at first logon. The downside of this approach is that there can be only one default profile and it will be copied to all machines, regardless as to whether the profile should apply to that machine or not. Commands or scripts run from the RunOnce Registry key to edit the user profile. Logon scripts to edit the user profile. Group Policy Preferences - GPP has become more prevalent in the past few years, so should now be available across the board. Editing the default profile directly, typically during an automated deployment, but you could run the same script on any existing PC. So there are multiple methods (of driving yourself to madness), I’d recommend experimenting with each approach and you’ll most likely implement a combination of approaches to best suit your environment. Group Policy As A Last Resort Group Policy is great, until it isn’t. Group Policy is pervasive and every Windows admin is familiar with it, but there a two things to consider when using it to manage the default user experience: Group Policy is is a policy - that is, if you’re using policies to manage default user settings, the user cannot then change to their own preference. Group Policy Preferences must be processed to determine whether they have been applied. Whilst GPPs can implement a preference rather than a policy, Windows must determine whether the preference has been applied by reading a flag. Whilst checking those flags isn’t a big problem, implementing GPPs should be considered in the context of whatever else is running at logon, how many preferences are implemented plus what happens to the environment over time (how many additional policies, applications, scripts etc. will be added to the environment over the life of that desktop). I have seen many organisations over-relying on Group Policy and missing the most important component user environment management - change control and ownership. Group Policy becomes a black hole, complete with settings that no one can remember why they were implemented and settings that are no longer relevant. Group Policy Preferences are great for replacing logon scripts, but use Group Policy and GPP sparingly so as not to adversely affect the user experience. A Better Way - Edit the Default Profile Directly My preferred method for modifying the default user experience is to edit the default user profile directly using a script that is run during Windows deployment. This type of script can also be run on existing machines or used in combination with CopyProfile. A benefit of this approach is that you can modify the default profile with or without a reference image. Editing the Default Profile To edit the default profile, we’ll use the command line tool REG to mount and make changes to the default user registry hive. Additionally we can make folder and file changes to the default profile and a couple of other command line tools to perform tasks such as pin and unpin shortcuts or change the Windows 7 Libraries. As far as this article is concerned, the default profile is in its default location, usually C:\Users\Default. In a script, you could refer to this location as %SystemDrive%\Users\Default. Finding Settings To find the profile locations to modify there’s a couple of methods that I rely on: Google (or your favourite search engine) Process Monitor and Process Explorer In most cases, someone (or even Microsoft) will have documented a registry value or profile location that is used to store a setting. More obscure or new settings will require detecting the location with Process Monitor. For example, to determine where a setting is stored in the Registry, create a filter in Process Monitor using the process name or process ID, additionally filtering on the operation such as RegSetValue, as shown below: A trace with Process Monitor when making a preference change should result in something like this: Regshot is also useful for comparing a before and after change to the profile for determining registry value locations. Additionally Process Explorer can be useful for tracking down a process that might be responsible for writing a setting by viewing the command line used to launch the process. Finding settings can sometimes be a time consuming process, but once found and documented, you’ve got a detailed understanding of the default profile. Editing the Registry To make direct registry edits to the default user profile, the REG command line utility is used to load the default profile registry hive, change a registry value and then unload the hive, saving it back to the default profile. The following lines show a rough example of how this is done: REG LOAD HKU\DefaultUser %SystemDrive%\Users\Default\NTUSER.DAT REG ADD HKU\DefaultUser\Software\KeyName /v ValueName /d Data /t REG_SZ /f REG UNLOAD HKU\DefaultUser Note that this will need to be run with administrative privileges and in an elevated context, so that you have write access to the default profile. Pinning and Unpinning Shortcuts A common requirement is to modify the the pinned shortcuts on the Taskbar or Start menu. This can be automated using a script, which needs to run a first logon (either as the user, or in the profile copied over the default profile via Sysprep/CopyProfile). Unfortunately I can’t find the original source for this script; however it works quite well and allows you to pin shortcuts to and unpin shortcuts from the Taskbar and Start menu via a command line. The script is available here: [download id=&#8221;62&#8243; format=&#8221;1&#8243;] Note that Windows 8 and above, do not expose a programatic method to pin and unpin shortcuts to the Start screen. If you’re looking to customise the Start screen, refer to this existing article: http://stealthpuppy.com/customizing-the-windows-8-1-start-screen-dont-follow-microsofts-guidance/. Modifying the Windows Libraries By default, the Libraries introduced in Windows 7, include the public folder locations. Removing these or adding locations requires editing the Libraries; however they’re stored in XML files and are created at first logon. To modify the libraries, you can use a command line tool ShLib.exe. Like pinning and unpinning shortcuts, this tool also needs to be run at first logon (and won’t work via CopyProfile). This article, Administratively Create and Modify Windows 7 Libraries, covers the use of ShLib.exe quite well. Implementing a Script to Modify the Default Profile Once you’ve created your script to make changes to the default registry, modify the default profile folder locations, pin and unpin shortcuts and make changes to the Libraries, you’ll need to implement the changes on the target PCs via script. Using an automation solution such as the Microsoft Deployment Toolkit (or an ESD like System Center Configuration Manager) the script can be run during a deployment task sequence. In the case of MDT, the script will be run after Windows unattended setup has completed in the local Administrator context. This way the script will have full elevation and write access to the default profile. An ESD solution will typically run the script via the local SYSTEM account. If you need to make changes to existing PCs, you’ll need a method to do so, such as an advertisement in Configuration Manager. If you take this approach, you can combine a script that makes direct changes to the default profile with the CopyProfile approach. That allows you to modify the profile for deployments from an unmodified OS as well as a custom image, keeping consistency across deployment types. Example Scripts Included here, along with some notation, are some example scripts for modifying the Windows 7 and Windows 8.1 default profiles. These example scripts include creation of a script at runtime that will run during first logon of any new profile. This is implemented as a batch file to keep things as simple as possible. Users will see a Command Prompt window as the script runs (but only once). The command lines includes in the script could be implemented with a UEM solution such as AppSense Environment Manager or even Group Policy to improve the user experience. Windows 7 Here’s a sample script that will modify the default profile on a Windows 7 PC (x86 and x64). At a high level, the script will perform the following steps: Load and modifies the registry of the default profile Copies ExecuteVerbAction.VBS and ShLib.exe to folder under %ProgramFiles% Creates a batch script that will run on first logon to edit the Libraries and pin/unpin shortcuts. Once the script runs for the user, it will delete itself. @ECHO OFF REM Load the default profile hive SET HKEY=HKU\Default REG LOAD %HKEY% %SystemDrive%\Users\Default\NTUSER.DAT REM Sound and end-application REG ADD &quot;%HKEY%\Control Panel\Sound&quot; /v Beep /t REG_SZ /d NO /f REG ADD &quot;%HKEY%\Control Panel\Sound&quot; /v ExtendedSounds /t REG_SZ /d NO /f REG ADD &quot;%HKEY%\Control Panel\Desktop&quot; /v HungAppTimeout /t REG_SZ /d 5000 /f REG ADD &quot;%HKEY%\Control Panel\Desktop&quot; /v AutoEndTasks /t REG_SZ /d 1 /f REG ADD &quot;%HKEY%\Control Panel\Desktop&quot; /v WaitToKillAppTimeout /t REG_SZ /d 4000 /f REM Command Prompt settings REG ADD &quot;%HKEY%\Console&quot; /v QuickEdit /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\Software\Microsoft\Command Processor&quot; /v CompletionChar /t REG_DWORD /d 9 /f REG ADD &quot;%HKEY%\Software\Microsoft\Command Processor&quot; /v PathCompletionChar /t REG_DWORD /d 9 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows NT\CurrentVersion\Network\Persistent Connections&quot; /v SaveConnections /d &quot;no&quot; /t REG_SZ /f REM Language bar - only apply if using single regional settings REM REG ADD &quot;%HKEY%\Software\Microsoft\CTF\LangBar&quot; /v ShowStatus /t REG_DWORD /d 3 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\CTF\LangBar&quot; /v Label /t REG_DWORD /d 1 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\CTF\LangBar&quot; /v ExtraIconsOnMinimized /t REG_DWORD /d 0 /f REM Windows Explorer and Start Menu REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v SeparateProcess /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v ServerAdminUI /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v Start_AdminToolsRoot /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v Start_PowerButtonAction /t REG_DWORD /d 2 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v Start_ShowDownloads /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v Start_ShowMyGames /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v Start_ShowMyMusic /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v StartMenuAdminTools /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v StartMenuFavorites /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v TaskbarSizeMove /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\AutoComplete&quot; /v &quot;Append Completion&quot; /t REG_SZ /d YES /f REG ADD &quot;%HKEY%\AppEvents\Schemes\Apps\Explorer\Navigating\.Current&quot; /ve /t REG_EXPAND_SZ /d &quot;&quot; /f REM Set IE as default browser, prevent prompting user REG ADD &quot;%HKEY%\Software\Clients\StartmenuInternet&quot; /ve /d &quot;IEXPLORE.EXE&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.mht\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.MHT&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.html\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.HTM&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.htm\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.HTM&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.url\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.URL&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.mhtml\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.MHT&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.xht\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.XHT&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.svg\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.SVG&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.partial\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.PARTIAL&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.website\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.WEBSITE&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.xhtml\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.XHT&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\https\UserChoice&quot; /v Progid /d &quot;IE.HTTPS&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\ftp\UserChoice&quot; /v Progid /d &quot;IE.FTP&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\http\UserChoice&quot; /v Progid /d &quot;IE.HTTP&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\MIMEAssociations\message/rfc822\UserChoice&quot; /v Progid /d &quot;IE.message/rfc822&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\MIMEAssociations\text/html\UserChoice&quot; /v Progid /d &quot;IE.text/html&quot; /f REM Additional Internet Explorer options REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\TabbedBrowsing&quot; /v PopupsUseNewWindow /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\PhishingFilter&quot; /v Enabled /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\Main&quot; /v &quot;Enable AutoImageResize&quot; /t REG_SZ /d YES /f REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\PhishingFilter&quot; /v Enabled /t REG_DWORD /d 2 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\domain.local&quot; /v * /t REG_DWORD /d 1 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\New Windows\Allow&quot; /v *.domain.local /t REG_BINARY /d 0000 /f REM Windows Media Player REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Setup\UserOptions&quot; /v DesktopShortcut /d No /t REG_SZ /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Setup\UserOptions&quot; /v QuickLaunchShortcut /d 0 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Preferences&quot; /v AcceptedPrivacyStatement /d 1 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Preferences&quot; /v FirstRun /d 0 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Preferences&quot; /v DisableMRU /d 1 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Preferences&quot; /v AutoCopyCD /d 0 /t REG_DWORD /f REM Help and Support REG ADD &quot;%HKEY%\Software\Microsoft\Assistance\Client\1.0\Settings&quot; /v OnlineAssist /d 1 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\Assistance\Client\1.0\Settings&quot; /v IsConnected /d 1 /t REG_DWORD /f REM Remove localisation - Themes, Feeds, Favourites REG DELETE &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\RunOnce&quot; /v mctadmin /f REM Snipping Tool REG ADD &quot;%HKEY%\Software\Microsoft\Windows\TabletPC\Snipping Tool&quot; /v ShowCaptureStroke /d 0 /t REG_DWORD /f REM Unload the default profile hive REG UNLOAD %HKEY% REM Setup Taskbar unpin items on first login IF NOT EXIST &quot;%ProgramFiles%\Scripts&quot; MD &quot;%ProgramFiles%\Scripts&quot; COPY /Y ExecuteVerbAction.VBS &quot;%ProgramFiles%\Scripts\ExecuteVerbAction.VBS&quot; COPY /Y ShLib.exe &quot;%ProgramFiles%\Scripts\ShLib.exe&quot; MD &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup&quot; ECHO @ECHO OFF &gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO cscript.exe &quot;%ProgramFiles%\Scripts\ExecuteVerbAction.vbs&quot; &quot;%ProgramData%\Microsoft\Windows\Start Menu\Programs\Windows Media Player.lnk&quot; UnpinFromTaskbar &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\Scripts\shlib&quot; remove &quot;%%APPDATA%%\Microsoft\Windows\Libraries\Documents.library-ms&quot; %PUBLIC%\Documents &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\Scripts\shlib&quot; remove &quot;%%APPDATA%%\Microsoft\Windows\Libraries\Music.library-ms&quot; %PUBLIC%\Music &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\Scripts\shlib&quot; remove &quot;%%APPDATA%%\Microsoft\Windows\Libraries\Pictures.library-ms&quot; %PUBLIC%\Pictures &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\Scripts\shlib&quot; remove &quot;%%APPDATA%%\Microsoft\Windows\Libraries\Videos.library-ms&quot; %PUBLIC%\Videos &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO DEL /Q &quot;%%APPDATA%%\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; If you use this in a production environment, please test and confirm each setting to ensure you understand what the script will implement. Windows 8.1 Here’s a sample script that will modify the default profile on a Windows 8.1 PC (x86 and x64). At a high level, the script will perform the following steps: Load and modifies the registry of the default profile Import a pre-configured Start screen Copies ExecuteVerbAction.VBS and ShLib.exe to folder under %ProgramFiles% Creates a batch script that will run on first logon to edit the Libraries and pin/unpin shortcuts. Once the script runs for the user, it will delete itself @ECHO OFF REM Load the default profile hive SET HKEY=HKU\Default REG LOAD %HKEY% %SystemDrive%\Users\Default\NTUSER.DAT REM Sound and end-application REG ADD &quot;%HKEY%\Control Panel\Sound&quot; /v Beep /t REG_SZ /d NO /f REG ADD &quot;%HKEY%\Control Panel\Sound&quot; /v ExtendedSounds /t REG_SZ /d NO /f REG ADD &quot;%HKEY%\Control Panel\Desktop&quot; /v HungAppTimeout /t REG_SZ /d 5000 /f REG ADD &quot;%HKEY%\Control Panel\Desktop&quot; /v AutoEndTasks /t REG_SZ /d 1 /f REG ADD &quot;%HKEY%\Control Panel\Desktop&quot; /v WaitToKillAppTimeout /t REG_SZ /d 4000 /f REM Command Prompt settings REG ADD &quot;%HKEY%\Console&quot; /v QuickEdit /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows NT\CurrentVersion\Network\Persistent Connections&quot; /v SaveConnections /d &quot;no&quot; /t REG_SZ /f REM Language bar - only apply if using single regional settings REM REG ADD &quot;%HKEY%\Software\Microsoft\CTF\LangBar&quot; /v ShowStatus /t REG_DWORD /d 3 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\CTF\LangBar&quot; /v Label /t REG_DWORD /d 1 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\CTF\LangBar&quot; /v ExtraIconsOnMinimized /t REG_DWORD /d 0 /f REM Windows Explorer REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v SeparateProcess /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v TaskbarSizeMove /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\AutoComplete&quot; /v &quot;Append Completion&quot; /t REG_SZ /d YES /f REG ADD &quot;%HKEY%\AppEvents\Schemes\Apps\Explorer\Navigating\.Current&quot; /ve /t REG_EXPAND_SZ /d &quot;&quot; /f REM Windows 8 navigation settings REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\StartPage&quot; /v OpenAtLogon /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\StartPage&quot; /v DesktopFirst /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\StartPage&quot; /v MakeAllAppsDefault /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\StartPage&quot; /v MonitorOverride /t REG_DWORD /d 0 /f REM Set IE as default browser, prevent prompting user REM REG ADD &quot;%HKEY%\Software\Clients\StartmenuInternet&quot; /ve /d &quot;IEXPLORE.EXE&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.mht\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.MHT&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.html\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.HTM&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.htm\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.HTM&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.url\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.URL&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.mhtml\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.MHT&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.xht\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.XHT&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.svg\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.SVG&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.partial\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.PARTIAL&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.website\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.WEBSITE&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.xhtml\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.XHT&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\https\UserChoice&quot; /v Progid /d &quot;IE.HTTPS&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\ftp\UserChoice&quot; /v Progid /d &quot;IE.FTP&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\http\UserChoice&quot; /v Progid /d &quot;IE.HTTP&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\MIMEAssociations\message\rfc822\UserChoice&quot; /v Progid /d &quot;IE.message/rfc822&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\MIMEAssociations\text\html\UserChoice&quot; /v Progid /d &quot;IE.text/html&quot; /f REM Additional Internet Explorer options REM REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\TabbedBrowsing&quot; /v PopupsUseNewWindow /t REG_DWORD /d 0 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\PhishingFilter&quot; /v Enabled /t REG_DWORD /d 1 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\Main&quot; /v &quot;Enable AutoImageResize&quot; /t REG_SZ /d YES /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\PhishingFilter&quot; /v Enabled /t REG_DWORD /d 2 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\domain.local&quot; /v * /t REG_DWORD /d 1 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\New Windows\Allow&quot; /v *.domain.local /t REG_BINARY /d 0000 /f REM Windows Media Player REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Setup\UserOptions&quot; /v DesktopShortcut /d No /t REG_SZ /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Setup\UserOptions&quot; /v QuickLaunchShortcut /d 0 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Preferences&quot; /v AcceptedPrivacyStatement /d 1 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Preferences&quot; /v FirstRun /d 0 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Preferences&quot; /v DisableMRU /d 1 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Preferences&quot; /v AutoCopyCD /d 0 /t REG_DWORD /f REM Unload the default profile hive REG UNLOAD %HKEY% REM Configure the default Start Screen IF NOT EXIST %SystemDrive%\Users\Default\AppData\Local\Microsoft\Windows MD %SystemDrive%\Users\Default\AppData\Local\Microsoft\Windows POWERSHELL -NonInteractive -Command Import-StartLayout -LayoutPath .\CustomStartScreenLayout.bin -MountPath %SystemDrive%\ REM Setup Taskbar unpin items on first login IF NOT EXIST &quot;%ProgramFiles%\Scripts&quot; MD &quot;%ProgramFiles%\Scripts&quot; COPY /Y ExecuteVerbAction.VBS &quot;%ProgramFiles%\Scripts\ExecuteVerbAction.VBS&quot; COPY /Y ShLib.exe &quot;%ProgramFiles%\Scripts\ShLib.exe&quot; MD &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup&quot; ECHO @ECHO OFF &gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; REM ECHO cscript.exe &quot;%ProgramFiles%\Scripts\ExecuteVerbAction.vbs&quot; &quot;%ProgramData%\Microsoft\Windows\Start Menu\Programs\Windows Media Player.lnk&quot; UnpinFromTaskbar &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\Scripts\shlib&quot; remove &quot;%%APPDATA%%\Microsoft\Windows\Libraries\Documents.library-ms&quot; %PUBLIC%\Documents &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\Scripts\shlib&quot; remove &quot;%%APPDATA%%\Microsoft\Windows\Libraries\Music.library-ms&quot; %PUBLIC%\Music &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\Scripts\shlib&quot; remove &quot;%%APPDATA%%\Microsoft\Windows\Libraries\Pictures.library-ms&quot; %PUBLIC%\Pictures &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\Scripts\shlib&quot; remove &quot;%%APPDATA%%\Microsoft\Windows\Libraries\Videos.library-ms&quot; %PUBLIC%\Videos &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO DEL /Q &quot;%%APPDATA%%\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; If you use this in a production environment, please test and confirm each setting to ensure you understand what the script will implement. Summing Up There are numerous ways to edit the default profile, some more complicated and involved than others. It’s my view that the best way to modify the default profile is targeting the required settings, which does mean more work. However, this approach results in a better understanding of the user environment and with any luck a better user experience. Each new major release of Windows results in less modifications, so your job will be easier. There are a few scripts and tools you’ll need to have in place and I’m confident the approach outlined here will result in happy users (or at least users who aren’t complaining). In the next article on the same subject, I’ll cover customising the default profile for Remote Desktop Services Session Hosts." />
<meta property="og:description" content="Multiple Methods The Deployment Guys have a great article from 2009 that I recommend reading for a overview of customisation methods: Configuring Default User Settings – Full Update for Windows 7 and Windows Server 2008 R2. This article is still applicable today and the process hasn’t changed that much between Windows versions. Here are most of the ways that you could edit the default user profile: Copy a configured profile over the default profile - this is the most common way of changing the default user experience but this approach is unsupported by Microsoft and therefore I recommend against using it. Using Sysprep and the CopyProfile value - this approach requires creating a reference image and using Sysprep to generalise the image. Many enterprise desktop deployments will use reference images so this isn’t too hard; however Microsoft has not documented every setting that is copied to the default user profile, so it’s a bit of pot luck. Place a default profile in NETLOGON - a default profile copied to the NETLOGON share of a domain controller (and replicated) will be copied down to the local machine at first logon. The downside of this approach is that there can be only one default profile and it will be copied to all machines, regardless as to whether the profile should apply to that machine or not. Commands or scripts run from the RunOnce Registry key to edit the user profile. Logon scripts to edit the user profile. Group Policy Preferences - GPP has become more prevalent in the past few years, so should now be available across the board. Editing the default profile directly, typically during an automated deployment, but you could run the same script on any existing PC. So there are multiple methods (of driving yourself to madness), I’d recommend experimenting with each approach and you’ll most likely implement a combination of approaches to best suit your environment. Group Policy As A Last Resort Group Policy is great, until it isn’t. Group Policy is pervasive and every Windows admin is familiar with it, but there a two things to consider when using it to manage the default user experience: Group Policy is is a policy - that is, if you’re using policies to manage default user settings, the user cannot then change to their own preference. Group Policy Preferences must be processed to determine whether they have been applied. Whilst GPPs can implement a preference rather than a policy, Windows must determine whether the preference has been applied by reading a flag. Whilst checking those flags isn’t a big problem, implementing GPPs should be considered in the context of whatever else is running at logon, how many preferences are implemented plus what happens to the environment over time (how many additional policies, applications, scripts etc. will be added to the environment over the life of that desktop). I have seen many organisations over-relying on Group Policy and missing the most important component user environment management - change control and ownership. Group Policy becomes a black hole, complete with settings that no one can remember why they were implemented and settings that are no longer relevant. Group Policy Preferences are great for replacing logon scripts, but use Group Policy and GPP sparingly so as not to adversely affect the user experience. A Better Way - Edit the Default Profile Directly My preferred method for modifying the default user experience is to edit the default user profile directly using a script that is run during Windows deployment. This type of script can also be run on existing machines or used in combination with CopyProfile. A benefit of this approach is that you can modify the default profile with or without a reference image. Editing the Default Profile To edit the default profile, we’ll use the command line tool REG to mount and make changes to the default user registry hive. Additionally we can make folder and file changes to the default profile and a couple of other command line tools to perform tasks such as pin and unpin shortcuts or change the Windows 7 Libraries. As far as this article is concerned, the default profile is in its default location, usually C:\Users\Default. In a script, you could refer to this location as %SystemDrive%\Users\Default. Finding Settings To find the profile locations to modify there’s a couple of methods that I rely on: Google (or your favourite search engine) Process Monitor and Process Explorer In most cases, someone (or even Microsoft) will have documented a registry value or profile location that is used to store a setting. More obscure or new settings will require detecting the location with Process Monitor. For example, to determine where a setting is stored in the Registry, create a filter in Process Monitor using the process name or process ID, additionally filtering on the operation such as RegSetValue, as shown below: A trace with Process Monitor when making a preference change should result in something like this: Regshot is also useful for comparing a before and after change to the profile for determining registry value locations. Additionally Process Explorer can be useful for tracking down a process that might be responsible for writing a setting by viewing the command line used to launch the process. Finding settings can sometimes be a time consuming process, but once found and documented, you’ve got a detailed understanding of the default profile. Editing the Registry To make direct registry edits to the default user profile, the REG command line utility is used to load the default profile registry hive, change a registry value and then unload the hive, saving it back to the default profile. The following lines show a rough example of how this is done: REG LOAD HKU\DefaultUser %SystemDrive%\Users\Default\NTUSER.DAT REG ADD HKU\DefaultUser\Software\KeyName /v ValueName /d Data /t REG_SZ /f REG UNLOAD HKU\DefaultUser Note that this will need to be run with administrative privileges and in an elevated context, so that you have write access to the default profile. Pinning and Unpinning Shortcuts A common requirement is to modify the the pinned shortcuts on the Taskbar or Start menu. This can be automated using a script, which needs to run a first logon (either as the user, or in the profile copied over the default profile via Sysprep/CopyProfile). Unfortunately I can’t find the original source for this script; however it works quite well and allows you to pin shortcuts to and unpin shortcuts from the Taskbar and Start menu via a command line. The script is available here: [download id=&#8221;62&#8243; format=&#8221;1&#8243;] Note that Windows 8 and above, do not expose a programatic method to pin and unpin shortcuts to the Start screen. If you’re looking to customise the Start screen, refer to this existing article: http://stealthpuppy.com/customizing-the-windows-8-1-start-screen-dont-follow-microsofts-guidance/. Modifying the Windows Libraries By default, the Libraries introduced in Windows 7, include the public folder locations. Removing these or adding locations requires editing the Libraries; however they’re stored in XML files and are created at first logon. To modify the libraries, you can use a command line tool ShLib.exe. Like pinning and unpinning shortcuts, this tool also needs to be run at first logon (and won’t work via CopyProfile). This article, Administratively Create and Modify Windows 7 Libraries, covers the use of ShLib.exe quite well. Implementing a Script to Modify the Default Profile Once you’ve created your script to make changes to the default registry, modify the default profile folder locations, pin and unpin shortcuts and make changes to the Libraries, you’ll need to implement the changes on the target PCs via script. Using an automation solution such as the Microsoft Deployment Toolkit (or an ESD like System Center Configuration Manager) the script can be run during a deployment task sequence. In the case of MDT, the script will be run after Windows unattended setup has completed in the local Administrator context. This way the script will have full elevation and write access to the default profile. An ESD solution will typically run the script via the local SYSTEM account. If you need to make changes to existing PCs, you’ll need a method to do so, such as an advertisement in Configuration Manager. If you take this approach, you can combine a script that makes direct changes to the default profile with the CopyProfile approach. That allows you to modify the profile for deployments from an unmodified OS as well as a custom image, keeping consistency across deployment types. Example Scripts Included here, along with some notation, are some example scripts for modifying the Windows 7 and Windows 8.1 default profiles. These example scripts include creation of a script at runtime that will run during first logon of any new profile. This is implemented as a batch file to keep things as simple as possible. Users will see a Command Prompt window as the script runs (but only once). The command lines includes in the script could be implemented with a UEM solution such as AppSense Environment Manager or even Group Policy to improve the user experience. Windows 7 Here’s a sample script that will modify the default profile on a Windows 7 PC (x86 and x64). At a high level, the script will perform the following steps: Load and modifies the registry of the default profile Copies ExecuteVerbAction.VBS and ShLib.exe to folder under %ProgramFiles% Creates a batch script that will run on first logon to edit the Libraries and pin/unpin shortcuts. Once the script runs for the user, it will delete itself. @ECHO OFF REM Load the default profile hive SET HKEY=HKU\Default REG LOAD %HKEY% %SystemDrive%\Users\Default\NTUSER.DAT REM Sound and end-application REG ADD &quot;%HKEY%\Control Panel\Sound&quot; /v Beep /t REG_SZ /d NO /f REG ADD &quot;%HKEY%\Control Panel\Sound&quot; /v ExtendedSounds /t REG_SZ /d NO /f REG ADD &quot;%HKEY%\Control Panel\Desktop&quot; /v HungAppTimeout /t REG_SZ /d 5000 /f REG ADD &quot;%HKEY%\Control Panel\Desktop&quot; /v AutoEndTasks /t REG_SZ /d 1 /f REG ADD &quot;%HKEY%\Control Panel\Desktop&quot; /v WaitToKillAppTimeout /t REG_SZ /d 4000 /f REM Command Prompt settings REG ADD &quot;%HKEY%\Console&quot; /v QuickEdit /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\Software\Microsoft\Command Processor&quot; /v CompletionChar /t REG_DWORD /d 9 /f REG ADD &quot;%HKEY%\Software\Microsoft\Command Processor&quot; /v PathCompletionChar /t REG_DWORD /d 9 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows NT\CurrentVersion\Network\Persistent Connections&quot; /v SaveConnections /d &quot;no&quot; /t REG_SZ /f REM Language bar - only apply if using single regional settings REM REG ADD &quot;%HKEY%\Software\Microsoft\CTF\LangBar&quot; /v ShowStatus /t REG_DWORD /d 3 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\CTF\LangBar&quot; /v Label /t REG_DWORD /d 1 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\CTF\LangBar&quot; /v ExtraIconsOnMinimized /t REG_DWORD /d 0 /f REM Windows Explorer and Start Menu REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v SeparateProcess /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v ServerAdminUI /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v Start_AdminToolsRoot /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v Start_PowerButtonAction /t REG_DWORD /d 2 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v Start_ShowDownloads /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v Start_ShowMyGames /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v Start_ShowMyMusic /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v StartMenuAdminTools /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v StartMenuFavorites /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v TaskbarSizeMove /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\AutoComplete&quot; /v &quot;Append Completion&quot; /t REG_SZ /d YES /f REG ADD &quot;%HKEY%\AppEvents\Schemes\Apps\Explorer\Navigating\.Current&quot; /ve /t REG_EXPAND_SZ /d &quot;&quot; /f REM Set IE as default browser, prevent prompting user REG ADD &quot;%HKEY%\Software\Clients\StartmenuInternet&quot; /ve /d &quot;IEXPLORE.EXE&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.mht\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.MHT&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.html\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.HTM&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.htm\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.HTM&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.url\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.URL&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.mhtml\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.MHT&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.xht\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.XHT&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.svg\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.SVG&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.partial\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.PARTIAL&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.website\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.WEBSITE&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.xhtml\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.XHT&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\https\UserChoice&quot; /v Progid /d &quot;IE.HTTPS&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\ftp\UserChoice&quot; /v Progid /d &quot;IE.FTP&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\http\UserChoice&quot; /v Progid /d &quot;IE.HTTP&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\MIMEAssociations\message/rfc822\UserChoice&quot; /v Progid /d &quot;IE.message/rfc822&quot; /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\MIMEAssociations\text/html\UserChoice&quot; /v Progid /d &quot;IE.text/html&quot; /f REM Additional Internet Explorer options REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\TabbedBrowsing&quot; /v PopupsUseNewWindow /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\PhishingFilter&quot; /v Enabled /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\Main&quot; /v &quot;Enable AutoImageResize&quot; /t REG_SZ /d YES /f REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\PhishingFilter&quot; /v Enabled /t REG_DWORD /d 2 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\domain.local&quot; /v * /t REG_DWORD /d 1 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\New Windows\Allow&quot; /v *.domain.local /t REG_BINARY /d 0000 /f REM Windows Media Player REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Setup\UserOptions&quot; /v DesktopShortcut /d No /t REG_SZ /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Setup\UserOptions&quot; /v QuickLaunchShortcut /d 0 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Preferences&quot; /v AcceptedPrivacyStatement /d 1 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Preferences&quot; /v FirstRun /d 0 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Preferences&quot; /v DisableMRU /d 1 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Preferences&quot; /v AutoCopyCD /d 0 /t REG_DWORD /f REM Help and Support REG ADD &quot;%HKEY%\Software\Microsoft\Assistance\Client\1.0\Settings&quot; /v OnlineAssist /d 1 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\Assistance\Client\1.0\Settings&quot; /v IsConnected /d 1 /t REG_DWORD /f REM Remove localisation - Themes, Feeds, Favourites REG DELETE &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\RunOnce&quot; /v mctadmin /f REM Snipping Tool REG ADD &quot;%HKEY%\Software\Microsoft\Windows\TabletPC\Snipping Tool&quot; /v ShowCaptureStroke /d 0 /t REG_DWORD /f REM Unload the default profile hive REG UNLOAD %HKEY% REM Setup Taskbar unpin items on first login IF NOT EXIST &quot;%ProgramFiles%\Scripts&quot; MD &quot;%ProgramFiles%\Scripts&quot; COPY /Y ExecuteVerbAction.VBS &quot;%ProgramFiles%\Scripts\ExecuteVerbAction.VBS&quot; COPY /Y ShLib.exe &quot;%ProgramFiles%\Scripts\ShLib.exe&quot; MD &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup&quot; ECHO @ECHO OFF &gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO cscript.exe &quot;%ProgramFiles%\Scripts\ExecuteVerbAction.vbs&quot; &quot;%ProgramData%\Microsoft\Windows\Start Menu\Programs\Windows Media Player.lnk&quot; UnpinFromTaskbar &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\Scripts\shlib&quot; remove &quot;%%APPDATA%%\Microsoft\Windows\Libraries\Documents.library-ms&quot; %PUBLIC%\Documents &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\Scripts\shlib&quot; remove &quot;%%APPDATA%%\Microsoft\Windows\Libraries\Music.library-ms&quot; %PUBLIC%\Music &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\Scripts\shlib&quot; remove &quot;%%APPDATA%%\Microsoft\Windows\Libraries\Pictures.library-ms&quot; %PUBLIC%\Pictures &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\Scripts\shlib&quot; remove &quot;%%APPDATA%%\Microsoft\Windows\Libraries\Videos.library-ms&quot; %PUBLIC%\Videos &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO DEL /Q &quot;%%APPDATA%%\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; If you use this in a production environment, please test and confirm each setting to ensure you understand what the script will implement. Windows 8.1 Here’s a sample script that will modify the default profile on a Windows 8.1 PC (x86 and x64). At a high level, the script will perform the following steps: Load and modifies the registry of the default profile Import a pre-configured Start screen Copies ExecuteVerbAction.VBS and ShLib.exe to folder under %ProgramFiles% Creates a batch script that will run on first logon to edit the Libraries and pin/unpin shortcuts. Once the script runs for the user, it will delete itself @ECHO OFF REM Load the default profile hive SET HKEY=HKU\Default REG LOAD %HKEY% %SystemDrive%\Users\Default\NTUSER.DAT REM Sound and end-application REG ADD &quot;%HKEY%\Control Panel\Sound&quot; /v Beep /t REG_SZ /d NO /f REG ADD &quot;%HKEY%\Control Panel\Sound&quot; /v ExtendedSounds /t REG_SZ /d NO /f REG ADD &quot;%HKEY%\Control Panel\Desktop&quot; /v HungAppTimeout /t REG_SZ /d 5000 /f REG ADD &quot;%HKEY%\Control Panel\Desktop&quot; /v AutoEndTasks /t REG_SZ /d 1 /f REG ADD &quot;%HKEY%\Control Panel\Desktop&quot; /v WaitToKillAppTimeout /t REG_SZ /d 4000 /f REM Command Prompt settings REG ADD &quot;%HKEY%\Console&quot; /v QuickEdit /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows NT\CurrentVersion\Network\Persistent Connections&quot; /v SaveConnections /d &quot;no&quot; /t REG_SZ /f REM Language bar - only apply if using single regional settings REM REG ADD &quot;%HKEY%\Software\Microsoft\CTF\LangBar&quot; /v ShowStatus /t REG_DWORD /d 3 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\CTF\LangBar&quot; /v Label /t REG_DWORD /d 1 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\CTF\LangBar&quot; /v ExtraIconsOnMinimized /t REG_DWORD /d 0 /f REM Windows Explorer REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v SeparateProcess /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot; /v TaskbarSizeMove /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\AutoComplete&quot; /v &quot;Append Completion&quot; /t REG_SZ /d YES /f REG ADD &quot;%HKEY%\AppEvents\Schemes\Apps\Explorer\Navigating\.Current&quot; /ve /t REG_EXPAND_SZ /d &quot;&quot; /f REM Windows 8 navigation settings REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\StartPage&quot; /v OpenAtLogon /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\StartPage&quot; /v DesktopFirst /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\StartPage&quot; /v MakeAllAppsDefault /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\StartPage&quot; /v MonitorOverride /t REG_DWORD /d 0 /f REM Set IE as default browser, prevent prompting user REM REG ADD &quot;%HKEY%\Software\Clients\StartmenuInternet&quot; /ve /d &quot;IEXPLORE.EXE&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.mht\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.MHT&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.html\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.HTM&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.htm\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.HTM&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.url\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.URL&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.mhtml\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.MHT&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.xht\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.XHT&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.svg\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.SVG&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.partial\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.PARTIAL&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.website\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.WEBSITE&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.xhtml\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.XHT&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\https\UserChoice&quot; /v Progid /d &quot;IE.HTTPS&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\ftp\UserChoice&quot; /v Progid /d &quot;IE.FTP&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\http\UserChoice&quot; /v Progid /d &quot;IE.HTTP&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\MIMEAssociations\message\rfc822\UserChoice&quot; /v Progid /d &quot;IE.message/rfc822&quot; /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\Shell\Associations\MIMEAssociations\text\html\UserChoice&quot; /v Progid /d &quot;IE.text/html&quot; /f REM Additional Internet Explorer options REM REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\TabbedBrowsing&quot; /v PopupsUseNewWindow /t REG_DWORD /d 0 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\PhishingFilter&quot; /v Enabled /t REG_DWORD /d 1 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\Main&quot; /v &quot;Enable AutoImageResize&quot; /t REG_SZ /d YES /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\PhishingFilter&quot; /v Enabled /t REG_DWORD /d 2 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\domain.local&quot; /v * /t REG_DWORD /d 1 /f REM REG ADD &quot;%HKEY%\Software\Microsoft\Internet Explorer\New Windows\Allow&quot; /v *.domain.local /t REG_BINARY /d 0000 /f REM Windows Media Player REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Setup\UserOptions&quot; /v DesktopShortcut /d No /t REG_SZ /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Setup\UserOptions&quot; /v QuickLaunchShortcut /d 0 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Preferences&quot; /v AcceptedPrivacyStatement /d 1 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Preferences&quot; /v FirstRun /d 0 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Preferences&quot; /v DisableMRU /d 1 /t REG_DWORD /f REG ADD &quot;%HKEY%\Software\Microsoft\MediaPlayer\Preferences&quot; /v AutoCopyCD /d 0 /t REG_DWORD /f REM Unload the default profile hive REG UNLOAD %HKEY% REM Configure the default Start Screen IF NOT EXIST %SystemDrive%\Users\Default\AppData\Local\Microsoft\Windows MD %SystemDrive%\Users\Default\AppData\Local\Microsoft\Windows POWERSHELL -NonInteractive -Command Import-StartLayout -LayoutPath .\CustomStartScreenLayout.bin -MountPath %SystemDrive%\ REM Setup Taskbar unpin items on first login IF NOT EXIST &quot;%ProgramFiles%\Scripts&quot; MD &quot;%ProgramFiles%\Scripts&quot; COPY /Y ExecuteVerbAction.VBS &quot;%ProgramFiles%\Scripts\ExecuteVerbAction.VBS&quot; COPY /Y ShLib.exe &quot;%ProgramFiles%\Scripts\ShLib.exe&quot; MD &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup&quot; ECHO @ECHO OFF &gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; REM ECHO cscript.exe &quot;%ProgramFiles%\Scripts\ExecuteVerbAction.vbs&quot; &quot;%ProgramData%\Microsoft\Windows\Start Menu\Programs\Windows Media Player.lnk&quot; UnpinFromTaskbar &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\Scripts\shlib&quot; remove &quot;%%APPDATA%%\Microsoft\Windows\Libraries\Documents.library-ms&quot; %PUBLIC%\Documents &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\Scripts\shlib&quot; remove &quot;%%APPDATA%%\Microsoft\Windows\Libraries\Music.library-ms&quot; %PUBLIC%\Music &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\Scripts\shlib&quot; remove &quot;%%APPDATA%%\Microsoft\Windows\Libraries\Pictures.library-ms&quot; %PUBLIC%\Pictures &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\Scripts\shlib&quot; remove &quot;%%APPDATA%%\Microsoft\Windows\Libraries\Videos.library-ms&quot; %PUBLIC%\Videos &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; ECHO DEL /Q &quot;%%APPDATA%%\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; &gt;&gt; &quot;%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd&quot; If you use this in a production environment, please test and confirm each setting to ensure you understand what the script will implement. Summing Up There are numerous ways to edit the default profile, some more complicated and involved than others. It’s my view that the best way to modify the default profile is targeting the required settings, which does mean more work. However, this approach results in a better understanding of the user environment and with any luck a better user experience. Each new major release of Windows results in less modifications, so your job will be easier. There are a few scripts and tools you’ll need to have in place and I’m confident the approach outlined here will result in happy users (or at least users who aren’t complaining). In the next article on the same subject, I’ll cover customising the default profile for Remote Desktop Services Session Hosts." />
<link rel="canonical" href="/customize-the-windows-default-profile/" />
<meta property="og:url" content="/customize-the-windows-default-profile/" />
<meta property="og:site_name" content="aaron parker" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2013-12-28T10:00:30+11:00" />
<script type="application/ld+json">
{"description":"Multiple Methods The Deployment Guys have a great article from 2009 that I recommend reading for a overview of customisation methods: Configuring Default User Settings – Full Update for Windows 7 and Windows Server 2008 R2. This article is still applicable today and the process hasn’t changed that much between Windows versions. Here are most of the ways that you could edit the default user profile: Copy a configured profile over the default profile - this is the most common way of changing the default user experience but this approach is unsupported by Microsoft and therefore I recommend against using it. Using Sysprep and the CopyProfile value - this approach requires creating a reference image and using Sysprep to generalise the image. Many enterprise desktop deployments will use reference images so this isn’t too hard; however Microsoft has not documented every setting that is copied to the default user profile, so it’s a bit of pot luck. Place a default profile in NETLOGON - a default profile copied to the NETLOGON share of a domain controller (and replicated) will be copied down to the local machine at first logon. The downside of this approach is that there can be only one default profile and it will be copied to all machines, regardless as to whether the profile should apply to that machine or not. Commands or scripts run from the RunOnce Registry key to edit the user profile. Logon scripts to edit the user profile. Group Policy Preferences - GPP has become more prevalent in the past few years, so should now be available across the board. Editing the default profile directly, typically during an automated deployment, but you could run the same script on any existing PC. So there are multiple methods (of driving yourself to madness), I’d recommend experimenting with each approach and you’ll most likely implement a combination of approaches to best suit your environment. Group Policy As A Last Resort Group Policy is great, until it isn’t. Group Policy is pervasive and every Windows admin is familiar with it, but there a two things to consider when using it to manage the default user experience: Group Policy is is a policy - that is, if you’re using policies to manage default user settings, the user cannot then change to their own preference. Group Policy Preferences must be processed to determine whether they have been applied. Whilst GPPs can implement a preference rather than a policy, Windows must determine whether the preference has been applied by reading a flag. Whilst checking those flags isn’t a big problem, implementing GPPs should be considered in the context of whatever else is running at logon, how many preferences are implemented plus what happens to the environment over time (how many additional policies, applications, scripts etc. will be added to the environment over the life of that desktop). I have seen many organisations over-relying on Group Policy and missing the most important component user environment management - change control and ownership. Group Policy becomes a black hole, complete with settings that no one can remember why they were implemented and settings that are no longer relevant. Group Policy Preferences are great for replacing logon scripts, but use Group Policy and GPP sparingly so as not to adversely affect the user experience. A Better Way - Edit the Default Profile Directly My preferred method for modifying the default user experience is to edit the default user profile directly using a script that is run during Windows deployment. This type of script can also be run on existing machines or used in combination with CopyProfile. A benefit of this approach is that you can modify the default profile with or without a reference image. Editing the Default Profile To edit the default profile, we’ll use the command line tool REG to mount and make changes to the default user registry hive. Additionally we can make folder and file changes to the default profile and a couple of other command line tools to perform tasks such as pin and unpin shortcuts or change the Windows 7 Libraries. As far as this article is concerned, the default profile is in its default location, usually C:\\Users\\Default. In a script, you could refer to this location as %SystemDrive%\\Users\\Default. Finding Settings To find the profile locations to modify there’s a couple of methods that I rely on: Google (or your favourite search engine) Process Monitor and Process Explorer In most cases, someone (or even Microsoft) will have documented a registry value or profile location that is used to store a setting. More obscure or new settings will require detecting the location with Process Monitor. For example, to determine where a setting is stored in the Registry, create a filter in Process Monitor using the process name or process ID, additionally filtering on the operation such as RegSetValue, as shown below: A trace with Process Monitor when making a preference change should result in something like this: Regshot is also useful for comparing a before and after change to the profile for determining registry value locations. Additionally Process Explorer can be useful for tracking down a process that might be responsible for writing a setting by viewing the command line used to launch the process. Finding settings can sometimes be a time consuming process, but once found and documented, you’ve got a detailed understanding of the default profile. Editing the Registry To make direct registry edits to the default user profile, the REG command line utility is used to load the default profile registry hive, change a registry value and then unload the hive, saving it back to the default profile. The following lines show a rough example of how this is done: REG LOAD HKU\\DefaultUser %SystemDrive%\\Users\\Default\\NTUSER.DAT REG ADD HKU\\DefaultUser\\Software\\KeyName /v ValueName /d Data /t REG_SZ /f REG UNLOAD HKU\\DefaultUser Note that this will need to be run with administrative privileges and in an elevated context, so that you have write access to the default profile. Pinning and Unpinning Shortcuts A common requirement is to modify the the pinned shortcuts on the Taskbar or Start menu. This can be automated using a script, which needs to run a first logon (either as the user, or in the profile copied over the default profile via Sysprep/CopyProfile). Unfortunately I can’t find the original source for this script; however it works quite well and allows you to pin shortcuts to and unpin shortcuts from the Taskbar and Start menu via a command line. The script is available here: [download id=&#8221;62&#8243; format=&#8221;1&#8243;] Note that Windows 8 and above, do not expose a programatic method to pin and unpin shortcuts to the Start screen. If you’re looking to customise the Start screen, refer to this existing article: http://stealthpuppy.com/customizing-the-windows-8-1-start-screen-dont-follow-microsofts-guidance/. Modifying the Windows Libraries By default, the Libraries introduced in Windows 7, include the public folder locations. Removing these or adding locations requires editing the Libraries; however they’re stored in XML files and are created at first logon. To modify the libraries, you can use a command line tool ShLib.exe. Like pinning and unpinning shortcuts, this tool also needs to be run at first logon (and won’t work via CopyProfile). This article, Administratively Create and Modify Windows 7 Libraries, covers the use of ShLib.exe quite well. Implementing a Script to Modify the Default Profile Once you’ve created your script to make changes to the default registry, modify the default profile folder locations, pin and unpin shortcuts and make changes to the Libraries, you’ll need to implement the changes on the target PCs via script. Using an automation solution such as the Microsoft Deployment Toolkit (or an ESD like System Center Configuration Manager) the script can be run during a deployment task sequence. In the case of MDT, the script will be run after Windows unattended setup has completed in the local Administrator context. This way the script will have full elevation and write access to the default profile. An ESD solution will typically run the script via the local SYSTEM account. If you need to make changes to existing PCs, you’ll need a method to do so, such as an advertisement in Configuration Manager. If you take this approach, you can combine a script that makes direct changes to the default profile with the CopyProfile approach. That allows you to modify the profile for deployments from an unmodified OS as well as a custom image, keeping consistency across deployment types. Example Scripts Included here, along with some notation, are some example scripts for modifying the Windows 7 and Windows 8.1 default profiles. These example scripts include creation of a script at runtime that will run during first logon of any new profile. This is implemented as a batch file to keep things as simple as possible. Users will see a Command Prompt window as the script runs (but only once). The command lines includes in the script could be implemented with a UEM solution such as AppSense Environment Manager or even Group Policy to improve the user experience. Windows 7 Here’s a sample script that will modify the default profile on a Windows 7 PC (x86 and x64). At a high level, the script will perform the following steps: Load and modifies the registry of the default profile Copies ExecuteVerbAction.VBS and ShLib.exe to folder under %ProgramFiles% Creates a batch script that will run on first logon to edit the Libraries and pin/unpin shortcuts. Once the script runs for the user, it will delete itself. @ECHO OFF REM Load the default profile hive SET HKEY=HKU\\Default REG LOAD %HKEY% %SystemDrive%\\Users\\Default\\NTUSER.DAT REM Sound and end-application REG ADD &quot;%HKEY%\\Control Panel\\Sound&quot; /v Beep /t REG_SZ /d NO /f REG ADD &quot;%HKEY%\\Control Panel\\Sound&quot; /v ExtendedSounds /t REG_SZ /d NO /f REG ADD &quot;%HKEY%\\Control Panel\\Desktop&quot; /v HungAppTimeout /t REG_SZ /d 5000 /f REG ADD &quot;%HKEY%\\Control Panel\\Desktop&quot; /v AutoEndTasks /t REG_SZ /d 1 /f REG ADD &quot;%HKEY%\\Control Panel\\Desktop&quot; /v WaitToKillAppTimeout /t REG_SZ /d 4000 /f REM Command Prompt settings REG ADD &quot;%HKEY%\\Console&quot; /v QuickEdit /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Command Processor&quot; /v CompletionChar /t REG_DWORD /d 9 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Command Processor&quot; /v PathCompletionChar /t REG_DWORD /d 9 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Network\\Persistent Connections&quot; /v SaveConnections /d &quot;no&quot; /t REG_SZ /f REM Language bar - only apply if using single regional settings REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\CTF\\LangBar&quot; /v ShowStatus /t REG_DWORD /d 3 /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\CTF\\LangBar&quot; /v Label /t REG_DWORD /d 1 /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\CTF\\LangBar&quot; /v ExtraIconsOnMinimized /t REG_DWORD /d 0 /f REM Windows Explorer and Start Menu REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced&quot; /v SeparateProcess /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced&quot; /v ServerAdminUI /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced&quot; /v Start_AdminToolsRoot /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced&quot; /v Start_PowerButtonAction /t REG_DWORD /d 2 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced&quot; /v Start_ShowDownloads /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced&quot; /v Start_ShowMyGames /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced&quot; /v Start_ShowMyMusic /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced&quot; /v StartMenuAdminTools /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced&quot; /v StartMenuFavorites /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced&quot; /v TaskbarSizeMove /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\AutoComplete&quot; /v &quot;Append Completion&quot; /t REG_SZ /d YES /f REG ADD &quot;%HKEY%\\AppEvents\\Schemes\\Apps\\Explorer\\Navigating\\.Current&quot; /ve /t REG_EXPAND_SZ /d &quot;&quot; /f REM Set IE as default browser, prevent prompting user REG ADD &quot;%HKEY%\\Software\\Clients\\StartmenuInternet&quot; /ve /d &quot;IEXPLORE.EXE&quot; /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.mht\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.MHT&quot; /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.html\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.HTM&quot; /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.htm\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.HTM&quot; /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.url\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.URL&quot; /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.mhtml\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.MHT&quot; /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.xht\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.XHT&quot; /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.svg\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.SVG&quot; /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.partial\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.PARTIAL&quot; /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.website\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.WEBSITE&quot; /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.xhtml\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.XHT&quot; /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\https\\UserChoice&quot; /v Progid /d &quot;IE.HTTPS&quot; /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\ftp\\UserChoice&quot; /v Progid /d &quot;IE.FTP&quot; /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice&quot; /v Progid /d &quot;IE.HTTP&quot; /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\Shell\\Associations\\MIMEAssociations\\message/rfc822\\UserChoice&quot; /v Progid /d &quot;IE.message/rfc822&quot; /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\Shell\\Associations\\MIMEAssociations\\text/html\\UserChoice&quot; /v Progid /d &quot;IE.text/html&quot; /f REM Additional Internet Explorer options REG ADD &quot;%HKEY%\\Software\\Microsoft\\Internet Explorer\\TabbedBrowsing&quot; /v PopupsUseNewWindow /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Internet Explorer\\PhishingFilter&quot; /v Enabled /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Internet Explorer\\Main&quot; /v &quot;Enable AutoImageResize&quot; /t REG_SZ /d YES /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Internet Explorer\\PhishingFilter&quot; /v Enabled /t REG_DWORD /d 2 /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\Domains\\domain.local&quot; /v * /t REG_DWORD /d 1 /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Internet Explorer\\New Windows\\Allow&quot; /v *.domain.local /t REG_BINARY /d 0000 /f REM Windows Media Player REG ADD &quot;%HKEY%\\Software\\Microsoft\\MediaPlayer\\Setup\\UserOptions&quot; /v DesktopShortcut /d No /t REG_SZ /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\MediaPlayer\\Setup\\UserOptions&quot; /v QuickLaunchShortcut /d 0 /t REG_DWORD /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\MediaPlayer\\Preferences&quot; /v AcceptedPrivacyStatement /d 1 /t REG_DWORD /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\MediaPlayer\\Preferences&quot; /v FirstRun /d 0 /t REG_DWORD /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\MediaPlayer\\Preferences&quot; /v DisableMRU /d 1 /t REG_DWORD /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\MediaPlayer\\Preferences&quot; /v AutoCopyCD /d 0 /t REG_DWORD /f REM Help and Support REG ADD &quot;%HKEY%\\Software\\Microsoft\\Assistance\\Client\\1.0\\Settings&quot; /v OnlineAssist /d 1 /t REG_DWORD /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Assistance\\Client\\1.0\\Settings&quot; /v IsConnected /d 1 /t REG_DWORD /f REM Remove localisation - Themes, Feeds, Favourites REG DELETE &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce&quot; /v mctadmin /f REM Snipping Tool REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\TabletPC\\Snipping Tool&quot; /v ShowCaptureStroke /d 0 /t REG_DWORD /f REM Unload the default profile hive REG UNLOAD %HKEY% REM Setup Taskbar unpin items on first login IF NOT EXIST &quot;%ProgramFiles%\\Scripts&quot; MD &quot;%ProgramFiles%\\Scripts&quot; COPY /Y ExecuteVerbAction.VBS &quot;%ProgramFiles%\\Scripts\\ExecuteVerbAction.VBS&quot; COPY /Y ShLib.exe &quot;%ProgramFiles%\\Scripts\\ShLib.exe&quot; MD &quot;%SystemDrive%\\Users\\Default\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup&quot; ECHO @ECHO OFF &gt; &quot;%SystemDrive%\\Users\\Default\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\PinnedItemsLibraries.cmd&quot; ECHO cscript.exe &quot;%ProgramFiles%\\Scripts\\ExecuteVerbAction.vbs&quot; &quot;%ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs\\Windows Media Player.lnk&quot; UnpinFromTaskbar &gt;&gt; &quot;%SystemDrive%\\Users\\Default\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\\Scripts\\shlib&quot; remove &quot;%%APPDATA%%\\Microsoft\\Windows\\Libraries\\Documents.library-ms&quot; %PUBLIC%\\Documents &gt;&gt; &quot;%SystemDrive%\\Users\\Default\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\\Scripts\\shlib&quot; remove &quot;%%APPDATA%%\\Microsoft\\Windows\\Libraries\\Music.library-ms&quot; %PUBLIC%\\Music &gt;&gt; &quot;%SystemDrive%\\Users\\Default\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\\Scripts\\shlib&quot; remove &quot;%%APPDATA%%\\Microsoft\\Windows\\Libraries\\Pictures.library-ms&quot; %PUBLIC%\\Pictures &gt;&gt; &quot;%SystemDrive%\\Users\\Default\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\\Scripts\\shlib&quot; remove &quot;%%APPDATA%%\\Microsoft\\Windows\\Libraries\\Videos.library-ms&quot; %PUBLIC%\\Videos &gt;&gt; &quot;%SystemDrive%\\Users\\Default\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\PinnedItemsLibraries.cmd&quot; ECHO DEL /Q &quot;%%APPDATA%%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\PinnedItemsLibraries.cmd&quot; &gt;&gt; &quot;%SystemDrive%\\Users\\Default\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\PinnedItemsLibraries.cmd&quot; If you use this in a production environment, please test and confirm each setting to ensure you understand what the script will implement. Windows 8.1 Here’s a sample script that will modify the default profile on a Windows 8.1 PC (x86 and x64). At a high level, the script will perform the following steps: Load and modifies the registry of the default profile Import a pre-configured Start screen Copies ExecuteVerbAction.VBS and ShLib.exe to folder under %ProgramFiles% Creates a batch script that will run on first logon to edit the Libraries and pin/unpin shortcuts. Once the script runs for the user, it will delete itself @ECHO OFF REM Load the default profile hive SET HKEY=HKU\\Default REG LOAD %HKEY% %SystemDrive%\\Users\\Default\\NTUSER.DAT REM Sound and end-application REG ADD &quot;%HKEY%\\Control Panel\\Sound&quot; /v Beep /t REG_SZ /d NO /f REG ADD &quot;%HKEY%\\Control Panel\\Sound&quot; /v ExtendedSounds /t REG_SZ /d NO /f REG ADD &quot;%HKEY%\\Control Panel\\Desktop&quot; /v HungAppTimeout /t REG_SZ /d 5000 /f REG ADD &quot;%HKEY%\\Control Panel\\Desktop&quot; /v AutoEndTasks /t REG_SZ /d 1 /f REG ADD &quot;%HKEY%\\Control Panel\\Desktop&quot; /v WaitToKillAppTimeout /t REG_SZ /d 4000 /f REM Command Prompt settings REG ADD &quot;%HKEY%\\Console&quot; /v QuickEdit /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Network\\Persistent Connections&quot; /v SaveConnections /d &quot;no&quot; /t REG_SZ /f REM Language bar - only apply if using single regional settings REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\CTF\\LangBar&quot; /v ShowStatus /t REG_DWORD /d 3 /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\CTF\\LangBar&quot; /v Label /t REG_DWORD /d 1 /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\CTF\\LangBar&quot; /v ExtraIconsOnMinimized /t REG_DWORD /d 0 /f REM Windows Explorer REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced&quot; /v SeparateProcess /t REG_DWORD /d 1 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced&quot; /v TaskbarSizeMove /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\AutoComplete&quot; /v &quot;Append Completion&quot; /t REG_SZ /d YES /f REG ADD &quot;%HKEY%\\AppEvents\\Schemes\\Apps\\Explorer\\Navigating\\.Current&quot; /ve /t REG_EXPAND_SZ /d &quot;&quot; /f REM Windows 8 navigation settings REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\StartPage&quot; /v OpenAtLogon /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\StartPage&quot; /v DesktopFirst /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\StartPage&quot; /v MakeAllAppsDefault /t REG_DWORD /d 0 /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\StartPage&quot; /v MonitorOverride /t REG_DWORD /d 0 /f REM Set IE as default browser, prevent prompting user REM REG ADD &quot;%HKEY%\\Software\\Clients\\StartmenuInternet&quot; /ve /d &quot;IEXPLORE.EXE&quot; /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.mht\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.MHT&quot; /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.html\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.HTM&quot; /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.htm\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.HTM&quot; /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.url\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.URL&quot; /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.mhtml\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.MHT&quot; /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.xht\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.XHT&quot; /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.svg\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.SVG&quot; /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.partial\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.PARTIAL&quot; /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.website\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.WEBSITE&quot; /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.xhtml\\UserChoice&quot; /v Progid /d &quot;IE.AssocFile.XHT&quot; /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\https\\UserChoice&quot; /v Progid /d &quot;IE.HTTPS&quot; /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\ftp\\UserChoice&quot; /v Progid /d &quot;IE.FTP&quot; /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice&quot; /v Progid /d &quot;IE.HTTP&quot; /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\Shell\\Associations\\MIMEAssociations\\message\\rfc822\\UserChoice&quot; /v Progid /d &quot;IE.message/rfc822&quot; /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\Shell\\Associations\\MIMEAssociations\\text\\html\\UserChoice&quot; /v Progid /d &quot;IE.text/html&quot; /f REM Additional Internet Explorer options REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Internet Explorer\\TabbedBrowsing&quot; /v PopupsUseNewWindow /t REG_DWORD /d 0 /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Internet Explorer\\PhishingFilter&quot; /v Enabled /t REG_DWORD /d 1 /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Internet Explorer\\Main&quot; /v &quot;Enable AutoImageResize&quot; /t REG_SZ /d YES /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Internet Explorer\\PhishingFilter&quot; /v Enabled /t REG_DWORD /d 2 /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\Domains\\domain.local&quot; /v * /t REG_DWORD /d 1 /f REM REG ADD &quot;%HKEY%\\Software\\Microsoft\\Internet Explorer\\New Windows\\Allow&quot; /v *.domain.local /t REG_BINARY /d 0000 /f REM Windows Media Player REG ADD &quot;%HKEY%\\Software\\Microsoft\\MediaPlayer\\Setup\\UserOptions&quot; /v DesktopShortcut /d No /t REG_SZ /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\MediaPlayer\\Setup\\UserOptions&quot; /v QuickLaunchShortcut /d 0 /t REG_DWORD /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\MediaPlayer\\Preferences&quot; /v AcceptedPrivacyStatement /d 1 /t REG_DWORD /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\MediaPlayer\\Preferences&quot; /v FirstRun /d 0 /t REG_DWORD /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\MediaPlayer\\Preferences&quot; /v DisableMRU /d 1 /t REG_DWORD /f REG ADD &quot;%HKEY%\\Software\\Microsoft\\MediaPlayer\\Preferences&quot; /v AutoCopyCD /d 0 /t REG_DWORD /f REM Unload the default profile hive REG UNLOAD %HKEY% REM Configure the default Start Screen IF NOT EXIST %SystemDrive%\\Users\\Default\\AppData\\Local\\Microsoft\\Windows MD %SystemDrive%\\Users\\Default\\AppData\\Local\\Microsoft\\Windows POWERSHELL -NonInteractive -Command Import-StartLayout -LayoutPath .\\CustomStartScreenLayout.bin -MountPath %SystemDrive%\\ REM Setup Taskbar unpin items on first login IF NOT EXIST &quot;%ProgramFiles%\\Scripts&quot; MD &quot;%ProgramFiles%\\Scripts&quot; COPY /Y ExecuteVerbAction.VBS &quot;%ProgramFiles%\\Scripts\\ExecuteVerbAction.VBS&quot; COPY /Y ShLib.exe &quot;%ProgramFiles%\\Scripts\\ShLib.exe&quot; MD &quot;%SystemDrive%\\Users\\Default\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup&quot; ECHO @ECHO OFF &gt; &quot;%SystemDrive%\\Users\\Default\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\PinnedItemsLibraries.cmd&quot; REM ECHO cscript.exe &quot;%ProgramFiles%\\Scripts\\ExecuteVerbAction.vbs&quot; &quot;%ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs\\Windows Media Player.lnk&quot; UnpinFromTaskbar &gt;&gt; &quot;%SystemDrive%\\Users\\Default\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\\Scripts\\shlib&quot; remove &quot;%%APPDATA%%\\Microsoft\\Windows\\Libraries\\Documents.library-ms&quot; %PUBLIC%\\Documents &gt;&gt; &quot;%SystemDrive%\\Users\\Default\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\\Scripts\\shlib&quot; remove &quot;%%APPDATA%%\\Microsoft\\Windows\\Libraries\\Music.library-ms&quot; %PUBLIC%\\Music &gt;&gt; &quot;%SystemDrive%\\Users\\Default\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\\Scripts\\shlib&quot; remove &quot;%%APPDATA%%\\Microsoft\\Windows\\Libraries\\Pictures.library-ms&quot; %PUBLIC%\\Pictures &gt;&gt; &quot;%SystemDrive%\\Users\\Default\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\PinnedItemsLibraries.cmd&quot; ECHO &quot;%ProgramFiles%\\Scripts\\shlib&quot; remove &quot;%%APPDATA%%\\Microsoft\\Windows\\Libraries\\Videos.library-ms&quot; %PUBLIC%\\Videos &gt;&gt; &quot;%SystemDrive%\\Users\\Default\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\PinnedItemsLibraries.cmd&quot; ECHO DEL /Q &quot;%%APPDATA%%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\PinnedItemsLibraries.cmd&quot; &gt;&gt; &quot;%SystemDrive%\\Users\\Default\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\PinnedItemsLibraries.cmd&quot; If you use this in a production environment, please test and confirm each setting to ensure you understand what the script will implement. Summing Up There are numerous ways to edit the default profile, some more complicated and involved than others. It’s my view that the best way to modify the default profile is targeting the required settings, which does mean more work. However, this approach results in a better understanding of the user environment and with any luck a better user experience. Each new major release of Windows results in less modifications, so your job will be easier. There are a few scripts and tools you’ll need to have in place and I’m confident the approach outlined here will result in happy users (or at least users who aren’t complaining). In the next article on the same subject, I’ll cover customising the default profile for Remote Desktop Services Session Hosts.","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/customize-the-windows-default-profile/","headline":"A Better Way to Customize the Windows Default Profile","dateModified":"2013-12-28T10:00:30+11:00","datePublished":"2013-12-28T10:00:30+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"/customize-the-windows-default-profile/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="aaron parker" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">aaron parker</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">ABOUT</a><a class="page-link" href="/smb-not-cifs.html">SMB not CIFS</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">A Better Way to Customize the Windows Default Profile</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2013-12-28T10:00:30+11:00" itemprop="datePublished">Dec 28, 2013
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="multiple-methods">Multiple Methods</h1>

<p>The Deployment Guys have a great article from 2009 that I recommend reading for a overview of customisation methods: <a href="http://blogs.technet.com/b/deploymentguys/archive/2009/10/29/configuring-default-user-settings-full-update-for-windows-7-and-windows-server-2008-r2.aspx">Configuring Default User Settings – Full Update for Windows 7 and Windows Server 2008 R2</a>. This article is still applicable today and the process hasn’t changed that much between Windows versions. Here are most of the ways that you could edit the default user profile:</p>

<ul>
  <li>Copy a configured profile over the default profile - this is the most common way of changing the default user experience but this approach is unsupported by Microsoft and therefore I recommend against using it.</li>
  <li>Using Sysprep and the CopyProfile value - this approach requires creating a reference image and using Sysprep to generalise the image. Many enterprise desktop deployments will use reference images so this isn’t too hard; however Microsoft has not documented every setting that is copied to the default user profile, so it’s a bit of pot luck.</li>
  <li>Place a default profile in NETLOGON - a default profile copied to the NETLOGON share of a domain controller (and replicated) will be copied down to the local machine at first logon. The downside of this approach is that there can be only one default profile and it will be copied to all machines, regardless as to whether the profile should apply to that machine or not.</li>
  <li>Commands or scripts run from the RunOnce Registry key to edit the user profile.</li>
  <li>Logon scripts to edit the user profile.</li>
  <li>Group Policy Preferences - GPP has become more prevalent in the past few years, so should now be available across the board.</li>
  <li>Editing the default profile directly, typically during an automated deployment, but you could run the same script on any existing PC.</li>
</ul>

<p>So there are multiple methods (of driving yourself to madness), I’d recommend experimenting with each approach and you’ll most likely implement a combination of approaches to best suit your environment.</p>

<h1 id="group-policy-as-a-last-resort">Group Policy As A Last Resort</h1>

<p>Group Policy is great, until it isn’t. Group Policy is pervasive and every Windows admin is familiar with it, but there a two things to consider when using it to manage the default user experience:</p>

<ol>
  <li>Group Policy is is a policy - that is, if you’re using policies to manage default user settings, the user cannot then change to their own preference.</li>
  <li>Group Policy Preferences must be processed to determine whether they have been applied. Whilst GPPs can implement a preference rather than a policy, Windows must determine whether the preference has been applied by reading a flag. Whilst checking those flags isn’t a big problem, implementing GPPs should be considered in the context of whatever else is running at logon, how many preferences are implemented plus what happens to the environment over time (how many additional policies, applications, scripts etc. will be added to the environment over the life of that desktop).</li>
</ol>

<p>I have seen many organisations over-relying on Group Policy and missing the most important component user environment management - change control and ownership. Group Policy becomes a black hole, complete with settings that no one can remember why they were implemented and settings that are no longer relevant. Group Policy Preferences are great for replacing logon scripts, but use Group Policy and GPP sparingly so as not to adversely affect the user experience.</p>

<h1 id="a-better-way---edit-the-default-profile-directly">A Better Way - Edit the Default Profile Directly</h1>

<p>My preferred method for modifying the default user experience is to edit the default user profile directly using a script that is run during Windows deployment. This type of script can also be run on existing machines or used in combination with CopyProfile. A benefit of this approach is that you can modify the default profile with or without a reference image.</p>

<h2 id="editing-the-default-profile">Editing the Default Profile</h2>

<p>To edit the default profile, we’ll use the command line tool REG to mount and make changes to the default user registry hive. Additionally we can make folder and file changes to the default profile and a couple of other command line tools to perform tasks such as pin and unpin shortcuts or change the Windows 7 Libraries. As far as this article is concerned, the default profile is in its default location, usually C:\Users\Default. In a script, you could refer to this location as %SystemDrive%\Users\Default.</p>

<h3 id="finding-settings">Finding Settings</h3>

<p>To find the profile locations to modify there’s a couple of methods that I rely on:</p>

<ul>
  <li>Google (or your favourite search engine)</li>
  <li>Process Monitor and Process Explorer</li>
</ul>

<p>In most cases, someone (or even Microsoft) will have documented a registry value or profile location that is used to store a setting. More obscure or new settings will require detecting the location with Process Monitor. For example, to determine where a setting is stored in the Registry, create a filter in Process Monitor using the process name or process ID, additionally filtering on the operation such as RegSetValue, as shown below:</p>

<p><a href="http://stealthpuppy.com/wp-content/uploads/2013/12/ProcessMonitor-Explorer-Filter.png"><img class="size-full wp-image-3525 alignnone" alt="Configuring Process Monitor filter " src="http://stealthpuppy.com/wp-content/uploads/2013/12/ProcessMonitor-Explorer-Filter.png" width="519" height="310" srcset="https://stealthpuppy.com/wp-content/uploads/2013/12/ProcessMonitor-Explorer-Filter.png 519w, https://stealthpuppy.com/wp-content/uploads/2013/12/ProcessMonitor-Explorer-Filter-150x89.png 150w, https://stealthpuppy.com/wp-content/uploads/2013/12/ProcessMonitor-Explorer-Filter-300x179.png 300w" sizes="(max-width: 519px) 100vw, 519px" /></a></p>

<p>A trace with Process Monitor when making a preference change should result in something like this:</p>

<p><a href="http://stealthpuppy.com/wp-content/uploads/2013/12/ProcessMonitor-Explorer.png"><img class="alignnone size-full wp-image-3532" alt="Process Monitor results" src="http://stealthpuppy.com/wp-content/uploads/2013/12/ProcessMonitor-Explorer.png" width="888" height="464" srcset="https://stealthpuppy.com/wp-content/uploads/2013/12/ProcessMonitor-Explorer.png 888w, https://stealthpuppy.com/wp-content/uploads/2013/12/ProcessMonitor-Explorer-150x78.png 150w, https://stealthpuppy.com/wp-content/uploads/2013/12/ProcessMonitor-Explorer-300x156.png 300w, https://stealthpuppy.com/wp-content/uploads/2013/12/ProcessMonitor-Explorer-624x326.png 624w" sizes="(max-width: 888px) 100vw, 888px" /></a></p>

<p><a href="http://sourceforge.net/projects/regshot/">Regshot</a> is also useful for comparing a before and after change to the profile for determining registry value locations.</p>

<p>Additionally Process Explorer can be useful for tracking down a process that might be responsible for writing a setting by viewing the command line used to launch the process. Finding settings can sometimes be a time consuming process, but once found and documented, you’ve got a detailed understanding of the default profile.</p>

<h3 id="editing-the-registry">Editing the Registry</h3>

<p>To make direct registry edits to the default user profile, the REG command line utility is used to load the default profile registry hive, change a registry value and then unload the hive, saving it back to the default profile. The following lines show a rough example of how this is done:</p>

<pre class="lang:batch decode:true">REG LOAD HKU\DefaultUser %SystemDrive%\Users\Default\NTUSER.DAT
REG ADD HKU\DefaultUser\Software\KeyName /v ValueName /d Data /t REG_SZ /f
REG UNLOAD HKU\DefaultUser</pre>

<p>Note that this will need to be run with administrative privileges and in an elevated context, so that you have write access to the default profile.</p>

<h2 id="pinning-and-unpinning-shortcuts">Pinning and Unpinning Shortcuts</h2>

<p>A common requirement is to modify the the pinned shortcuts on the Taskbar or Start menu. This can be automated using a script, which needs to run a first logon (either as the user, or in the profile copied over the default profile via Sysprep/CopyProfile). Unfortunately I can’t find the original source for this script; however it works quite well and allows you to pin shortcuts to and unpin shortcuts from the Taskbar and Start menu via a command line. The script is available here:</p>

<p class="important">
  [download id=&#8221;62&#8243; format=&#8221;1&#8243;]
</p>

<p>Note that Windows 8 and above, do not expose a programatic method to pin and unpin shortcuts to the Start screen. If you’re looking to customise the Start screen, refer to this existing article: <a href="http://stealthpuppy.com/customizing-the-windows-8-1-start-screen-dont-follow-microsofts-guidance/">http://stealthpuppy.com/customizing-the-windows-8-1-start-screen-dont-follow-microsofts-guidance/</a>.</p>

<h2 id="modifying-the-windows-libraries">Modifying the Windows Libraries</h2>

<p>By default, the Libraries introduced in Windows 7, include the public folder locations. Removing these or adding locations requires editing the Libraries; however they’re stored in XML files and are created at first logon. To modify the libraries, you can use a command line tool ShLib.exe. Like pinning and unpinning shortcuts, this tool also needs to be run at first logon (and won’t work via CopyProfile). This article, <a href="http://www.grimadmin.com/article.php/creating-modifying-windows-7-libraries">Administratively Create and Modify Windows 7 Libraries</a>, covers the use of ShLib.exe quite well.</p>

<h2 id="implementing-a-script-to-modify-the-default-profile">Implementing a Script to Modify the Default Profile</h2>

<p>Once you’ve created your script to make changes to the default registry, modify the default profile folder locations, pin and unpin shortcuts and make changes to the Libraries, you’ll need to implement the changes on the target PCs via script. Using an automation solution such as the Microsoft Deployment Toolkit (or an ESD like System Center Configuration Manager) the script can be run during a deployment task sequence. In the case of MDT, the script will be run after Windows unattended setup has completed in the local Administrator context. This way the script will have full elevation and write access to the default profile. An ESD solution will typically run the script via the local SYSTEM account. If you need to make changes to existing PCs, you’ll need a method to do so, such as an advertisement in Configuration Manager. If you take this approach, you can combine a script that makes direct changes to the default profile with the CopyProfile approach. That allows you to modify the profile for deployments from an unmodified OS as well as a custom image, keeping consistency across deployment types.</p>

<h1 id="example-scripts">Example Scripts</h1>

<p>Included here, along with some notation, are some example scripts for modifying the Windows 7 and Windows 8.1 default profiles. These example scripts include creation of a script at runtime that will run during first logon of any new profile. This is implemented as a batch file to keep things as simple as possible. Users will see a Command Prompt window as the script runs (but only once). The command lines includes in the script could be implemented with a UEM solution such as AppSense Environment Manager or even Group Policy to improve the user experience.</p>

<h2 id="windows-7">Windows 7</h2>

<p>Here’s a sample script that will modify the default profile on a Windows 7 PC (x86 and x64). At a high level, the script will perform the following steps:</p>

<ul>
  <li>Load and modifies the registry of the default profile</li>
  <li>Copies ExecuteVerbAction.VBS and ShLib.exe to folder under %ProgramFiles%</li>
  <li>Creates a batch script that will run on first logon to edit the Libraries and pin/unpin shortcuts. Once the script runs for the user, it will delete itself.</li>
</ul>

<pre class="lang:batch decode:true">@ECHO OFF
REM Load the default profile hive
SET HKEY=HKU\Default
REG LOAD %HKEY% %SystemDrive%\Users\Default\NTUSER.DAT

REM Sound and end-application
REG ADD "%HKEY%\Control Panel\Sound" /v Beep /t REG_SZ /d NO /f
REG ADD "%HKEY%\Control Panel\Sound" /v ExtendedSounds /t REG_SZ /d NO /f
REG ADD "%HKEY%\Control Panel\Desktop" /v HungAppTimeout /t REG_SZ /d 5000 /f
REG ADD "%HKEY%\Control Panel\Desktop" /v AutoEndTasks /t REG_SZ /d 1 /f
REG ADD "%HKEY%\Control Panel\Desktop" /v WaitToKillAppTimeout /t REG_SZ /d 4000 /f

REM Command Prompt settings
REG ADD "%HKEY%\Console" /v QuickEdit /t REG_DWORD /d 1 /f
REG ADD "%HKEY%\Software\Microsoft\Command Processor" /v CompletionChar /t REG_DWORD /d 9 /f
REG ADD "%HKEY%\Software\Microsoft\Command Processor" /v PathCompletionChar /t REG_DWORD /d 9 /f
REG ADD "%HKEY%\Software\Microsoft\Windows NT\CurrentVersion\Network\Persistent Connections" /v SaveConnections /d "no" /t REG_SZ /f

REM Language bar - only apply if using single regional settings
REM	REG ADD "%HKEY%\Software\Microsoft\CTF\LangBar" /v ShowStatus /t REG_DWORD /d 3 /f
REM	REG ADD "%HKEY%\Software\Microsoft\CTF\LangBar" /v Label /t REG_DWORD /d 1 /f
REM	REG ADD "%HKEY%\Software\Microsoft\CTF\LangBar" /v ExtraIconsOnMinimized /t REG_DWORD /d 0 /f

REM Windows Explorer and Start Menu
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v SeparateProcess /t REG_DWORD /d 1 /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v ServerAdminUI /t REG_DWORD /d 0 /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v Start_AdminToolsRoot /t REG_DWORD /d 0 /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v Start_PowerButtonAction /t REG_DWORD /d 2 /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v Start_ShowDownloads /t REG_DWORD /d 1 /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v Start_ShowMyGames /t REG_DWORD /d 0 /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v Start_ShowMyMusic /t REG_DWORD /d 0 /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v StartMenuAdminTools /t REG_DWORD /d 0 /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v StartMenuFavorites /t REG_DWORD /d 1 /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v TaskbarSizeMove /t REG_DWORD /d 0 /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\AutoComplete" /v "Append Completion" /t REG_SZ /d YES /f
REG ADD "%HKEY%\AppEvents\Schemes\Apps\Explorer\Navigating\.Current" /ve /t REG_EXPAND_SZ /d "" /f

REM Set IE as default browser, prevent prompting user
REG ADD "%HKEY%\Software\Clients\StartmenuInternet" /ve /d "IEXPLORE.EXE" /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.mht\UserChoice" /v Progid /d "IE.AssocFile.MHT" /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.html\UserChoice" /v Progid /d "IE.AssocFile.HTM" /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.htm\UserChoice" /v Progid /d "IE.AssocFile.HTM" /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.url\UserChoice" /v Progid /d "IE.AssocFile.URL" /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.mhtml\UserChoice" /v Progid /d "IE.AssocFile.MHT" /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.xht\UserChoice" /v Progid /d "IE.AssocFile.XHT" /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.svg\UserChoice" /v Progid /d "IE.AssocFile.SVG" /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.partial\UserChoice" /v Progid /d "IE.AssocFile.PARTIAL" /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.website\UserChoice" /v Progid /d "IE.AssocFile.WEBSITE" /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.xhtml\UserChoice" /v Progid /d "IE.AssocFile.XHT" /f
REG ADD "%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\https\UserChoice" /v Progid /d "IE.HTTPS" /f
REG ADD "%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\ftp\UserChoice" /v Progid /d "IE.FTP" /f
REG ADD "%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\http\UserChoice" /v Progid /d "IE.HTTP" /f
REG ADD "%HKEY%\Software\Microsoft\Windows\Shell\Associations\MIMEAssociations\message/rfc822\UserChoice" /v Progid /d "IE.message/rfc822" /f
REG ADD "%HKEY%\Software\Microsoft\Windows\Shell\Associations\MIMEAssociations\text/html\UserChoice" /v Progid /d "IE.text/html" /f

REM Additional Internet Explorer options
REG ADD "%HKEY%\Software\Microsoft\Internet Explorer\TabbedBrowsing" /v PopupsUseNewWindow /t REG_DWORD /d 0 /f
REG ADD "%HKEY%\Software\Microsoft\Internet Explorer\PhishingFilter" /v Enabled /t REG_DWORD /d 1 /f
REG ADD "%HKEY%\Software\Microsoft\Internet Explorer\Main" /v "Enable AutoImageResize" /t REG_SZ /d YES /f
REG ADD "%HKEY%\Software\Microsoft\Internet Explorer\PhishingFilter" /v Enabled /t REG_DWORD /d 2 /f
REM	REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\domain.local" /v * /t REG_DWORD /d 1 /f
REM	REG ADD "%HKEY%\Software\Microsoft\Internet Explorer\New Windows\Allow" /v *.domain.local /t REG_BINARY /d 0000 /f

REM Windows Media Player
REG ADD "%HKEY%\Software\Microsoft\MediaPlayer\Setup\UserOptions" /v DesktopShortcut /d No /t REG_SZ /f
REG ADD "%HKEY%\Software\Microsoft\MediaPlayer\Setup\UserOptions" /v QuickLaunchShortcut /d 0 /t REG_DWORD /f
REG ADD "%HKEY%\Software\Microsoft\MediaPlayer\Preferences" /v AcceptedPrivacyStatement /d 1 /t REG_DWORD /f
REG ADD "%HKEY%\Software\Microsoft\MediaPlayer\Preferences" /v FirstRun /d 0 /t REG_DWORD /f
REG ADD "%HKEY%\Software\Microsoft\MediaPlayer\Preferences" /v DisableMRU /d 1 /t REG_DWORD /f
REG ADD "%HKEY%\Software\Microsoft\MediaPlayer\Preferences" /v AutoCopyCD /d 0 /t REG_DWORD /f

REM Help and Support
REG ADD "%HKEY%\Software\Microsoft\Assistance\Client\1.0\Settings" /v OnlineAssist /d 1 /t REG_DWORD /f
REG ADD "%HKEY%\Software\Microsoft\Assistance\Client\1.0\Settings" /v IsConnected /d 1 /t REG_DWORD /f

REM Remove localisation - Themes, Feeds, Favourites
REG DELETE "%HKEY%\Software\Microsoft\Windows\CurrentVersion\RunOnce" /v mctadmin /f

REM Snipping Tool
REG ADD "%HKEY%\Software\Microsoft\Windows\TabletPC\Snipping Tool" /v ShowCaptureStroke /d 0 /t REG_DWORD /f

REM Unload the default profile hive
REG UNLOAD %HKEY%

REM Setup Taskbar unpin items on first login
IF NOT EXIST "%ProgramFiles%\Scripts" MD "%ProgramFiles%\Scripts"
COPY /Y ExecuteVerbAction.VBS "%ProgramFiles%\Scripts\ExecuteVerbAction.VBS"
COPY /Y ShLib.exe "%ProgramFiles%\Scripts\ShLib.exe"

MD "%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup"
ECHO @ECHO OFF &gt; "%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd"
ECHO cscript.exe "%ProgramFiles%\Scripts\ExecuteVerbAction.vbs" "%ProgramData%\Microsoft\Windows\Start Menu\Programs\Windows Media Player.lnk" UnpinFromTaskbar &gt;&gt; "%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd"
ECHO "%ProgramFiles%\Scripts\shlib" remove "%%APPDATA%%\Microsoft\Windows\Libraries\Documents.library-ms" %PUBLIC%\Documents &gt;&gt; "%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd"
ECHO "%ProgramFiles%\Scripts\shlib" remove "%%APPDATA%%\Microsoft\Windows\Libraries\Music.library-ms" %PUBLIC%\Music &gt;&gt; "%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd"
ECHO "%ProgramFiles%\Scripts\shlib" remove "%%APPDATA%%\Microsoft\Windows\Libraries\Pictures.library-ms" %PUBLIC%\Pictures &gt;&gt; "%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd"
ECHO "%ProgramFiles%\Scripts\shlib" remove "%%APPDATA%%\Microsoft\Windows\Libraries\Videos.library-ms" %PUBLIC%\Videos &gt;&gt; "%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd"
ECHO DEL /Q "%%APPDATA%%\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd" &gt;&gt; "%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd"</pre>

<p>If you use this in a production environment, please test and confirm each setting to ensure you understand what the script will implement.</p>

<h2 id="windows-81">Windows 8.1</h2>

<p>Here’s a sample script that will modify the default profile on a Windows 8.1 PC (x86 and x64). At a high level, the script will perform the following steps:</p>

<ul>
  <li>Load and modifies the registry of the default profile</li>
  <li>Import a pre-configured Start screen</li>
  <li>Copies ExecuteVerbAction.VBS and ShLib.exe to folder under %ProgramFiles%</li>
  <li>Creates a batch script that will run on first logon to edit the Libraries and pin/unpin shortcuts. Once the script runs for the user, it will delete itself</li>
</ul>

<pre class="lang:batch decode:true">@ECHO OFF
REM Load the default profile hive
SET HKEY=HKU\Default
REG LOAD %HKEY% %SystemDrive%\Users\Default\NTUSER.DAT

REM Sound and end-application
REG ADD "%HKEY%\Control Panel\Sound" /v Beep /t REG_SZ /d NO /f
REG ADD "%HKEY%\Control Panel\Sound" /v ExtendedSounds /t REG_SZ /d NO /f
REG ADD "%HKEY%\Control Panel\Desktop" /v HungAppTimeout /t REG_SZ /d 5000 /f
REG ADD "%HKEY%\Control Panel\Desktop" /v AutoEndTasks /t REG_SZ /d 1 /f
REG ADD "%HKEY%\Control Panel\Desktop" /v WaitToKillAppTimeout /t REG_SZ /d 4000 /f

REM Command Prompt settings
REG ADD "%HKEY%\Console" /v QuickEdit /t REG_DWORD /d 1 /f
REG ADD "%HKEY%\Software\Microsoft\Windows NT\CurrentVersion\Network\Persistent Connections" /v SaveConnections /d "no" /t REG_SZ /f

REM Language bar - only apply if using single regional settings
REM	REG ADD "%HKEY%\Software\Microsoft\CTF\LangBar" /v ShowStatus /t REG_DWORD /d 3 /f
REM	REG ADD "%HKEY%\Software\Microsoft\CTF\LangBar" /v Label /t REG_DWORD /d 1 /f
REM	REG ADD "%HKEY%\Software\Microsoft\CTF\LangBar" /v ExtraIconsOnMinimized /t REG_DWORD /d 0 /f

REM Windows Explorer
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v SeparateProcess /t REG_DWORD /d 1 /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v TaskbarSizeMove /t REG_DWORD /d 0 /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\AutoComplete" /v "Append Completion" /t REG_SZ /d YES /f
REG ADD "%HKEY%\AppEvents\Schemes\Apps\Explorer\Navigating\.Current" /ve /t REG_EXPAND_SZ /d "" /f

REM Windows 8 navigation settings
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\StartPage" /v OpenAtLogon /t REG_DWORD /d 0 /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\StartPage" /v DesktopFirst /t REG_DWORD /d 0 /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\StartPage" /v MakeAllAppsDefault /t REG_DWORD /d 0 /f
REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\StartPage" /v MonitorOverride /t REG_DWORD /d 0 /f

REM Set IE as default browser, prevent prompting user
REM	REG ADD "%HKEY%\Software\Clients\StartmenuInternet" /ve /d "IEXPLORE.EXE" /f
REM	REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.mht\UserChoice" /v Progid /d "IE.AssocFile.MHT" /f
REM	REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.html\UserChoice" /v Progid /d "IE.AssocFile.HTM" /f
REM	REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.htm\UserChoice" /v Progid /d "IE.AssocFile.HTM" /f
REM	REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.url\UserChoice" /v Progid /d "IE.AssocFile.URL" /f
REM	REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.mhtml\UserChoice" /v Progid /d "IE.AssocFile.MHT" /f
REM	REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.xht\UserChoice" /v Progid /d "IE.AssocFile.XHT" /f
REM	REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.svg\UserChoice" /v Progid /d "IE.AssocFile.SVG" /f
REM	REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.partial\UserChoice" /v Progid /d "IE.AssocFile.PARTIAL" /f
REM	REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.website\UserChoice" /v Progid /d "IE.AssocFile.WEBSITE" /f
REM	REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.xhtml\UserChoice" /v Progid /d "IE.AssocFile.XHT" /f
REM	REG ADD "%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\https\UserChoice" /v Progid /d "IE.HTTPS" /f
REM	REG ADD "%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\ftp\UserChoice" /v Progid /d "IE.FTP" /f
REM	REG ADD "%HKEY%\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\http\UserChoice" /v Progid /d "IE.HTTP" /f
REM	REG ADD "%HKEY%\Software\Microsoft\Windows\Shell\Associations\MIMEAssociations\message\rfc822\UserChoice" /v Progid /d "IE.message/rfc822" /f
REM	REG ADD "%HKEY%\Software\Microsoft\Windows\Shell\Associations\MIMEAssociations\text\html\UserChoice" /v Progid /d "IE.text/html" /f

REM Additional Internet Explorer options
REM	REG ADD "%HKEY%\Software\Microsoft\Internet Explorer\TabbedBrowsing" /v PopupsUseNewWindow /t REG_DWORD /d 0 /f
REM	REG ADD "%HKEY%\Software\Microsoft\Internet Explorer\PhishingFilter" /v Enabled /t REG_DWORD /d 1 /f
REM	REG ADD "%HKEY%\Software\Microsoft\Internet Explorer\Main" /v "Enable AutoImageResize" /t REG_SZ /d YES /f
REM	REG ADD "%HKEY%\Software\Microsoft\Internet Explorer\PhishingFilter" /v Enabled /t REG_DWORD /d 2 /f
REM	REG ADD "%HKEY%\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\domain.local" /v * /t REG_DWORD /d 1 /f
REM	REG ADD "%HKEY%\Software\Microsoft\Internet Explorer\New Windows\Allow" /v *.domain.local /t REG_BINARY /d 0000 /f

REM Windows Media Player
REG ADD "%HKEY%\Software\Microsoft\MediaPlayer\Setup\UserOptions" /v DesktopShortcut /d No /t REG_SZ /f
REG ADD "%HKEY%\Software\Microsoft\MediaPlayer\Setup\UserOptions" /v QuickLaunchShortcut /d 0 /t REG_DWORD /f
REG ADD "%HKEY%\Software\Microsoft\MediaPlayer\Preferences" /v AcceptedPrivacyStatement /d 1 /t REG_DWORD /f
REG ADD "%HKEY%\Software\Microsoft\MediaPlayer\Preferences" /v FirstRun /d 0 /t REG_DWORD /f
REG ADD "%HKEY%\Software\Microsoft\MediaPlayer\Preferences" /v DisableMRU /d 1 /t REG_DWORD /f
REG ADD "%HKEY%\Software\Microsoft\MediaPlayer\Preferences" /v AutoCopyCD /d 0 /t REG_DWORD /f

REM Unload the default profile hive
REG UNLOAD %HKEY%

REM Configure the default Start Screen
IF NOT EXIST %SystemDrive%\Users\Default\AppData\Local\Microsoft\Windows MD %SystemDrive%\Users\Default\AppData\Local\Microsoft\Windows
POWERSHELL -NonInteractive -Command Import-StartLayout -LayoutPath .\CustomStartScreenLayout.bin -MountPath %SystemDrive%\

REM Setup Taskbar unpin items on first login
IF NOT EXIST "%ProgramFiles%\Scripts" MD "%ProgramFiles%\Scripts"
COPY /Y ExecuteVerbAction.VBS "%ProgramFiles%\Scripts\ExecuteVerbAction.VBS"
COPY /Y ShLib.exe "%ProgramFiles%\Scripts\ShLib.exe"

MD "%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup"
ECHO @ECHO OFF &gt; "%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd"
REM	ECHO cscript.exe "%ProgramFiles%\Scripts\ExecuteVerbAction.vbs" "%ProgramData%\Microsoft\Windows\Start Menu\Programs\Windows Media Player.lnk" UnpinFromTaskbar &gt;&gt; "%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd"
ECHO "%ProgramFiles%\Scripts\shlib" remove "%%APPDATA%%\Microsoft\Windows\Libraries\Documents.library-ms" %PUBLIC%\Documents &gt;&gt; "%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd"
ECHO "%ProgramFiles%\Scripts\shlib" remove "%%APPDATA%%\Microsoft\Windows\Libraries\Music.library-ms" %PUBLIC%\Music &gt;&gt; "%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd"
ECHO "%ProgramFiles%\Scripts\shlib" remove "%%APPDATA%%\Microsoft\Windows\Libraries\Pictures.library-ms" %PUBLIC%\Pictures &gt;&gt; "%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd"
ECHO "%ProgramFiles%\Scripts\shlib" remove "%%APPDATA%%\Microsoft\Windows\Libraries\Videos.library-ms" %PUBLIC%\Videos &gt;&gt; "%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd"
ECHO DEL /Q "%%APPDATA%%\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd" &gt;&gt; "%SystemDrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\PinnedItemsLibraries.cmd"</pre>

<p>If you use this in a production environment, please test and confirm each setting to ensure you understand what the script will implement.</p>

<h1 id="summing-up">Summing Up</h1>

<p>There are numerous ways to edit the default profile, some more complicated and involved than others. It’s my view that the best way to modify the default profile is targeting the required settings, which does mean more work. However, this approach results in a better understanding of the user environment and with any luck a better user experience.</p>

<p>Each new major release of Windows results in less modifications, so your job will be easier. There are a few scripts and tools you’ll need to have in place and I’m confident the approach outlined here will result in happy users (or at least users who aren’t complaining).</p>

<p>In the next article on the same subject, I’ll cover customising the default profile for Remote Desktop Services Session Hosts.</p>

  </div><a class="u-url" href="/customize-the-windows-default-profile/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">aaron parker</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">aaron parker</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/aaronparker"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">aaronparker</span></a></li><li><a href="https://www.twitter.com/stealthpuppy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">stealthpuppy</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>on end user computing and enterprise mobility
</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
