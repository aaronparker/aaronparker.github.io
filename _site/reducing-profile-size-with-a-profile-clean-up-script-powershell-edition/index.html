<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Reducing Profile Size with a Profile Clean Up Script - PowerShell Edition | stealthpuppy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Reducing Profile Size with a Profile Clean Up Script - PowerShell Edition" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="&lt;img class=”size-full wp-image-2624 alignnone” title=”Delete by Cari McGee” src=”/media/2012/01/AppleKeyboardDeletePowerShell.png” alt=”Delete by Cari McGee I recently posted a script for removing unnecessary files and pruning files based on their age, which can be used at logoff to keep profile sizes manageable - Reducing Profile Size with a Profile Clean Up Script. Andrew Morgan (@andyjmorgan) has kindly translated my very basic VBscript to PowerShell. This can be used as a standalone script or the function (remove-itembyage) could be integrated into your own scripts and has the added benefit of in-built help and the ability to run silently. Just like the original script, this could be executed at logoff, before the profile is saved back to the network, to perform two actions: Delete all files of a specific file type in a specified folder, including sub-folders Delete all files older than X days in a specified folder, including sub-folders For example, you could use the script to delete all .log or temporary files below %APPDATA% that aren’t required to be roamed, or delete all Cookies older than 90 days to keep the Cookies folder to a manageable size. Note: the script listing below has the -whatif parameter applied when calling the function, so no deletes will occur unless the parameter is removed. function remove-itembyage { &lt;# .SYNOPSIS remove items from folders recursively. .DESCRIPTION this function removes items older than a specified age from the target folder .PARAMETER Days Specifies the ammount of days since the file was last written to you wish to filter on. .PARAMETER Path Specifies the path to the folder you wish to search recursively. .PARAMETER Silent Instructs the function not to return any output. .EXAMPLE PS C:\&gt; remove-itembyage -days 0 -path $recent This command searches the $recent directory, for any files, then deletes them. .EXAMPLE PS C:\&gt; remove-itembyage -days 5 -path $recent This command searches the $recent directory, for files older than 5 days, then deletes them. .EXAMPLE PS C:\&gt; remove-itembyage -days 10 -path $appdata -typefilter &quot;txt,log&quot; This command searches the $cookies directory, for files older than 10 days and end with txt or log extensions, then deletes them. .EXAMPLE PS C:\&gt; remove-itembyage -days 10 -path $cookies -typefilter &quot;txt,log&quot; -silent This command searches the $cookies directory, for files older than 10 days and end with txt or log extensions, then deletes them without a report. .NOTES /user-virtualization/profile-clean-up-script-powershell-edition/ for support information. .LINK /user-virtualization/profile-clean-up-script-powershell-edition/ #&gt; [cmdletbinding(SupportsShouldProcess = $True)] param( [Parameter(Mandatory = $true, Position = 0, HelpMessage = &quot;Number of days to filter by, E.G. &quot;&quot;14&quot;&quot;&quot;)] [int]$days, [Parameter(Mandatory = $true, Position = 1, HelpMessage = &quot;Path to files you wish to delete&quot;)] [string]$path, [string]$typefilter, [switch]$silent) #check for silent switch if ($silent) {$ea = &quot;Silentlycontinue&quot;} Else {$ea = &quot;Continue&quot;} #check for typefilter, creates an array if specified. if (!($typefilter)) {$filter = &quot;*&quot;} Else {$filter = foreach ($item in $typefilter.split(&quot;,&quot;)) {$item.insert(0, &quot;*.&quot;)}} if (test-path $path) { $now = get-date $datefilter = $now.adddays( - $days) foreach ($file in get-childitem &quot;$path\*&quot; -recurse -force -include $filter | where {$_.PSIsContainer -eq $false -and $_.lastwritetime -le $datefilter -and $_.name -ne &quot;desktop.ini&quot;}) { if (!($silent)) {write-host &quot;Deleting: $($file.fullname)&quot;} remove-item -literalPath $file.fullname -force -ea $ea }#end for }#end if Else { if (!($silent)) {write-warning &quot;the path specified does not exist! ($path)&quot;} }#end else }#end function #Get KnownFolder Paths $appdata = $env:appdata $Cookies = (new-object -com shell.application).namespace(289).Self.Path $History = (new-object -com shell.application).namespace(34).Self.Path $recent = (new-object -com shell.application).namespace(8).Self.Path $profile = $env:userprofile #commands remove-itembyage -days 0 -path $appdata -typefilter &quot;txt,log&quot; -silent -whatif remove-itembyage -days 90 -path $cookies -silent -whatif remove-itembyage -days 14 -path $recent -silent -whatif remove-itembyage -days 21 -path $history -silent -whatif remove-itembyage -days 14 -path &quot;$appdata\Microsoft\office\Recent&quot; -silent -whatif" />
<meta property="og:description" content="&lt;img class=”size-full wp-image-2624 alignnone” title=”Delete by Cari McGee” src=”/media/2012/01/AppleKeyboardDeletePowerShell.png” alt=”Delete by Cari McGee I recently posted a script for removing unnecessary files and pruning files based on their age, which can be used at logoff to keep profile sizes manageable - Reducing Profile Size with a Profile Clean Up Script. Andrew Morgan (@andyjmorgan) has kindly translated my very basic VBscript to PowerShell. This can be used as a standalone script or the function (remove-itembyage) could be integrated into your own scripts and has the added benefit of in-built help and the ability to run silently. Just like the original script, this could be executed at logoff, before the profile is saved back to the network, to perform two actions: Delete all files of a specific file type in a specified folder, including sub-folders Delete all files older than X days in a specified folder, including sub-folders For example, you could use the script to delete all .log or temporary files below %APPDATA% that aren’t required to be roamed, or delete all Cookies older than 90 days to keep the Cookies folder to a manageable size. Note: the script listing below has the -whatif parameter applied when calling the function, so no deletes will occur unless the parameter is removed. function remove-itembyage { &lt;# .SYNOPSIS remove items from folders recursively. .DESCRIPTION this function removes items older than a specified age from the target folder .PARAMETER Days Specifies the ammount of days since the file was last written to you wish to filter on. .PARAMETER Path Specifies the path to the folder you wish to search recursively. .PARAMETER Silent Instructs the function not to return any output. .EXAMPLE PS C:\&gt; remove-itembyage -days 0 -path $recent This command searches the $recent directory, for any files, then deletes them. .EXAMPLE PS C:\&gt; remove-itembyage -days 5 -path $recent This command searches the $recent directory, for files older than 5 days, then deletes them. .EXAMPLE PS C:\&gt; remove-itembyage -days 10 -path $appdata -typefilter &quot;txt,log&quot; This command searches the $cookies directory, for files older than 10 days and end with txt or log extensions, then deletes them. .EXAMPLE PS C:\&gt; remove-itembyage -days 10 -path $cookies -typefilter &quot;txt,log&quot; -silent This command searches the $cookies directory, for files older than 10 days and end with txt or log extensions, then deletes them without a report. .NOTES /user-virtualization/profile-clean-up-script-powershell-edition/ for support information. .LINK /user-virtualization/profile-clean-up-script-powershell-edition/ #&gt; [cmdletbinding(SupportsShouldProcess = $True)] param( [Parameter(Mandatory = $true, Position = 0, HelpMessage = &quot;Number of days to filter by, E.G. &quot;&quot;14&quot;&quot;&quot;)] [int]$days, [Parameter(Mandatory = $true, Position = 1, HelpMessage = &quot;Path to files you wish to delete&quot;)] [string]$path, [string]$typefilter, [switch]$silent) #check for silent switch if ($silent) {$ea = &quot;Silentlycontinue&quot;} Else {$ea = &quot;Continue&quot;} #check for typefilter, creates an array if specified. if (!($typefilter)) {$filter = &quot;*&quot;} Else {$filter = foreach ($item in $typefilter.split(&quot;,&quot;)) {$item.insert(0, &quot;*.&quot;)}} if (test-path $path) { $now = get-date $datefilter = $now.adddays( - $days) foreach ($file in get-childitem &quot;$path\*&quot; -recurse -force -include $filter | where {$_.PSIsContainer -eq $false -and $_.lastwritetime -le $datefilter -and $_.name -ne &quot;desktop.ini&quot;}) { if (!($silent)) {write-host &quot;Deleting: $($file.fullname)&quot;} remove-item -literalPath $file.fullname -force -ea $ea }#end for }#end if Else { if (!($silent)) {write-warning &quot;the path specified does not exist! ($path)&quot;} }#end else }#end function #Get KnownFolder Paths $appdata = $env:appdata $Cookies = (new-object -com shell.application).namespace(289).Self.Path $History = (new-object -com shell.application).namespace(34).Self.Path $recent = (new-object -com shell.application).namespace(8).Self.Path $profile = $env:userprofile #commands remove-itembyage -days 0 -path $appdata -typefilter &quot;txt,log&quot; -silent -whatif remove-itembyage -days 90 -path $cookies -silent -whatif remove-itembyage -days 14 -path $recent -silent -whatif remove-itembyage -days 21 -path $history -silent -whatif remove-itembyage -days 14 -path &quot;$appdata\Microsoft\office\Recent&quot; -silent -whatif" />
<link rel="canonical" href="/reducing-profile-size-with-a-profile-clean-up-script-powershell-edition/" />
<meta property="og:url" content="/reducing-profile-size-with-a-profile-clean-up-script-powershell-edition/" />
<meta property="og:site_name" content="stealthpuppy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2012-01-05T17:09:55+11:00" />
<script type="application/ld+json">
{"description":"&lt;img class=”size-full wp-image-2624 alignnone” title=”Delete by Cari McGee” src=”/media/2012/01/AppleKeyboardDeletePowerShell.png” alt=”Delete by Cari McGee I recently posted a script for removing unnecessary files and pruning files based on their age, which can be used at logoff to keep profile sizes manageable - Reducing Profile Size with a Profile Clean Up Script. Andrew Morgan (@andyjmorgan) has kindly translated my very basic VBscript to PowerShell. This can be used as a standalone script or the function (remove-itembyage) could be integrated into your own scripts and has the added benefit of in-built help and the ability to run silently. Just like the original script, this could be executed at logoff, before the profile is saved back to the network, to perform two actions: Delete all files of a specific file type in a specified folder, including sub-folders Delete all files older than X days in a specified folder, including sub-folders For example, you could use the script to delete all .log or temporary files below %APPDATA% that aren’t required to be roamed, or delete all Cookies older than 90 days to keep the Cookies folder to a manageable size. Note: the script listing below has the -whatif parameter applied when calling the function, so no deletes will occur unless the parameter is removed. function remove-itembyage { &lt;# .SYNOPSIS remove items from folders recursively. .DESCRIPTION this function removes items older than a specified age from the target folder .PARAMETER Days Specifies the ammount of days since the file was last written to you wish to filter on. .PARAMETER Path Specifies the path to the folder you wish to search recursively. .PARAMETER Silent Instructs the function not to return any output. .EXAMPLE PS C:\\&gt; remove-itembyage -days 0 -path $recent This command searches the $recent directory, for any files, then deletes them. .EXAMPLE PS C:\\&gt; remove-itembyage -days 5 -path $recent This command searches the $recent directory, for files older than 5 days, then deletes them. .EXAMPLE PS C:\\&gt; remove-itembyage -days 10 -path $appdata -typefilter &quot;txt,log&quot; This command searches the $cookies directory, for files older than 10 days and end with txt or log extensions, then deletes them. .EXAMPLE PS C:\\&gt; remove-itembyage -days 10 -path $cookies -typefilter &quot;txt,log&quot; -silent This command searches the $cookies directory, for files older than 10 days and end with txt or log extensions, then deletes them without a report. .NOTES /user-virtualization/profile-clean-up-script-powershell-edition/ for support information. .LINK /user-virtualization/profile-clean-up-script-powershell-edition/ #&gt; [cmdletbinding(SupportsShouldProcess = $True)] param( [Parameter(Mandatory = $true, Position = 0, HelpMessage = &quot;Number of days to filter by, E.G. &quot;&quot;14&quot;&quot;&quot;)] [int]$days, [Parameter(Mandatory = $true, Position = 1, HelpMessage = &quot;Path to files you wish to delete&quot;)] [string]$path, [string]$typefilter, [switch]$silent) #check for silent switch if ($silent) {$ea = &quot;Silentlycontinue&quot;} Else {$ea = &quot;Continue&quot;} #check for typefilter, creates an array if specified. if (!($typefilter)) {$filter = &quot;*&quot;} Else {$filter = foreach ($item in $typefilter.split(&quot;,&quot;)) {$item.insert(0, &quot;*.&quot;)}} if (test-path $path) { $now = get-date $datefilter = $now.adddays( - $days) foreach ($file in get-childitem &quot;$path\\*&quot; -recurse -force -include $filter | where {$_.PSIsContainer -eq $false -and $_.lastwritetime -le $datefilter -and $_.name -ne &quot;desktop.ini&quot;}) { if (!($silent)) {write-host &quot;Deleting: $($file.fullname)&quot;} remove-item -literalPath $file.fullname -force -ea $ea }#end for }#end if Else { if (!($silent)) {write-warning &quot;the path specified does not exist! ($path)&quot;} }#end else }#end function #Get KnownFolder Paths $appdata = $env:appdata $Cookies = (new-object -com shell.application).namespace(289).Self.Path $History = (new-object -com shell.application).namespace(34).Self.Path $recent = (new-object -com shell.application).namespace(8).Self.Path $profile = $env:userprofile #commands remove-itembyage -days 0 -path $appdata -typefilter &quot;txt,log&quot; -silent -whatif remove-itembyage -days 90 -path $cookies -silent -whatif remove-itembyage -days 14 -path $recent -silent -whatif remove-itembyage -days 21 -path $history -silent -whatif remove-itembyage -days 14 -path &quot;$appdata\\Microsoft\\office\\Recent&quot; -silent -whatif","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/reducing-profile-size-with-a-profile-clean-up-script-powershell-edition/","headline":"Reducing Profile Size with a Profile Clean Up Script - PowerShell Edition","dateModified":"2012-01-05T17:09:55+11:00","datePublished":"2012-01-05T17:09:55+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"/reducing-profile-size-with-a-profile-clean-up-script-powershell-edition/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="stealthpuppy" /></head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">stealthpuppy</a></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Reducing Profile Size with a Profile Clean Up Script - PowerShell Edition</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2012-01-05T17:09:55+11:00" itemprop="datePublished">Jan 5, 2012
      </time><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card"
          itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><a href="http://www.flickr.com/photos/pleeker/5379549514/">&lt;img class=”size-full wp-image-2624 alignnone” title=”Delete by Cari McGee” src=”/media/2012/01/AppleKeyboardDeletePowerShell.png” alt=”Delete by Cari McGee</a></p>

<p>I recently posted a script for removing unnecessary files and pruning files based on their age, which can be used at logoff to keep profile sizes manageable - <a href="/user-virtualization/profile-clean-up-script/">Reducing Profile Size with a Profile Clean Up Script</a>.</p>

<p><a href="http://andrewmorgan.ie/about-2/">Andrew Morgan</a> (<a href="http://twitter.com/andyjmorgan">@andyjmorgan</a>) has kindly translated my very basic VBscript to PowerShell. This can be used as a standalone script or the function (<em>remove-itembyage</em>) could be integrated into your own scripts and has the added benefit of in-built help and the ability to run silently.</p>

<p>Just like the original script, this could be executed at logoff, before the profile is saved back to the network, to perform two actions:</p>

<ol>
  <li>Delete all files of a specific file type in a specified folder, including sub-folders</li>
  <li>Delete all files older than X days in a specified folder, including sub-folders</li>
</ol>

<p>For example, you could use the script to delete all .log or temporary files below %APPDATA% that aren’t required to be roamed, or delete all Cookies older than 90 days to keep the Cookies folder to a manageable size.</p>

<p><strong>Note</strong>: the script listing below has the -whatif parameter applied when calling the function, so no deletes will occur unless the parameter is removed.</p>

<pre class="prettyprint lang-powershell" data-start-line="1" data-visibility="visible" data-highlight="" data-caption="">function remove-itembyage {
    &lt;#
        .SYNOPSIS
        remove items from folders recursively.

        .DESCRIPTION
        this function removes items older than a specified age from the target folder

        .PARAMETER Days
        Specifies the ammount of days since the file was last written to you wish to filter on.

        .PARAMETER Path
        Specifies the path to the folder you wish to search recursively.

        .PARAMETER Silent
        Instructs the function not to return any output.

        .EXAMPLE
        PS C:\&gt; remove-itembyage -days 0 -path $recent

        This command searches the $recent directory, for any files, then deletes them.

        .EXAMPLE
        PS C:\&gt; remove-itembyage -days 5 -path $recent

        This command searches the $recent directory, for files older than 5 days, then deletes them.

        .EXAMPLE
        PS C:\&gt; remove-itembyage -days 10 -path $appdata -typefilter "txt,log"

        This command searches the $cookies directory, for files older than 10 days and end with txt or log extensions, then deletes them.

        .EXAMPLE
        PS C:\&gt; remove-itembyage -days 10 -path $cookies -typefilter "txt,log" -silent

        This command searches the $cookies directory, for files older than 10 days and end with txt or log extensions, then deletes them without a report.

        .NOTES
        /user-virtualization/profile-clean-up-script-powershell-edition/ for support information.

        .LINK
        /user-virtualization/profile-clean-up-script-powershell-edition/
    #&gt;

    [cmdletbinding(SupportsShouldProcess = $True)]
    param(
        [Parameter(Mandatory = $true, Position = 0, HelpMessage = "Number of days to filter by, E.G. ""14""")]
        [int]$days,
        [Parameter(Mandatory = $true, Position = 1, HelpMessage = "Path to files you wish to delete")]
        [string]$path,
        [string]$typefilter,
        [switch]$silent)

    #check for silent switch
    if ($silent) {$ea = "Silentlycontinue"}
    Else {$ea = "Continue"}

    #check for typefilter, creates an array if specified.
    if (!($typefilter)) {$filter = "*"}
    Else {$filter = foreach ($item in $typefilter.split(",")) {$item.insert(0, "*.")}}

    if (test-path $path) {
        $now = get-date
        $datefilter = $now.adddays( - $days)
        foreach ($file in get-childitem "$path\*" -recurse -force -include $filter | where {$_.PSIsContainer -eq $false -and $_.lastwritetime -le $datefilter -and $_.name -ne "desktop.ini"}) {
            if (!($silent)) {write-host "Deleting: $($file.fullname)"}
            remove-item -literalPath $file.fullname -force -ea $ea
        }#end for
    }#end if

    Else {
        if (!($silent)) {write-warning "the path specified does not exist! ($path)"}
    }#end else
}#end function

#Get KnownFolder Paths
$appdata = $env:appdata
$Cookies = (new-object -com shell.application).namespace(289).Self.Path
$History = (new-object -com shell.application).namespace(34).Self.Path
$recent = (new-object -com shell.application).namespace(8).Self.Path
$profile = $env:userprofile

#commands
remove-itembyage -days 0 -path $appdata -typefilter "txt,log" -silent -whatif
remove-itembyage -days 90 -path $cookies -silent -whatif
remove-itembyage -days 14 -path $recent -silent -whatif
remove-itembyage -days 21 -path $history -silent -whatif
remove-itembyage -days 14 -path "$appdata\Microsoft\office\Recent" -silent -whatif</pre>


  </div><a class="u-url" href="/reducing-profile-size-with-a-profile-clean-up-script-powershell-edition/" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col one-half">
      <h2 class="footer-heading">stealthpuppy</h2>
        <ul class="contact-list">
          <li class="p-name">stealthpuppy</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col one-half">
        <p>on end user computing and enterprise mobility</p>
      </div>

      <div class="social-links"><ul class="social-media-list"><li><a href="https://github.com/aaronparker" title="aaronparker"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a href="https://www.linkedin.com/in/aaronedwardparker" title="aaronedwardparker"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a href="https://twitter.com/stealthpuppy" title="stealthpuppy"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li><li><a href="/feed.xml" title="atom"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg></a></li></ul>
</div>
    </div>

  </div>

</footer>
</body>

</html>
