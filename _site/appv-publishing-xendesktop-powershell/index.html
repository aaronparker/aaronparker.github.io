<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Adding App-V Publishing Information to a XenDesktop Site with PowerShell | stealthpuppy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Adding App-V Publishing Information to a XenDesktop Site with PowerShell" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Adding Microsoft App-V publishing information to a XenDesktop or XenApp 7.x site is very easy via the Citrix Studio UI, but what if you want to automate this process? Of course, you’ll need to reach for PowerShell. What may not be widely known is that you can add additional App-V publishing configuration to a XenDesktop site beyond what you see in the UI. This allows you to set publishing information per delivery group. Useful for complex XenDesktop sites such as multi-tenant environments. Creating the App-V publishing information with PowerShell is a multi step process. You’ll need to create the publishing information with New-CtxAppVServer and then apply the configuration with New-BrokerMachineConfiguration. Applying this in practice however may ultimately require testing the App-V management and publishing servers and ensuring that the configuration does not already exist before adding it. So to do that, I’ve written a function that will take the App-V Management and Publishing servers as parameters, ensure that they test OK and check that the configuration does not already exist before importing the configuration into the site. This function is fairly basic and while it does do some error checking, it could probably go a little further to ensure the configuration is applied successfully. Function Set-CtxAppvConfig { &lt;# .SYNOPSIS Sets new App-V publishing information in a XenDesktop site. .DESCRIPTION This function can be used to set or add App-V publishing information in a XenDesktop or XenApp 7.x site. .PARAMETER AdminAddress Specifies a remote XenDesktop controller to apply the configuration against. If omitted, the local host will be used instead. .PARAMETER AppvMgmtSvr Specifies a remote XenDesktop controller to apply the configuration against. If omitted, the local host will be used instead. .PARAMETER AppvPubSvr Specifies a remote XenDesktop controller to apply the configuration against. If omitted, the local host will be used instead. .PARAMETER Description Specifies a remote XenDesktop controller to apply the configuration against. If omitted, the local host will be used instead. .EXAMPLE Set-CtxAppvConfig -AdminAddress &#39;xd71.home.stealthpuppy.com&#39; -AppvMgmtSvr &#39;http://appv1:8080&#39; -AppvPubSvr &#39;http://appv1:80&#39; -Description &#39;Created by PowerShell&#39; .NOTES .LINK Adding App-V Publishing Information to a XenDesktop Site with PowerShell #&gt; param( [Parameter(Mandatory=$false, Position=0,HelpMessage=&quot;XenDesktop Controller address.&quot;)] [string]$AdminAddress = &#39;localhost&#39;, [Parameter(Mandatory=$true, Position=1,HelpMessage=&quot;Microsoft App-V Management Server address.&quot;)] [string]$AppvMgmtSvr = $(throw = &quot;Please specify an App-V Management Server address.&quot;), [Parameter(Mandatory=$true, Position=2,HelpMessage=&quot;Microsoft App-V Publishing Server address.&quot;)] [string]$AppvPubSvr = $(throw = &quot;Please specify an App-V Publishing Server address.&quot;), [Parameter(Mandatory=$true, Position=2,HelpMessage=&quot;App-V publishing configuration description.&quot;)] [string]$Description = $(throw = &quot;Specify a description to apply to the App-V publishing information. Specify &#39;Created by Studio&#39; to set the App-V publishing inforamtion viewed in Citrix Studio.&quot;) ) Function Add-AppvConfig { # Add the AppV Server settings to the new specified settings Write-Verbose &quot;Setting App-V Management Server to specified URI.&quot; #http://support.citrix.com/proddocs/topic/citrix-appv-admin-v1-xd71/new-ctxappvserver-xd71.html $newAppvConfig = New-CtxAppVServer -ManagementServer $AppvMgmtSvr -PublishingServer $AppvPubSvr # Applying configuration to the site Write-Verbose &quot;Saving configuration to the site.&quot; #http://support.citrix.com/proddocs/topic/citrix-broker-admin-v2-xd75/new-brokermachineconfiguration-xd75.html $machineConfig = New-BrokerMachineConfiguration -AdminAddress $AdminAddress -ConfigurationSlotUid 3 -LeafName 1 -Description &quot;Created by Studio&quot; -Policy $newAppvConfig -Verbose } # Obtain FQDN from Management server URL $urlGroups = [regex]::Match($AppvMgmtSvr, &#39;^(?&lt;protocol&gt;(http|https))://(?&lt;fqdn&gt;([^:]*))((:(?&lt;port&gt;\d+))?)&#39;).Groups # Test specified Management Server. Write-Verbose &quot;Testing Management Server.&quot; If (Test-CtxAppVServer -AppVManagementServer $urlGroups[&quot;fqdn&quot;].Value -ErrorAction SilentlyContinue -ErrorVariable $manError) { Write-Verbose &quot;Management Server tested OK.&quot; # Test specified Publishing Server Write-Verbose &quot;Testing Publishing Server.&quot; If (Test-CtxAppVServer -AppVPublishingServer $AppvPubSvr -ErrorAction SilentlyContinue -ErrorVariable $pubError) { Write-Verbose &quot;Publishing Server tested OK.&quot; # Get any existing AppV configuration from the broker #http://support.citrix.com/proddocs/topic/citrix-broker-admin-v2-xd71/get-brokermachineconfiguration-xd71.html If ($Config) { Remove-Variable Config } $Config = Get-BrokerMachineConfiguration -AdminAddress $AdminAddress -Name AppV* -ErrorAction SilentlyContinue $cfgMatch = $False If ($Config) { ForEach ($cfg in $Config) { # Grab the AppV configuration details #http://support.citrix.com/proddocs/topic/citrix-appv-admin-v1-xd71/get-ctxappvserver-xd71.html $appvConfig = Get-CtxAppVServer -ByteArray $cfg.Policy # If the existing Management Server matches the specified Management Server If (($appvConfig.ManagementServer -eq $AppvMgmtSvr) -and ($appvConfig.PublishingServer -eq $AppvPubSvr)) { Write-Verbose &quot;Specified config matches existing config.&quot; $cfgMatch = $True } } If (!($cfgMatch)) { # Add config Add-AppvConfig } Else { Write-Verbose &quot;App-V configuration already exists.&quot; } } Else { # Add config Add-AppvConfig } } Else { Write-Error &quot;[Aborting] App-V Publishing Server test failed with: $pubError&quot; } } Else { Write-Error &quot;[Aborting] App-V Management Server test failed with: $manError&quot; } } Please ensure that you test thoroughly before using in a production environment. Comments or feedback on bugs, better ways to do things or additional steps is welcome. Note - a very big thanks to David Wagner at Citrix (and team) for assisting with working out how to write the App-V publishing information that you see in the Studio UI. This is done by applying the description “Created with Studio” to the publishing configuration (presumably only the first configuration that you apply with that description)." />
<meta property="og:description" content="Adding Microsoft App-V publishing information to a XenDesktop or XenApp 7.x site is very easy via the Citrix Studio UI, but what if you want to automate this process? Of course, you’ll need to reach for PowerShell. What may not be widely known is that you can add additional App-V publishing configuration to a XenDesktop site beyond what you see in the UI. This allows you to set publishing information per delivery group. Useful for complex XenDesktop sites such as multi-tenant environments. Creating the App-V publishing information with PowerShell is a multi step process. You’ll need to create the publishing information with New-CtxAppVServer and then apply the configuration with New-BrokerMachineConfiguration. Applying this in practice however may ultimately require testing the App-V management and publishing servers and ensuring that the configuration does not already exist before adding it. So to do that, I’ve written a function that will take the App-V Management and Publishing servers as parameters, ensure that they test OK and check that the configuration does not already exist before importing the configuration into the site. This function is fairly basic and while it does do some error checking, it could probably go a little further to ensure the configuration is applied successfully. Function Set-CtxAppvConfig { &lt;# .SYNOPSIS Sets new App-V publishing information in a XenDesktop site. .DESCRIPTION This function can be used to set or add App-V publishing information in a XenDesktop or XenApp 7.x site. .PARAMETER AdminAddress Specifies a remote XenDesktop controller to apply the configuration against. If omitted, the local host will be used instead. .PARAMETER AppvMgmtSvr Specifies a remote XenDesktop controller to apply the configuration against. If omitted, the local host will be used instead. .PARAMETER AppvPubSvr Specifies a remote XenDesktop controller to apply the configuration against. If omitted, the local host will be used instead. .PARAMETER Description Specifies a remote XenDesktop controller to apply the configuration against. If omitted, the local host will be used instead. .EXAMPLE Set-CtxAppvConfig -AdminAddress &#39;xd71.home.stealthpuppy.com&#39; -AppvMgmtSvr &#39;http://appv1:8080&#39; -AppvPubSvr &#39;http://appv1:80&#39; -Description &#39;Created by PowerShell&#39; .NOTES .LINK Adding App-V Publishing Information to a XenDesktop Site with PowerShell #&gt; param( [Parameter(Mandatory=$false, Position=0,HelpMessage=&quot;XenDesktop Controller address.&quot;)] [string]$AdminAddress = &#39;localhost&#39;, [Parameter(Mandatory=$true, Position=1,HelpMessage=&quot;Microsoft App-V Management Server address.&quot;)] [string]$AppvMgmtSvr = $(throw = &quot;Please specify an App-V Management Server address.&quot;), [Parameter(Mandatory=$true, Position=2,HelpMessage=&quot;Microsoft App-V Publishing Server address.&quot;)] [string]$AppvPubSvr = $(throw = &quot;Please specify an App-V Publishing Server address.&quot;), [Parameter(Mandatory=$true, Position=2,HelpMessage=&quot;App-V publishing configuration description.&quot;)] [string]$Description = $(throw = &quot;Specify a description to apply to the App-V publishing information. Specify &#39;Created by Studio&#39; to set the App-V publishing inforamtion viewed in Citrix Studio.&quot;) ) Function Add-AppvConfig { # Add the AppV Server settings to the new specified settings Write-Verbose &quot;Setting App-V Management Server to specified URI.&quot; #http://support.citrix.com/proddocs/topic/citrix-appv-admin-v1-xd71/new-ctxappvserver-xd71.html $newAppvConfig = New-CtxAppVServer -ManagementServer $AppvMgmtSvr -PublishingServer $AppvPubSvr # Applying configuration to the site Write-Verbose &quot;Saving configuration to the site.&quot; #http://support.citrix.com/proddocs/topic/citrix-broker-admin-v2-xd75/new-brokermachineconfiguration-xd75.html $machineConfig = New-BrokerMachineConfiguration -AdminAddress $AdminAddress -ConfigurationSlotUid 3 -LeafName 1 -Description &quot;Created by Studio&quot; -Policy $newAppvConfig -Verbose } # Obtain FQDN from Management server URL $urlGroups = [regex]::Match($AppvMgmtSvr, &#39;^(?&lt;protocol&gt;(http|https))://(?&lt;fqdn&gt;([^:]*))((:(?&lt;port&gt;\d+))?)&#39;).Groups # Test specified Management Server. Write-Verbose &quot;Testing Management Server.&quot; If (Test-CtxAppVServer -AppVManagementServer $urlGroups[&quot;fqdn&quot;].Value -ErrorAction SilentlyContinue -ErrorVariable $manError) { Write-Verbose &quot;Management Server tested OK.&quot; # Test specified Publishing Server Write-Verbose &quot;Testing Publishing Server.&quot; If (Test-CtxAppVServer -AppVPublishingServer $AppvPubSvr -ErrorAction SilentlyContinue -ErrorVariable $pubError) { Write-Verbose &quot;Publishing Server tested OK.&quot; # Get any existing AppV configuration from the broker #http://support.citrix.com/proddocs/topic/citrix-broker-admin-v2-xd71/get-brokermachineconfiguration-xd71.html If ($Config) { Remove-Variable Config } $Config = Get-BrokerMachineConfiguration -AdminAddress $AdminAddress -Name AppV* -ErrorAction SilentlyContinue $cfgMatch = $False If ($Config) { ForEach ($cfg in $Config) { # Grab the AppV configuration details #http://support.citrix.com/proddocs/topic/citrix-appv-admin-v1-xd71/get-ctxappvserver-xd71.html $appvConfig = Get-CtxAppVServer -ByteArray $cfg.Policy # If the existing Management Server matches the specified Management Server If (($appvConfig.ManagementServer -eq $AppvMgmtSvr) -and ($appvConfig.PublishingServer -eq $AppvPubSvr)) { Write-Verbose &quot;Specified config matches existing config.&quot; $cfgMatch = $True } } If (!($cfgMatch)) { # Add config Add-AppvConfig } Else { Write-Verbose &quot;App-V configuration already exists.&quot; } } Else { # Add config Add-AppvConfig } } Else { Write-Error &quot;[Aborting] App-V Publishing Server test failed with: $pubError&quot; } } Else { Write-Error &quot;[Aborting] App-V Management Server test failed with: $manError&quot; } } Please ensure that you test thoroughly before using in a production environment. Comments or feedback on bugs, better ways to do things or additional steps is welcome. Note - a very big thanks to David Wagner at Citrix (and team) for assisting with working out how to write the App-V publishing information that you see in the Studio UI. This is done by applying the description “Created with Studio” to the publishing configuration (presumably only the first configuration that you apply with that description)." />
<link rel="canonical" href="/appv-publishing-xendesktop-powershell/" />
<meta property="og:url" content="/appv-publishing-xendesktop-powershell/" />
<meta property="og:site_name" content="stealthpuppy" />
<meta property="og:image" content="/media/2014/10/AppV-XenDesktop-624x369.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-10-23T23:49:04+11:00" />
<script type="application/ld+json">
{"description":"Adding Microsoft App-V publishing information to a XenDesktop or XenApp 7.x site is very easy via the Citrix Studio UI, but what if you want to automate this process? Of course, you’ll need to reach for PowerShell. What may not be widely known is that you can add additional App-V publishing configuration to a XenDesktop site beyond what you see in the UI. This allows you to set publishing information per delivery group. Useful for complex XenDesktop sites such as multi-tenant environments. Creating the App-V publishing information with PowerShell is a multi step process. You’ll need to create the publishing information with New-CtxAppVServer and then apply the configuration with New-BrokerMachineConfiguration. Applying this in practice however may ultimately require testing the App-V management and publishing servers and ensuring that the configuration does not already exist before adding it. So to do that, I’ve written a function that will take the App-V Management and Publishing servers as parameters, ensure that they test OK and check that the configuration does not already exist before importing the configuration into the site. This function is fairly basic and while it does do some error checking, it could probably go a little further to ensure the configuration is applied successfully. Function Set-CtxAppvConfig { &lt;# .SYNOPSIS Sets new App-V publishing information in a XenDesktop site. .DESCRIPTION This function can be used to set or add App-V publishing information in a XenDesktop or XenApp 7.x site. .PARAMETER AdminAddress Specifies a remote XenDesktop controller to apply the configuration against. If omitted, the local host will be used instead. .PARAMETER AppvMgmtSvr Specifies a remote XenDesktop controller to apply the configuration against. If omitted, the local host will be used instead. .PARAMETER AppvPubSvr Specifies a remote XenDesktop controller to apply the configuration against. If omitted, the local host will be used instead. .PARAMETER Description Specifies a remote XenDesktop controller to apply the configuration against. If omitted, the local host will be used instead. .EXAMPLE Set-CtxAppvConfig -AdminAddress &#39;xd71.home.stealthpuppy.com&#39; -AppvMgmtSvr &#39;http://appv1:8080&#39; -AppvPubSvr &#39;http://appv1:80&#39; -Description &#39;Created by PowerShell&#39; .NOTES .LINK Adding App-V Publishing Information to a XenDesktop Site with PowerShell #&gt; param( [Parameter(Mandatory=$false, Position=0,HelpMessage=&quot;XenDesktop Controller address.&quot;)] [string]$AdminAddress = &#39;localhost&#39;, [Parameter(Mandatory=$true, Position=1,HelpMessage=&quot;Microsoft App-V Management Server address.&quot;)] [string]$AppvMgmtSvr = $(throw = &quot;Please specify an App-V Management Server address.&quot;), [Parameter(Mandatory=$true, Position=2,HelpMessage=&quot;Microsoft App-V Publishing Server address.&quot;)] [string]$AppvPubSvr = $(throw = &quot;Please specify an App-V Publishing Server address.&quot;), [Parameter(Mandatory=$true, Position=2,HelpMessage=&quot;App-V publishing configuration description.&quot;)] [string]$Description = $(throw = &quot;Specify a description to apply to the App-V publishing information. Specify &#39;Created by Studio&#39; to set the App-V publishing inforamtion viewed in Citrix Studio.&quot;) ) Function Add-AppvConfig { # Add the AppV Server settings to the new specified settings Write-Verbose &quot;Setting App-V Management Server to specified URI.&quot; #http://support.citrix.com/proddocs/topic/citrix-appv-admin-v1-xd71/new-ctxappvserver-xd71.html $newAppvConfig = New-CtxAppVServer -ManagementServer $AppvMgmtSvr -PublishingServer $AppvPubSvr # Applying configuration to the site Write-Verbose &quot;Saving configuration to the site.&quot; #http://support.citrix.com/proddocs/topic/citrix-broker-admin-v2-xd75/new-brokermachineconfiguration-xd75.html $machineConfig = New-BrokerMachineConfiguration -AdminAddress $AdminAddress -ConfigurationSlotUid 3 -LeafName 1 -Description &quot;Created by Studio&quot; -Policy $newAppvConfig -Verbose } # Obtain FQDN from Management server URL $urlGroups = [regex]::Match($AppvMgmtSvr, &#39;^(?&lt;protocol&gt;(http|https))://(?&lt;fqdn&gt;([^:]*))((:(?&lt;port&gt;\\d+))?)&#39;).Groups # Test specified Management Server. Write-Verbose &quot;Testing Management Server.&quot; If (Test-CtxAppVServer -AppVManagementServer $urlGroups[&quot;fqdn&quot;].Value -ErrorAction SilentlyContinue -ErrorVariable $manError) { Write-Verbose &quot;Management Server tested OK.&quot; # Test specified Publishing Server Write-Verbose &quot;Testing Publishing Server.&quot; If (Test-CtxAppVServer -AppVPublishingServer $AppvPubSvr -ErrorAction SilentlyContinue -ErrorVariable $pubError) { Write-Verbose &quot;Publishing Server tested OK.&quot; # Get any existing AppV configuration from the broker #http://support.citrix.com/proddocs/topic/citrix-broker-admin-v2-xd71/get-brokermachineconfiguration-xd71.html If ($Config) { Remove-Variable Config } $Config = Get-BrokerMachineConfiguration -AdminAddress $AdminAddress -Name AppV* -ErrorAction SilentlyContinue $cfgMatch = $False If ($Config) { ForEach ($cfg in $Config) { # Grab the AppV configuration details #http://support.citrix.com/proddocs/topic/citrix-appv-admin-v1-xd71/get-ctxappvserver-xd71.html $appvConfig = Get-CtxAppVServer -ByteArray $cfg.Policy # If the existing Management Server matches the specified Management Server If (($appvConfig.ManagementServer -eq $AppvMgmtSvr) -and ($appvConfig.PublishingServer -eq $AppvPubSvr)) { Write-Verbose &quot;Specified config matches existing config.&quot; $cfgMatch = $True } } If (!($cfgMatch)) { # Add config Add-AppvConfig } Else { Write-Verbose &quot;App-V configuration already exists.&quot; } } Else { # Add config Add-AppvConfig } } Else { Write-Error &quot;[Aborting] App-V Publishing Server test failed with: $pubError&quot; } } Else { Write-Error &quot;[Aborting] App-V Management Server test failed with: $manError&quot; } } Please ensure that you test thoroughly before using in a production environment. Comments or feedback on bugs, better ways to do things or additional steps is welcome. Note - a very big thanks to David Wagner at Citrix (and team) for assisting with working out how to write the App-V publishing information that you see in the Studio UI. This is done by applying the description “Created with Studio” to the publishing configuration (presumably only the first configuration that you apply with that description).","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/appv-publishing-xendesktop-powershell/","image":"/media/2014/10/AppV-XenDesktop-624x369.png","headline":"Adding App-V Publishing Information to a XenDesktop Site with PowerShell","dateModified":"2014-10-23T23:49:04+11:00","datePublished":"2014-10-23T23:49:04+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"/appv-publishing-xendesktop-powershell/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="stealthpuppy" /></head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">stealthpuppy</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">ABOUT</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Adding App-V Publishing Information to a XenDesktop Site with PowerShell</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2014-10-23T23:49:04+11:00" itemprop="datePublished">Oct 23, 2014
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card"
          itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Adding <a href="http://support.citrix.com/proddocs/topic/xenapp-xendesktop-76/xad-app-v.html">Microsoft App-V publishing information to a XenDesktop or XenApp 7.x site</a> is very easy via the Citrix Studio UI, but what if you want to automate this process? Of course, you’ll need to reach for PowerShell.</p>

<p>What may not be widely known is that you can add additional App-V publishing configuration to a XenDesktop site beyond what you see in the UI. This allows you to set publishing information per delivery group. Useful for complex XenDesktop sites such as multi-tenant environments.</p>

<p>Creating the App-V publishing information with PowerShell is a multi step process. You’ll need to create the publishing information with <a href="http://support.citrix.com/proddocs/topic/citrix-appv-admin-v1-xd75/new-ctxappvserver-xd75.html">New-CtxAppVServer</a> and then apply the configuration with <a href="http://support.citrix.com/proddocs/topic/citrix-broker-admin-v2-xd75/new-brokermachineconfiguration-xd75.html">New-BrokerMachineConfiguration</a>.</p>

<p>Applying this in practice however may ultimately require testing the App-V management and publishing servers and ensuring that the configuration does not already exist before adding it.</p>

<p>So to do that, I’ve written a function that will take the App-V Management and Publishing servers as parameters, ensure that they test OK and check that the configuration does not already exist before importing the configuration into the site.</p>

<p>This function is fairly basic and while it does do some error checking, it could probably go a little further to ensure the configuration is applied successfully.</p>

<pre class="lang:ps decode:true" title="Add App-V Publishing information to a XenDesktop site">Function Set-CtxAppvConfig {
    &lt;#
        .SYNOPSIS
            Sets new App-V publishing information in a XenDesktop site.
 
        .DESCRIPTION
            This function can be used to set or add App-V publishing information in a XenDesktop or XenApp 7.x site.
 
        .PARAMETER AdminAddress
            Specifies a remote XenDesktop controller to apply the configuration against. If omitted, the local host will be used instead.
 
        .PARAMETER AppvMgmtSvr
            Specifies a remote XenDesktop controller to apply the configuration against. If omitted, the local host will be used instead.
 
        .PARAMETER AppvPubSvr
            Specifies a remote XenDesktop controller to apply the configuration against. If omitted, the local host will be used instead.
 
        .PARAMETER Description
            Specifies a remote XenDesktop controller to apply the configuration against. If omitted, the local host will be used instead.
 
        .EXAMPLE
            Set-CtxAppvConfig -AdminAddress 'xd71.home.stealthpuppy.com' -AppvMgmtSvr 'http://appv1:8080' -AppvPubSvr 'http://appv1:80' -Description 'Created by PowerShell'
 
        .NOTES
 
        .LINK
            

<blockquote class="wp-embedded-content" data-secret="G83Mrh3a9x">
  <a href="https://stealthpuppy.com/appv-publishing-xendesktop-powershell/">Adding App-V Publishing Information to a XenDesktop Site with PowerShell</a>
</blockquote>
 
    #&gt;
    param(
        [Parameter(Mandatory=$false, Position=0,HelpMessage="XenDesktop Controller address.")]
        [string]$AdminAddress = 'localhost',

        [Parameter(Mandatory=$true, Position=1,HelpMessage="Microsoft App-V Management Server address.")]
        [string]$AppvMgmtSvr = $(throw = "Please specify an App-V Management Server address."),

        [Parameter(Mandatory=$true, Position=2,HelpMessage="Microsoft App-V Publishing Server address.")]
        [string]$AppvPubSvr = $(throw = "Please specify an App-V Publishing Server address."),

        [Parameter(Mandatory=$true, Position=2,HelpMessage="App-V publishing configuration description.")]
        [string]$Description = $(throw = "Specify a description to apply to the App-V publishing information. Specify 'Created by Studio' to set the App-V publishing inforamtion viewed in Citrix Studio.")
    )

    Function Add-AppvConfig {
        # Add the AppV Server settings to the new specified settings
        Write-Verbose "Setting App-V Management Server to specified URI."
        #http://support.citrix.com/proddocs/topic/citrix-appv-admin-v1-xd71/new-ctxappvserver-xd71.html
        $newAppvConfig = New-CtxAppVServer -ManagementServer $AppvMgmtSvr -PublishingServer $AppvPubSvr

        # Applying configuration to the site
        Write-Verbose "Saving configuration to the site."
        #http://support.citrix.com/proddocs/topic/citrix-broker-admin-v2-xd75/new-brokermachineconfiguration-xd75.html
        $machineConfig = New-BrokerMachineConfiguration -AdminAddress $AdminAddress -ConfigurationSlotUid 3 -LeafName 1 -Description "Created by Studio" -Policy $newAppvConfig -Verbose
    }

    # Obtain FQDN from Management server URL
    $urlGroups = [regex]::Match($AppvMgmtSvr, '^(?&lt;protocol&gt;(http|https))://(?&lt;fqdn&gt;([^:]*))((:(?&lt;port&gt;\d+))?)').Groups

    # Test specified Management Server.
    Write-Verbose "Testing Management Server."
    If (Test-CtxAppVServer -AppVManagementServer $urlGroups["fqdn"].Value -ErrorAction SilentlyContinue -ErrorVariable $manError) {
        Write-Verbose "Management Server tested OK."

        # Test specified Publishing Server
        Write-Verbose "Testing Publishing Server."
        If (Test-CtxAppVServer -AppVPublishingServer $AppvPubSvr -ErrorAction SilentlyContinue -ErrorVariable $pubError) {
            Write-Verbose "Publishing Server tested OK."
        
            # Get any existing AppV configuration from the broker
            #http://support.citrix.com/proddocs/topic/citrix-broker-admin-v2-xd71/get-brokermachineconfiguration-xd71.html
            If ($Config) { Remove-Variable Config }
            $Config = Get-BrokerMachineConfiguration -AdminAddress $AdminAddress -Name AppV* -ErrorAction SilentlyContinue

            $cfgMatch = $False
            If ($Config) {

                ForEach ($cfg in $Config) {

                    # Grab the AppV configuration details
                    #http://support.citrix.com/proddocs/topic/citrix-appv-admin-v1-xd71/get-ctxappvserver-xd71.html
                    $appvConfig = Get-CtxAppVServer -ByteArray $cfg.Policy

                    # If the existing Management Server matches the specified Management Server
                    If (($appvConfig.ManagementServer -eq $AppvMgmtSvr) -and ($appvConfig.PublishingServer -eq $AppvPubSvr)) {
                    
                        Write-Verbose "Specified config matches existing config."
                        $cfgMatch = $True
                    }
                }

                If (!($cfgMatch)) {

                    # Add config
                    Add-AppvConfig
                } Else {

                    Write-Verbose "App-V configuration already exists."
                }
            } Else {

               # Add config
               Add-AppvConfig 
            }
        } Else {

            Write-Error "[Aborting] App-V Publishing Server test failed with: $pubError"
        }
    } Else {

        Write-Error "[Aborting] App-V Management Server test failed with: $manError"
    }

}</pre>

<p>Please ensure that you test thoroughly before using in a production environment. Comments or feedback on bugs, better ways to do things or additional steps is welcome.</p>

<p>Note - a very big thanks to David Wagner at Citrix (and team) for assisting with working out how to write the App-V publishing information that you see in the Studio UI. This is done by applying the description “Created with Studio” to the publishing configuration (presumably only the first configuration that you apply with that description).</p>

  </div><a class="u-url" href="/appv-publishing-xendesktop-powershell/" hidden></a>
</article>
      </div>
    </main>

    <footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col one-half">
      <h2 class="footer-heading">stealthpuppy</h2>
        <ul class="contact-list">
          <li class="p-name">stealthpuppy</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col one-half">
        <p>on end user computing and enterprise mobility</p>
      </div>

      <div class="social-links"><ul class="social-media-list"><li><a href="https://github.com/aaronparker" title="aaronparker"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a href="https://www.linkedin.com/in/aaronedwardparker" title="aaronedwardparker"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a href="https://twitter.com/stealthpuppy" title="stealthpuppy"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li><li><a href="/feed.xml" title="atom"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg></a></li></ul>
</div>
    </div>

  </div>

</footer>
</body>

</html>
