<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Creating App-V 5.0 Connection Groups with PowerShell | stealthpuppy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Creating App-V 5.0 Connection Groups with PowerShell" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Connection Groups (or Dynamic Suite Composition v2) in App-V 5.0 are great for enabling separate App-V packages to talk to each other. Connection Groups are easy enough to deploy with the App-V Management Server or Configuration Manager 2012; however that isn’t the case for stand-alone scenarios or 3rd party ESDs." />
<meta property="og:description" content="Connection Groups (or Dynamic Suite Composition v2) in App-V 5.0 are great for enabling separate App-V packages to talk to each other. Connection Groups are easy enough to deploy with the App-V Management Server or Configuration Manager 2012; however that isn’t the case for stand-alone scenarios or 3rd party ESDs." />
<link rel="canonical" href="/creating-app-v-5-0-connection-groups-with-powershell/" />
<meta property="og:url" content="/creating-app-v-5-0-connection-groups-with-powershell/" />
<meta property="og:site_name" content="stealthpuppy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2013-01-07T01:30:54+11:00" />
<script type="application/ld+json">
{"description":"Connection Groups (or Dynamic Suite Composition v2) in App-V 5.0 are great for enabling separate App-V packages to talk to each other. Connection Groups are easy enough to deploy with the App-V Management Server or Configuration Manager 2012; however that isn’t the case for stand-alone scenarios or 3rd party ESDs.","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/creating-app-v-5-0-connection-groups-with-powershell/","headline":"Creating App-V 5.0 Connection Groups with PowerShell","dateModified":"2013-01-07T01:30:54+11:00","datePublished":"2013-01-07T01:30:54+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"/creating-app-v-5-0-connection-groups-with-powershell/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="stealthpuppy" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">stealthpuppy</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">ABOUT</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Creating App-V 5.0 Connection Groups with PowerShell</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2013-01-07T01:30:54+11:00" itemprop="datePublished">Jan 7, 2013
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><a href="http://technet.microsoft.com/en-us/library/jj737969.aspx">Connection Groups</a> (or Dynamic Suite Composition v2) in App-V 5.0 are great for enabling separate App-V packages to talk to each other. Connection Groups are easy enough to <a href="http://technet.microsoft.com/en-us/library/jj713462.aspx">deploy with the App-V Management Server</a> or <a href="http://technet.microsoft.com/en-us/library/jj591609.aspx">Configuration Manager 2012</a>; however that isn’t the case for <a href="http://www.applepie.se/app-v-5-standalone-and-connection-groups">stand-alone scenarios</a> or 3rd party ESDs.</p>

<p>Adding a Connection Group to the client, first requires creating a definition file in XML. Without the App-V Management Server or ConfigMgr (where <a href="http://technet.microsoft.com/en-us/library/jj870811.aspx">the resulting file ends up on the client</a>), you’ll need to do that manually. Crafting XML files from scratch using Notepad isn’t my idea of fun.</p>

<h1 id="whats-in-a-definition-file">What’s in a Definition File?</h1>

<p>A <a href="http://blogs.technet.com/b/appv/archive/2012/11/06/deploying-connection-groups-app-v-5-0.aspx">Connection Group definition file</a> contains the details about the Connection Group and the member packages. Each Connection Group has it’s own group and version ID (GUIDs).</p>

<p>A typical definition file will look something like this:</p>

<p>[code language=”xml”]<?xml version="1.0" encoding="UTF-8"?></p>
<appv:AppConnectionGroup xmlns="http://schemas.microsoft.com/appv/2010/virtualapplicationconnectiongroup" xmlns:appv="http://schemas.microsoft.com/appv/2010/virtualapplicationconnectiongroup" AppConnectionGroupId="715f39d8-1b48-4b9a-95e6-d33370564b33" VersionId="9cdf46f3-6716-43d3-b533-5c697878f51f" Priority="2" DisplayName="Adobe Apps">  
<appv:Packages>  
<appv:Package DisplayName="Adobe Reader X" PackageId="abf1cd38-03cf-42af-8b27-564c4b9fcd1e" VersionId="818bc4eb-50f2-4fd4-90e4-9c8ed097e1e9" />  
<appv:Package DisplayName="Adobe Flash Player 11" PackageId="6a22f839-2d22-46dc-9c63-2649e370fce2" VersionId="792c8000-509c-4b1a-b4d7-58be65436d1a" />  
</appv:Packages>  
</appv:AppConnectionGroup>
<p>[/code]</p>

<p>To create the file, we need to generate GUIDs for the group and version IDs, supply a Connection Group display name and priority, and then add the package and version IDs for each member package.</p>

<h1 id="enter-powershell">Enter PowerShell</h1>

<p>To simplify the process of creating the definition file for a Connection Group, I’ve written a PowerShell function that will handle the heavy lifting for you. <em>New-AppvConnectionGroupFile</em> will create the definition file from a list of App-V packages passed to it.</p>

<p>The function will output the definition file to a specified path and then return that file as an object that you can do further processing with.</p>

<p>[code language=”ps”]#—————————————————————————<br />
# Author: Aaron Parker<br />
# Desc: Function that uses the App-V 5.0 client to create Connection<br />
# Group description (XML) files for use with stand alone clients or<br />
# test scenarios<br />
# Date: Jan 06, 2013<br />
# Site: http://stealthpuppy.com<br />
#—————————————————————————</p>

<p>Function New-AppvConnectionGroupFile {<br />
&lt;#<br />
.SYNOPSIS<br />
Creates an App-V 5.0 Connection Group definition file.</p>

<p>.DESCRIPTION<br />
Creates an XML-based Connection Group definition file from packages added to the current system.</p>

<p>Packages can be filtered before being passed to the function to control which packages are included in the Connection Group.</p>

<p>.PARAMETER DisplayName<br />
Specifies the display name of the Connection Group.</p>

<p>.PARAMETER Priority<br />
Specifies the priority of the Connection Group.</p>

<p>.PARAMETER Path<br />
Specifies the App-V connection group definition file to output.</p>

<p>.PARAMETER Packages<br />
The packages to include in the Connection Group.</p>

<p>.EXAMPLE<br />
PS C:&gt; New-AppvConnectionGroupFile -DisplayName “Internet Explorer Plugins” -Priority 0 -FilePath InternetExplorerPlugins.xml -Packages $Packages</p>

<p>Creates a Connection Group file named ‘InternetExplorerPlugins.xml’ with a display name of ‘Internet Explorer Plugins’ from packages contained within the array $Packages.</p>

<p>.EXAMPLE<br />
PS C:&gt; Get-AppvClientPackage -Name Adobe* | New-AppvConnectionGroupFile -DisplayName “Adobe Apps” -Priority 10 -FilePath AdobeApps.xml</p>

<p>Creates a Connection Group file named ‘AdobeApps.xml’ with a display name of ‘Adobe Apps’ from packages passed via the pipeline from Get-AppvClientPackage.</p>

<p>.NOTES<br />
See https://stealthpuppy.com/ for support information.</p>

<p>.LINK<br />
https://stealthpuppy.com/code/creating-app-v-5-0-connection-groups-with-powershell/<br />
#&gt;</p>

<p>[CmdletBinding(SupportsShouldProcess=$True)]<br />
Param(<br />
[Parameter(Mandatory=$True, HelpMessage=”Connection Group descriptor XML file path”)]<br />
[string]$Path,<br />
[Parameter(Mandatory=$True, HelpMessage=”Display name of the Connection Group”)]<br />
[string]$DisplayName,<br />
[Parameter(Mandatory=$False, HelpMessage=”Connection Group priority”)]<br />
[int]$Priority,<br />
[Parameter(Mandatory=$True, ValueFromPipeline=$True, HelpMessage=”Packages to include in the Connection Group”)]<br />
[System.Array]$Packages<br />
)</p>

<p>BEGIN {</p>

<p># Template XML for an App-V Connection Group description file. Easier than building from an XML object<br />
$templateXML = @’<br />
<?xml version="1.0" encoding="UTF-8" ?></p>
<appv:AppConnectionGroup xmlns="http://schemas.microsoft.com/appv/2010/virtualapplicationconnectiongroup" xmlns:appv="http://schemas.microsoft.com/appv/2010/virtualapplicationconnectiongroup" AppConnectionGroupId="GUID" VersionId="GUID" Priority="0" DisplayName="Display Name">  
<appv:Packages>  
<appv:Package DisplayName="Package1" PackageId="GUID" VersionId="GUID" />  
</appv:Packages>  
</appv:AppConnectionGroup>
<p>’@</p>

<p># Write out the template XML to a file in the current directory<br />
$templateXMLFile = $pwd.Path + “\ConnectionGroupTemplate.XML”<br />
$templateXML | Out-File -FilePath $templateXMLFile -Encoding utf8 -Force</p>

<p># Create a new XML object and read the template XML file into this object<br />
$xml = New-Object XML<br />
If ((Test-Path $templateXMLFile) -eq $True ) { $xml.Load($templateXMLFile) } Else { Write-Warning -Message “Unable to read template XML file.” }</p>

<p># Apply the display name and GUIDs to the XML object<br />
$xml.AppConnectionGroup.DisplayName = $DisplayName<br />
$xml.AppConnectionGroup.AppConnectionGroupId = ([guid]::NewGuid()).ToString()<br />
$xml.AppConnectionGroup.VersionId = ([guid]::NewGuid()).ToString()<br />
$xml.AppConnectionGroup.Priority = $Priority.ToString()</p>

<p># Clone the existing package entry to use for new entries<br />
$newPackage = (@($xml.AppConnectionGroup.Packages.Package)[0]).Clone()<br />
}</p>

<p># Process each supplied App-V package into the XML object<br />
PROCESS {<br />
ForEach ( $Package in $Packages ) {<br />
Write-Progress “Adding packages”</p>

<p>$newPackage = $newPackage.Clone()<br />
$newPackage.DisplayName = $Package.Name<br />
$newPackage.PackageId = ($Package.PackageId).ToString()<br />
$newPackage.VersionId = ($Package.VersionId).ToString()</p>

<p># Output appending the child XML entry to null to prevent displaying on screen<br />
$xml.AppConnectionGroup.Packages.AppendChild($newPackage) &gt; $null<br />
}<br />
}</p>

<p>END {</p>

<p># Remove the template package entry from the XML<br />
$xml.AppConnectionGroup.Packages.ChildNodes | Where-Object { $_.DisplayName -eq “Package1” } | ForEach-Object { [void]$xml.AppConnectionGroup.Packages.RemoveChild($_) }</p>

<p># Save the completed XML to disk<br />
$xml.Save($Path)</p>

<p># Delete the template XML file from disk<br />
If (Test-Path $templateXMLFile) { Remove-Item $templateXMLFile -Force -ErrorAction SilentlyContinue }</p>

<p># Return the new Connection Group description XML file so that it might be processed by other functions<br />
If (Test-Path $Path ) { Return Get-Item $Path } Else { Write-Warning “Failed to save Connection Group definition file.” }<br />
}<br />
}[/code]</p>

<p>Copy and paste the code above into a PowerShell window (or the ISE) to enable the function. You could also save code to <a href="http://msdn.microsoft.com/en-gb/library/windows/desktop/dd878324(v=vs.85).aspx">a PowerShell module</a> to make it more accessible.</p>

<h1 id="examples">Examples</h1>

<p>The function includes help and examples, so that you can view them from within PowerShell (the PowerShell ISE makes that simple). Use the Get-Help cmdlet to view details.</p>

<p>Using the function requires supplying a Display Name and Priority for the Connection Group as well as the list of App-V packages to include in the group. To supply the packages, first ensure they have been added to the local client, so that they can be queried with Get-AppvClientPackage.</p>

<p>In this example, I’ve added the list of packages to the variable $Packages and then supplied that to the New-AppvConnectionGroupFile function. This results in the definition file AdobeApps.xml with any Adobe package included in it.</p>

<p>[code language=”ps”]$Packages = Get-AppvClientPackage -Name Adobe*<br />
New-AppvConnectionGroupFile -Path C:\Packages\AdobeApps.xml -DisplayName “Adobe Apps” -Priority 2 -Packages $Packages[/code]</p>

<p>Taking this a step further, I can use a single line of PowerShell to query for a filtered list of packages on the local client, passing that to my function that will create the definition file. The Connection Group is then immediately added to the client and enabled.</p>

<table>
  <tbody>
    <tr>
      <td>[code language=”ps”]Get-AppvClientPackage -Name Adobe*</td>
      <td>New-AppvConnectionGroupFile -Path C:\Packages\AdobeApps.xml -DisplayName “Adobe Apps” -Priority 2</td>
      <td>Add-AppvClientConnectionGroup</td>
      <td>Enable-AppvClientConnectionGroup -Global[/code]</td>
    </tr>
  </tbody>
</table>

<h1 id="finally">Finally</h1>

<p>This is version 1 of this function, so corrections and feedback are welcome. As always use at your own risk.</p>

  </div><a class="u-url" href="/creating-app-v-5-0-connection-groups-with-powershell/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">stealthpuppy</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">stealthpuppy</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/aaronparker"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">aaronparker</span></a></li><li><a href="https://www.twitter.com/stealthpuppy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">stealthpuppy</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>on end user computing and enterprise mobility</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
