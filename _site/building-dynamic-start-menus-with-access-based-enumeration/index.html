<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Building Dynamic Start Menus With Access-Based Enumeration | stealthpuppy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Building Dynamic Start Menus With Access-Based Enumeration" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I hinted at creating dynamic Start Menus using Access-Based Enumeration (ABE) in Windows Server 2003 SP1 and above. I have read an article on this subject previously on the Internets, but the tubes must be clogged up as I can’t find it anymore. If anyone has a link please let me know, because I would like to link to it." />
<meta property="og:description" content="I hinted at creating dynamic Start Menus using Access-Based Enumeration (ABE) in Windows Server 2003 SP1 and above. I have read an article on this subject previously on the Internets, but the tubes must be clogged up as I can’t find it anymore. If anyone has a link please let me know, because I would like to link to it." />
<link rel="canonical" href="http://localhost:4000/building-dynamic-start-menus-with-access-based-enumeration/" />
<meta property="og:url" content="http://localhost:4000/building-dynamic-start-menus-with-access-based-enumeration/" />
<meta property="og:site_name" content="stealthpuppy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2008-04-06T22:27:24+10:00" />
<script type="application/ld+json">
{"description":"I hinted at creating dynamic Start Menus using Access-Based Enumeration (ABE) in Windows Server 2003 SP1 and above. I have read an article on this subject previously on the Internets, but the tubes must be clogged up as I can’t find it anymore. If anyone has a link please let me know, because I would like to link to it.","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"http://localhost:4000/building-dynamic-start-menus-with-access-based-enumeration/","headline":"Building Dynamic Start Menus With Access-Based Enumeration","dateModified":"2008-04-06T22:27:24+10:00","datePublished":"2008-04-06T22:27:24+10:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/building-dynamic-start-menus-with-access-based-enumeration/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="stealthpuppy" /><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="apple-mobile-web-app-title" content="stealthpuppy">
  <meta name="application-name" content="stealthpuppy">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="theme-color" content="#ffffff">
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">stealthpuppy</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">ABOUT</a><a class="page-link" href="/smb-not-cifs.html">SMB not CIFS</a><a class="page-link" href="https://docs.stealthpuppy.com/docs">PROJECTS</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Building Dynamic Start Menus With Access-Based Enumeration</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2008-04-06T22:27:24+10:00" itemprop="datePublished">Apr 6, 2008
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>I hinted at creating dynamic Start Menus using Access-Based Enumeration (ABE) in Windows Server 2003 SP1 and above. I have read an article on this subject previously on the Internets, but the tubes must be clogged up as I can’t find it anymore. If anyone has a link please let me know, because I would like to link to it.</p>

<p>So because I can’t find that article and <a href="/windows/access-based-enumeration-in-windows-server#comment-13330">Dylan asked how this is done</a>, here’s my own version:</p>

<p>In this example I’m configuring a Start Menu for a Windows 2003 Terminal Server. This is probably the most common scenario for managing Start Menus and ABE helps to create a dynamic Start Menu even though all users may be accessing the same menu items.</p>

<p>My test environment consists of a Windows Server 2008 domain controller/file server named <strong>DC</strong> and a Windows 2003 Terminal Server named <strong>TS</strong> in a domain named <em>dev.local</em> with a DFS Namespace named <em>Public</em>.</p>

<h2 id="create-a-share-to-host-the-start-menu">Create A Share To Host The Start Menu</h2>

<p>Access-based enumeration won’t work on local folders so you’ll need to redirect the Start Menu to a network folder. In my example configuration I’ve created a share named <em>StartMenus</em> which is located at <em>E:StartMenus</em> on <strong>DC</strong>. Once the folder is shared, enable ABE. See <a href="/windows/access-based-enumeration-in-windows-server">my previous article</a> on how to do this.</p>

<p>I’ve also set NTFS permissions on this folder so that Administrators and SYSTEM have Full Control and Authenticated Users have Read-only access. Ensure that the Administrators group has ownership on this and any sub-folders, otherwise, by default, folder redirection will not work.</p>

<h2 id="improving-the-share-configuration">Improving The Share Configuration</h2>

<p>If you are hosting the share on Windows Server 2003 R2 or Windows Server 2008, I recommend enabling a <a href="http://technet2.microsoft.com/windowsserver/en/library/0b7566a4-ace9-4872-9246-86d26573983a1033.mspx?mfr=true">File Screen</a> on this location so that only .LNK, .URL and .INI files can be copied to this location. This will help prevent files with potentially harmful content being copied to the Start Menu and executed (especially the Startup location). Allow .INI files because the Start Menu is populated with DESKTOP.INI files.</p>

<p>You should also add this share to a <a href="http://technet2.microsoft.com/windowsserver2008/en/library/1f0d326d-35af-4193-bda3-0d1688f90ea71033.mspx?mfr=true">DFS Namespace</a> so that if you need to move the Start Menus to another server, you won’t need to modify Group Policy. In my example environment my new network path is <em>\dev.localPublicStartMenus</em>. DFS can also provide high-availability for your Start Menus through <a href="http://technet2.microsoft.com/WindowsServer/en/Library/8c4cf2e7-0b92-4643-acbd-abfa9f189d031033.mspx?mfr=true">DFS Replication</a>.</p>

<p><img src="/media/2008/04/dfsnamespace.png" alt="" /></p>

<h2 id="create-the-start-menus">Create The Start Menu(s)</h2>

<p>Create a folder below your new share for each Start Menu you require. This method of creating Start Menus doesn’t account for the configuration of each Terminal Server. For example, you might have multiple Terminal Server silos, so you’ll need to create a Start Menu for each silo (if you’re publishing multiple desktops). My example environment has a Start Menu location at <em>\dev.localPublicStartMenusTerminalServer</em>.</p>

<p>Copy shortcuts from the local machine to the network share. You’ll need to copy from the user Start Menu as well as the common Start Menu to construct a menu with all of the required application shortcuts plus the usual suspects. After (or before) copying, clean up the shortcuts so that only the shortcuts you require are located there.</p>

<p><img src="/media/2008/04/startmenufolder.png" alt="" /></p>

<p>Create groups in your domain that you can use when setting permissions on your Start Menu. Most organisations will use a group to represent each application, but if you can go with role-based groups they will be mean less administrative overhead.</p>

<p>Set permissions on each shortcut folder or individual shortcuts as required. Once access-based enumeration is enabled users will see only the shortcuts they have read access to. Setting permissions on the shortcuts and folders is a great candidate for scripting or Group Policy. If you keep the permissions configuration in a script or use Group Policy to set permissions you can ensure those ACLs will stay consistent.</p>

<h2 id="redirect-the-start-menu">Redirect The Start Menu</h2>

<p>In my example I’m configuring a Start Menu for a Terminal Server environment, so I’m going to redirect the Start Menu via a loopback policy applied to my Terminal Servers OU. I also deny the Apply Group Policy right to Domain and Enterprise Admins (or other applicable administrator groups on this GPO so folder redirection does not apply to those users.</p>

<p><img src="/media/2008/04/loopbackpolicy.png" alt="" /></p>

<p>Create a GPO on the Terminal Servers OU and enable the loopback policy:</p>

<p><em>Computer Configuration / Administrative Templates / System / Group Policy / User Group Policy loopback processing mode</em></p>

<p>I generally set this to Merge because most settings are configured by GPOs on the user OUs. Also enable the setting to hide the common Start Menu. If you don’t enable this setting, users will see both the redirected and local Start Menus.</p>

<p><em>User Configuration / Administrative Templates / Start Menu and Taskbar / Remove common program groups from Start Menu</em></p>

<p>Now enable folder redirection to your network share and be sure to set the option ‘Redirect the folder back to the local userprofile location when policy is removed’. Here’s a copy of <a href="/media/2008/04/TerminalServerLoopbackPolicy.htm">the GPO report</a> to see exactly how I’ve configured it.</p>

<p><img src="/media/2008/04/startmenuredirection.png" alt="" /></p>

<p>Start Menu folder redirection in this manner allows you to stop customising the local Start Menu. This is something I see TS administrators do in numerous organisations. I find this practice to be un-necessary and increases the administrative overhead. Redirect the user Start Menu so that administrators have access to all of the locally installed shortcuts.</p>

<h2 id="lets-see-what-it-looks-like">Let’s See What It Looks Like</h2>

<p>Now that the configuration in complete your users should have a Start Menu customised for them. If they don’t you should check the Application log for any Group Policy errors.</p>

<p>What users should see on their Start Menus should be fairly predictable. My first user sees the following configuration:</p>

<p><img src="/media/2008/04/aaronstartmenu.png" alt="" /></p>

<p>And the second user sees a different Start Menu:</p>

<p><img src="/media/2008/04/zappstartmenu.png" alt="" /></p>

<h2 id="summary">Summary</h2>

<p>Using Access-Based Enumeration in Windows Server 2003 SP1 and above, we can create a Start Menu solution customised for each user. There are numerous ways to achieve this (perhaps even more flexible), but ABE gives us a no script, no 3rd party solution - nice and simple.</p>

<h3 id="more-resources">More Resources</h3>

<ul>
  <li><a href="http://blogs.technet.com/b/askds/archive/2011/01/25/using-abe-with-dfs.aspx">Using Access-Based Enumeration with DFS</a></li>
</ul>

  </div><a class="u-url" href="/building-dynamic-start-menus-with-access-based-enumeration/" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col one-half">
      <h2 class="footer-heading">stealthpuppy</h2>
        <ul class="contact-list">
          <li class="p-name">stealthpuppy</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col one-half">
        <p>on end user computing and enterprise mobility</p>
      </div>

      <div class="social-links"><ul class="social-media-list"><li><a href="https://github.com/aaronparker" title="aaronparker"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a href="https://www.linkedin.com/in/aaronedwardparker" title="aaronedwardparker"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a href="https://twitter.com/stealthpuppy" title="stealthpuppy"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li><li><a href="/feed.xml" title="atom"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg></a></li></ul>
</div>
    </div>

  </div>

</footer>
</body>

</html>
