<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Crash the ISA Server Firewall Service - Open All Inbound Ports | stealthpuppy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Crash the ISA Server Firewall Service - Open All Inbound Ports" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Here’s an easy way to crash the Microsoft Firewall service in ISA Server - create a server publishing rule that allows all high ports inbound to an internal NATed IP address." />
<meta property="og:description" content="Here’s an easy way to crash the Microsoft Firewall service in ISA Server - create a server publishing rule that allows all high ports inbound to an internal NATed IP address." />
<link rel="canonical" href="/crash-the-isa-server-firewall-service-open-all-inbound-ports/" />
<meta property="og:url" content="/crash-the-isa-server-firewall-service-open-all-inbound-ports/" />
<meta property="og:site_name" content="stealthpuppy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2007-03-14T16:00:00+11:00" />
<script type="application/ld+json">
{"description":"Here’s an easy way to crash the Microsoft Firewall service in ISA Server - create a server publishing rule that allows all high ports inbound to an internal NATed IP address.","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/crash-the-isa-server-firewall-service-open-all-inbound-ports/","headline":"Crash the ISA Server Firewall Service - Open All Inbound Ports","dateModified":"2007-03-14T16:00:00+11:00","datePublished":"2007-03-14T16:00:00+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"/crash-the-isa-server-firewall-service-open-all-inbound-ports/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="stealthpuppy" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">stealthpuppy</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">About</a><a class="page-link" href="/smb-not-cifs.html">SMB not CIFS</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Crash the ISA Server Firewall Service - Open All Inbound Ports</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2007-03-14T16:00:00+11:00" itemprop="datePublished">Mar 14, 2007
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Here’s an easy way to crash the Microsoft Firewall service in ISA Server - create a server publishing rule that allows all high ports inbound to an internal NATed IP address.</p>

<p>Now this is something that it is not normally done and I don’t think that ISA Server was designed to work this way. I was doing some specific testing yesterday and as a shortcut, rather than find out what ports I needed inbound (which ended up being UDP 28000 - 29000), I allowed UDP 1024 - 65535 inbound with some unexpected results. The Microsoft Firewall service crashed with the following event logged:</p>

<blockquote>
  <p>Event Type: Error<br />
Event Source: Microsoft ISA Server Control<br />
Event Category: None<br />
Event ID: 14079<br />
Date: 14/03/2007<br />
Time: 10:14:13 AM<br />
User: N/A<br />
Computer: CLAFW</p>

  <p>Description:<br />
Due to an unexpected error, the service fwsrv stopped responding to all requests. Stop the service or the corresponding process if it does not respond, and then start it again. Check for related error messages.</p>

  <p>For more information, see Help and Support Center at http://go.microsoft.com/fwlink/events.asp.</p>
</blockquote>

<p>The following alerts were logged in the ISA Server Management Console:</p>

<blockquote>
  <p><strong>Resource allocation failure</strong><br />
Description: A shortage of available memory caused the Microsoft Firewall to fail during initialization of reverse Network Address Translation (NAT). . Use the source location 325.1524.5.0.5720.100 to report the failure.</p>

  <p><strong>Resource allocation failure</strong><br />
Description: A shortage of available memory caused the Firewall service to fail. The ISA Server computer cannot support additional connections for the server. The Event Viewer Data window displays the number of active connections. The failure is due to error: The data area passed to a system call is too small.</p>

  <p><strong>Server Publishing Failure</strong><br />
Description: ISA Server failed to read one or more server publishing rules from the stored configuration because an internal error occurred. Error location 325.1524.5.0.5720.100. The stored configuration may be corrupted. The failure is due to error: Ran out of memory</p>
</blockquote>

<p>Deleting the rule and restarting the Microsoft Firewall service got the server up and running, but there’s something I won’t do again.</p>

  </div><a class="u-url" href="/crash-the-isa-server-firewall-service-open-all-inbound-ports/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">stealthpuppy</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">stealthpuppy</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/aaronparker"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">aaronparker</span></a></li><li><a href="https://www.twitter.com/stealthpuppy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">stealthpuppy</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>on end user computing and enterprise mobility
</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
