<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Unattended Presentation Server 4.5 | stealthpuppy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Unattended Presentation Server 4.5" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="While things haven’t changed much since Presentation Server 4.0, I’ve put together what you’ll need to create an unattended install for Presentation Server 4.5. First up I’ve made a copy of the installation files from the CD and added them to a single folder. This includes a copy of the administration tools in the same folder:" />
<meta property="og:description" content="While things haven’t changed much since Presentation Server 4.0, I’ve put together what you’ll need to create an unattended install for Presentation Server 4.5. First up I’ve made a copy of the installation files from the CD and added them to a single folder. This includes a copy of the administration tools in the same folder:" />
<link rel="canonical" href="/unattended-presentation-server-45/" />
<meta property="og:url" content="/unattended-presentation-server-45/" />
<meta property="og:site_name" content="stealthpuppy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2007-04-19T06:22:00+10:00" />
<script type="application/ld+json">
{"description":"While things haven’t changed much since Presentation Server 4.0, I’ve put together what you’ll need to create an unattended install for Presentation Server 4.5. First up I’ve made a copy of the installation files from the CD and added them to a single folder. This includes a copy of the administration tools in the same folder:","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/unattended-presentation-server-45/","headline":"Unattended Presentation Server 4.5","dateModified":"2007-04-19T06:22:00+10:00","datePublished":"2007-04-19T06:22:00+10:00","mainEntityOfPage":{"@type":"WebPage","@id":"/unattended-presentation-server-45/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="stealthpuppy" /></head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">stealthpuppy</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">ABOUT</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Unattended Presentation Server 4.5</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2007-04-19T06:22:00+10:00" itemprop="datePublished">Apr 19, 2007
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card"
          itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>While things haven’t changed much since Presentation Server 4.0, I’ve put together what you’ll need to create an unattended install for Presentation Server 4.5. First up I’ve made a copy of the installation files from the CD and added them to a single folder. This includes a copy of the administration tools in the same folder:</p>

<p><img src="https://stealthpuppy.com/media/2007/04/1000.14.1322.PresentationServer45.png" border="0" /></p>

<p><a href="http://www.stealthpuppy.com/photos/images/images/1322/original.aspx" target="_blank"></a></p>

<h3 id="prerequisites">Prerequisites</h3>

<p>Before you install Presentation Server you’ll need to install both the <a href="http://www.stealthpuppy.com/blogs/travelling/pages/unattended-install-sun-java-runtime-environment-1-6.aspx">Sun JRE</a> and <a href="http://www.stealthpuppy.com/blogs/travelling/pages/Unattended-Install_3A00_-Microsoft-.NET-Framework.aspx">.NET Framework 2.0</a>. Presentation Server 4.5 expects version 1.5.0_09 of the Sun JRE, but with a couple of registry changes you can use the latest JRE and fool the Presentation Server Console into thinking that 1.5.0_09 is installed. Here’s how to install the Sun JRE 1.6, configure it to be the JVM for Internet Explorer and disable some features that you don’t really want running on a Terminal Server:</p>

<p>[code]@ECHO OFF<br />
ECHO Sun J2SE Runtime Environment 6<br />
START /WAIT jre-6-windows-i586.exe /s ADDLOCAL=jrecore IEXPLORER=1 MOZILLA=1 JAVAUPDATE=0 REBOOT=Suppress /L %SYSTEMROOT%TEMPJRE6setup.log<br />
PUSHD “%ProgramFiles%Java” &amp; FOR /D %%d IN (*) DO SET JAVAVERSION=%%d &amp; POPD<br />
REM Remove the “jre” text from the variable<br />
FOR /F “tokens=2 delims=e “ %%i in (“%javaversion%”) DO SET JAVAVERSION=%%i<br />
REG ADD “HKLMSOFTWAREJavaSoftJava Plug-in%JAVAVERSION%” /v HideSystemTrayIcon /t REG_DWORD /d 0x00000001 /f<br />
REG ADD “HKLMSOFTWAREJavaSoftJava UpdatePolicy” /v EnableJavaUpdate /t REG_DWORD /d 0 /f<br />
REG ADD “HKLMSOFTWAREJavaSoftJava UpdatePolicy” /v EnableAutoUpdateCheck /t REG_DWORD /d 0 /f<br />
REG ADD “HKLMSOFTWAREJavaSoftJava UpdatePolicy” /v NotifyDownload /t REG_DWORD /d 0 /f<br />
REG ADD “HKLMSOFTWAREJavaSoftJava UpdatePolicy” /v NotifyInstall /t REG_DWORD /d 0 /f[/code]</p>

<p>Next up you’ll need to install .NET Framework 2.0 for the Access Management Console. You could install the .NET Framework 3.0, which includes version 2.0, if you prefer. Check out my <a href="http://www.stealthpuppy.com/blogs/travelling/pages/Unattended-Install_3A00_-Microsoft-.NET-Framework.aspx">unattended installs for all of the .NET Framework</a> versions for details. Here’s how to install version 2.0:</p>

<p>[code]@ECHO OFF<br />
ECHO .NET Framework 2.0<br />
START /WAIT 2.0DOTNETFX.EXE /Q:A /C:”INSTALL.EXE /Q”[/code]</p>

<h3 id="installing-presentation-server-45">Installing Presentation Server 4.5</h3>

<p>The first place to start for complete details on scripting Presentation Server is the <a href="http://support.citrix.com/article/CTX112223">Administrators Guide</a>. Appendix D, Advanced Installation Methods starting on page 365, details the options available to you for unattended installs including scripting the creation of the Presentation Server farm. Wilco van Bragt also has <a href="http://sbc.vanbragt.net/mambo/articles/how-to-install-citrix-presentation-server-unattended-part-1.html">an excellent article scripting the creation of the farm</a> which is worth a look. In this article though I’m focusing on what’s new for Presentation Server 4.5, so I won’t repeat what’s already there.</p>

<h3 id="configuring-the-sun-jre">Configuring the Sun JRE</h3>

<p>The Sun JRE is a commonly installed application for most environments and on Terminal Servers you may generally need one version to support the Presentation Server Console and a more recent version to support Internet Explorer. With a couple of registry changes, though, we can fool the Presentation Server Console into see the version 1.5.0_09 it’s expecting. The first line here returns all folders located in %ProgramFiles%Java and will return the latest version (e.g. jre1.6.0) because it will be returned last. It will then point version 1.5.0_09 to the folder containing the latest version:</p>

<p>[code]PUSHD “%ProgramFiles%Java” &amp; FOR /D %%d IN (*) DO SET JAVAVERSION=%%d &amp; POPD<br />
REM Remove the “jre” text from the variable<br />
FOR /F “tokens=2 delims=e “ %%i in (“%javaversion%”) DO SET JAVAVERSION=%%i<br />
REG ADD “HKLMSOFTWAREJavaSoftJava Runtime Environment1.5.0_09” /v JavaHome /d “%JAVAVERSION%” /t REG_SZ /f<br />
REG ADD “HKLMSOFTWAREJavaSoftJava Runtime Environment1.5.0_09” /v MicroVersion /d “2” /t REG_SZ /f<br />
REG ADD “HKLMSOFTWAREJavaSoftJava Runtime Environment1.5.0_09” /v RuntimeLib /d “%JAVAVERSION%binclientjvm.dll” /t REG_SZ /f[/code]</p>

<h3 id="installing-presentation-server">Installing Presentation Server</h3>

<p>Citrix provide <em>UnattendedInstall</em>.exe, <em>UnattendedTemplate</em>.txt and some sample transform files on the Presentation Server CD; however all of these just pass options to Windows Installer. I prefer to set the options out in a script so that it’s easier to see the options and modify them if required. The options I’ve listed here will install Presentation Server adding the server to the farm with a direct connection to the data store. You will need to create a DSN that points to your data store, whether this is hosted on SQL Server or Oracle. First up we build the options into a single environment variable, effectively adding them to a single line. Listed like this makes the script easier to read:</p>

<p>[code]SET OPTIONS=ALLUSERS=TRUE REBOOT=”ReallySuppress” /l*v “%SYSTEMROOT%tempCPS45.log” /QB<br />
SET OPTIONS=%OPTIONS% CTX_MF_FARM_SELECTION=”Join”<br />
SET OPTIONS=%OPTIONS% CTX_MF_JOIN_FARM_DB_CHOICE=”Direct”<br />
SET OPTIONS=%OPTIONS% CTX_MF_ZONE_NAME=””<br />
SET OPTIONS=%OPTIONS% CTX_MF_SILENT_DSNFILE=”MF20.DSN”<br />
SET OPTIONS=%OPTIONS% CTX_MF_ODBC_USER_NAME=”DOMAINusername”<br />
SET OPTIONS=%OPTIONS% CTX_MF_ODBC_PASSWORD=”password”<br />
SET OPTIONS=%OPTIONS% CTX_MF_SHADOWING_CHOICE=”Yes”<br />
SET OPTIONS=%OPTIONS% CTX_MF_SHADOW_PROHIBIT_REMOTE_ICA=”No”<br />
SET OPTIONS=%OPTIONS% CTX_MF_SHADOW_PROHIBIT_NO_NOTIFICATION=”No”<br />
SET OPTIONS=%OPTIONS% CTX_MF_SHADOW_PROHIBIT_NO_LOGGING=”No”<br />
SET OPTIONS=%OPTIONS% CTX_MF_XML_CHOICE=”share”<br />
SET OPTIONS=%OPTIONS% CTX_MF_LAUNCH_CLIENT_CD_WIZARD=”No”<br />
SET OPTIONS=%OPTIONS% CTX_MF_SERVER_TYPE=”E”<br />
SET OPTIONS=%OPTIONS% CTX_MF_REBOOT=”No”<br />
SET OPTIONS=%OPTIONS% CTX_IGNORE_MCM=”No”<br />
SET OPTIONS=%OPTIONS% CTX_REMOVE_WI_TURNKEY=”Yes”<br />
SET OPTIONS=%OPTIONS% CTX_MF_ENABLE_VIRTUAL_SCRIPTS=”Yes”<br />
SET OPTIONS=%OPTIONS% CTX_MF_LICENSE_SERVER_NAME=”localhost”<br />
SET OPTIONS=%OPTIONS% CTX_MF_LICENSE_SERVER_PORT=”27000”<br />
SET OPTIONS=%OPTIONS% CTX_MF_LICENSE_SERVER_PORT_DEFAULT=”1”<br />
SET OPTIONS=%OPTIONS% CTX_MF_LIC_CHOICE_FOR_CREATE=”UseFarmSettings”<br />
SET OPTIONS=%OPTIONS% CTX_MF_LIC_CHOICE_FOR_JOIN_OR_UPGRADE=”UseFarmSettings”<br />
SET OPTIONS=%OPTIONS% CTX_RDP_DISABLE_PROMPT_FOR_PASSWORD=”Yes”<br />
SET OPTIONS=%OPTIONS% CTX_MF_ONLY_LAUNCH_PUBLISHED_APPS=”No”<br />
START /WAIT MSIEXEC /I MPS.msi %OPTIONS%[/code]</p>

<p>The last line here installs Presentation Server using the Windows Installer file with the command line options.</p>

<h3 id="installing-the-access-management-console">Installing the Access Management Console</h3>

<p>The Presentation Server Console will be installed along with Presentation Server, however the Access Management Console (AMC) must be installed seperately. The AMC comes as a number of Windows Installer files €“ the console itself plus plugins. The last line here is commended out; if you aren’t installing Web Interface on your Terminal Server, keep this one out.</p>

<p>[code]START /WAIT MSIEXEC /I “AdministrationAccess Management ConsoleSetupASC_Framework.msi” ALLUSERS=TRUE REBOOT=SUPRESS /QB-<br />
START /WAIT MSIEXEC /I “AdministrationAccess Management ConsoleSetupASC_Diagnostics.msi” ALLUSERS=TRUE REBOOT=SUPRESS /QB-<br />
START /WAIT MSIEXEC /I “AdministrationAccess Management ConsoleSetupASC_HotfixManagement.msi” ALLUSERS=TRUE REBOOT=SUPRESS /QB-<br />
START /WAIT MSIEXEC /I “AdministrationAccess Management ConsoleSetupASC_KnowledgeBase.msi” ALLUSERS=TRUE REBOOT=SUPRESS /QB-<br />
START /WAIT MSIEXEC /I “AdministrationAccess Management ConsoleSetupASC_Legacy.msi” ALLUSERS=TRUE REBOOT=SUPRESS /QB-<br />
START /WAIT MSIEXEC /I “AdministrationAccess Management ConsoleSetupASC_Licensing.msi” ALLUSERS=TRUE REBOOT=SUPRESS /QB-<br />
START /WAIT MSIEXEC /I “AdministrationAccess Management ConsoleSetupASC_PresentationServer.msi” ALLUSERS=TRUE REBOOT=SUPRESS /QB-<br />
START /WAIT MSIEXEC /I “AdministrationAccess Management ConsoleSetupASC_PSReports.msi” ALLUSERS=TRUE REBOOT=SUPRESS /QB-<br />
START /WAIT MSIEXEC /I “AdministrationAccess Management ConsoleSetupASC_ReportCenter.msi” ALLUSERS=TRUE REBOOT=SUPRESS /QB-<br />
REM START /WAIT MSIEXEC /I “AdministrationAccess Management ConsoleSetupASC_WebInterface.msi” ALLUSERS=TRUE REBOOT=SUPRESS /QB-<br />
[/code]</p>

<h3 id="configuring-presentation-server">Configuring Presentation Server</h3>

<p>Once Presentation Server is installed, you may want to make some configuration changes. I generally do a few things, such as delete some icons:</p>

<p>[code]IF EXIST “%ALLUSERSPROFILE%Start MenuDesktopProgram Neighborhood.LNK” DEL “%ALLUSERSPROFILE%Start MenuDesktopProgram Neighborhood.LNK”<br />
IF EXIST “%ALLUSERSPROFILE%Start MenuProgramsStartupProgram Neighborhood Agent.LNK” DEL “%ALLUSERSPROFILE%Start MenuProgramsStartupProgram Neighborhood Agent.LNK” [/code]</p>

<p>Disable the local user accounts created for anonymous connections to applications if that feature won’t be used:</p>

<p>[code]NET USER | FIND “Anon” &gt; %SYSTEMROOT%TEMPUSERS1.TXT<br />
FOR /F “tokens=1,2,3” %%u IN (%SYSTEMROOT%TEMPUSERS1.TXT) DO ECHO %%u » %SYSTEMROOT%TEMPUSERS2.TXT &amp; ECHO %%v » %SYSTEMROOT%TEMPUSERS2.TXT &amp; ECHO %%w » %SYSTEMROOT%TEMPUSERS2.TXT<br />
TYPE %SYSTEMROOT%TEMPUSERS2.TXT | FIND “Anon” &gt; %SYSTEMROOT%TEMPUSERS3.TXT<br />
FOR /F %%u IN (%SYSTEMROOT%TEMPUSERS3.TXT) DO NET USER %%u /ACTIVE:NO &gt; NUL[/code]</p>

<p>Stop the administrator toolbar from appearing:</p>

<p>[code]REG DELETE HKLMSoftwareMicrosoftWindowsCurrentVersionRun /v ICABAR /f [/code]</p>

<p>And set some client printer options:</p>

<p>[code]REG ADD HKLMSYSTEMCurrentControlSetControlCitrixClientPrinterProperties /v fPurgeAnyWay /t REG_DWORD /d 0x00000001 /f<br />
REG ADD HKLMSYSTEMCurrentControlSetControlCitrixClientPrinterProperties /v fNotInheritKeepPrintedJobs /t REG_DWORD /d 0x00000001 /f[/code]</p>

<p>And that’s pretty much all you need to script your installation. This script can be used to add a new server to the farm or in the event of a reinstall, add an existing server back to the farm (no need to remove the server first). You can find the complete listing of my Presentation Server 4.5 script here:</p>

<ul>
  <li><a href="http://www.stealthpuppy.com/blogs/travelling/pages/unattended-install-citrix-presentation-server-4-5.aspx">Unattended Install: Presentation Server 4.5</a></li>
</ul>

<p><strong>Note:</strong> for a more up to date version of this script, you can download the latest version from my SkyDrive here:</p>

  </div><a class="u-url" href="/unattended-presentation-server-45/" hidden></a>
</article>
      </div>
    </main>

    <footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col one-half">
      <h2 class="footer-heading">stealthpuppy</h2>
        <ul class="contact-list">
          <li class="p-name">stealthpuppy</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col one-half">
        <p>on end user computing and enterprise mobility</p>
      </div>

      <div class="social-links"><ul class="social-media-list"><li><a href="https://github.com/aaronparker" title="aaronparker"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a href="https://www.linkedin.com/in/aaronedwardparker" title="aaronedwardparker"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a href="https://twitter.com/stealthpuppy" title="stealthpuppy"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li><li><a href="/feed.xml" title="atom"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg></a></li></ul>
</div>
    </div>

  </div>

</footer>
</body>

</html>
