<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Hands off my gold image - Microsoft Deployment Toolkit details | aaron parker</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Hands off my gold image - Microsoft Deployment Toolkit details" />
<meta name="author" content="Aaron Parker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="After the corresponding Geek Speak talk at Citrix Synergy in Barcelona, I posted an article on automating a XenApp deployment and capture into Provisioning Services via the Microsoft Deployment Toolkit (MDT): Hands off my gold image – Automating Citrix XenApp/PVS Image Creation." />
<meta property="og:description" content="After the corresponding Geek Speak talk at Citrix Synergy in Barcelona, I posted an article on automating a XenApp deployment and capture into Provisioning Services via the Microsoft Deployment Toolkit (MDT): Hands off my gold image – Automating Citrix XenApp/PVS Image Creation." />
<link rel="canonical" href="/hands-off-my-gold-image-microsoft-deployment-toolkit-details/" />
<meta property="og:url" content="/hands-off-my-gold-image-microsoft-deployment-toolkit-details/" />
<meta property="og:site_name" content="aaron parker" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2012-10-30T16:39:43+11:00" />
<script type="application/ld+json">
{"description":"After the corresponding Geek Speak talk at Citrix Synergy in Barcelona, I posted an article on automating a XenApp deployment and capture into Provisioning Services via the Microsoft Deployment Toolkit (MDT): Hands off my gold image – Automating Citrix XenApp/PVS Image Creation.","author":{"@type":"Person","name":"Aaron Parker"},"@type":"BlogPosting","url":"/hands-off-my-gold-image-microsoft-deployment-toolkit-details/","headline":"Hands off my gold image - Microsoft Deployment Toolkit details","dateModified":"2012-10-30T16:39:43+11:00","datePublished":"2012-10-30T16:39:43+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"/hands-off-my-gold-image-microsoft-deployment-toolkit-details/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="aaron parker" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">aaron parker</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">ABOUT</a><a class="page-link" href="/smb-not-cifs.html">SMB not CIFS</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Hands off my gold image - Microsoft Deployment Toolkit details</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2012-10-30T16:39:43+11:00" itemprop="datePublished">Oct 30, 2012
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Aaron Parker</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>After the corresponding <a href="https://citrix.g2planet.com/synergybarcelona2012/public_session_view.php?agenda_session_id=191&amp;conference=synergy">Geek Speak talk at Citrix Synergy in Barcelona</a>, I posted an article on automating a XenApp deployment and capture into Provisioning Services via the <a href="http://technet.microsoft.com/en-us/solutionaccelerators/dd407791.aspx">Microsoft Deployment Toolkit</a> (MDT): <a href="http://stealthpuppy.com/deployment/hands-off-my-gold-image-automating-citrix-xenapppvs-image-creation/">Hands off my gold image – Automating Citrix XenApp/PVS Image Creation.</a></p>

<p>In a series of blog posts I’ll cover some of the steps in more detail - first up is configuring the MDT deployment share. I won’t cover setting up a share here, so if you’re new to MDT, I suggest starting at the <a href="http://technet.microsoft.com/en-us/solutionaccelerators/dd407791.aspx">MDT home page on TechNet</a> where you’ll find various resources on using MDT.</p>

<h2 id="hosting-mdt">Hosting MDT</h2>

<p>Typically MDT is going to be hosted on a Windows Server (VM or physical server); however as a minimum the MDT deployment share only needs to be available over SMB. So essentially any storage location that supports SMB will suit.</p>

<p>The MDT console and ADK/WAIK must be installed somewhere and it’s often most convenient to install these on a management desktop/server VM, accessible by whomever is administering MDT.</p>

<h2 id="customsettingsini">CustomSettings.ini</h2>

<p>The ZIP file available for download includes a sample CustomSettings.ini which is used to control the MDT deployment share. I’ve stripped this file down to it’s bare essentials to be able to walk you through some of the options used in this approach.</p>

<p>You could potentially use a <a href="http://deployment.xtremeconsulting.com/2009/11/24/understanding-the-mdt-configuration-database-part-1/">Configuration Database</a> instead; however I’ve opted to use CustomSettings.ini so that I can use an approach that is as portable as possible.</p>

<p>[code][Settings]<br />
Priority=ByVM, UUID, Default<br />
Properties=XenAppRole, PVSTemplate, WindowsUpdate</p>

<p>[Default]<br />
WSUSServer=http://wsus-svr:8530<br />
WindowsUpdate=FALSE</p>

<p>OSInstall=YES<br />
DeploymentType=NEWCOMPUTER<br />
DoNotCreateExtraPartition=NO</p>

<p>; ==============================================<br />
; Control specific settings for virtual machines</p>

<p>[ByVM]<br />
Subsection=VM-%IsVM%</p>

<p>[VM-True]<br />
; Prevent creation of BDE partition on VMs<br />
DoNotCreateExtraPartition=YES</p>

<p>;=================================<br />
; Machine specific configurations</p>

<p>[&lt;insert VM UUID here]<br />
OSDComputerName=<VM name="">  
TaskSequenceID=<task sequence="" short="" code="">  
XenAppRole=WORKER  
PVSTemplate=TRUE[/code]</task></VM></p>

<p>Under the [Settings] heading, I’ve created three custom properties <em>XenAppRole</em>, <em>PVSTemplate</em> and <em>WindowsUpdate</em>. These properties enable a few things:</p>

<ul>
  <li>XenAppRole - valid values for this property are CONTROLLER and WORKER. This controls the installation of XenApp and whether XenApp is then configured as a Controller (hosts the XML broker and enumerates applications and zones etc) or a Worker (hosting user sessions and applications). If this property is not set against a computer record, then XenApp will not be installed</li>
  <li>PVSTemplate - this controls whether a computer is the master template for Provisioning Services. The only valid value is TRUE. If this is set, then during the MDT task sequence, the computer image will be converted to a PVS image</li>
  <li>WindowsUpdate - this property controls whether Windows Update is run during the task sequence. Valid values are TRUE or FALSE. Set this to FALSE during testing to reduce the amount of time to deploy and capture an image.</li>
</ul>

<p>To control the creation (or not) of the BitLocker boot partition, a combination of the property <em>DoNotCreateExtraPartition</em> and detection of a virtual machine (the <em>ByVM</em> and <em>VM-True</em> sections) is used. This allows us to ensure that the partition is not created on virtual machines where it isn’t required.</p>

<p>The end of CustomSettings.ini (under machine specific configurations, is a sample heading for a target computer. Target computers are best identified by their UUID. This allows the MDT task sequence to match the machine it’s running on against the properties set in CustomSettings.ini.</p>

<p>In the next article, I’ll cover some specifics around <a href="http://stealthpuppy.com/deployment/hands-off-my-gold-image-the-task-sequence/">the task sequence used to deploy Windows, install XenApp and capture the PVS image</a>. In the meantime if you want to get more detail on this approach email me at aaron (at) stealthpuppy.com.</p>

  </div><a class="u-url" href="/hands-off-my-gold-image-microsoft-deployment-toolkit-details/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">aaron parker</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">aaron parker</li><li><a class="u-email" href="mailto:aaron@stealthpuppy.com">aaron@stealthpuppy.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/aaronparker"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">aaronparker</span></a></li><li><a href="https://www.twitter.com/stealthpuppy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">stealthpuppy</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>on end user computing and enterprise mobility</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
